var camera,light,reqA,SPEED,tileAnimation,saveBg,delta,self,ctx,row,column,data,particles=[],snows=[],rains=[],pathIndex=0,isLight=!1;get=function(t){return document.querySelector(t)},getAll=function(t){return document.querySelectorAll(t)};var imSet=!1,JumpTime=0,friction=.5,isCamera=!1,objframe=0,layerframe=0,frame=0,isFake=!1,isDrawable=!1;const log=console.log;var rotImage=!1,toJson=JSON.stringify;function Stage(){function t(t,e,s){return t*(1-s)+e*s}stage=(self={stage:document.createElement("canvas")}).stage,void 0==self.scale&&(self.scale=1),self.stage.style.position="absolute",self.stage.style.zIndex=0,self.stage.style.imageRendering="pixelated",self.stage.style.background="white",self.add=function(t,e){this.b=e,void 0==e&&document.body.appendChild(t),void 0!==e&&"before"==e&&document.body.before(t)},self.delete=function(t){document.body.removeChild(t)},self.setSpriteImage=function(t,e){try{if(!Array.isArray(t))return t.image.src=e;for(let s of t)s.image.src=e}catch(i){}},self.stage.setBg=function(t){this.c=t,isFake&&(e=this.c||"transparent"),void 0==this.c||void 0==t||""==this.c?self.stage.style.background=e:isFake&&void 0==this.c||void 0==t||""==this.c?self.stage.style.background="transparent":this.c&&!isFake&&(e=this.c,self.stage.style.background=e),void 0!=this.c||isFake||(e="rgba(17,34,51,0.8)",self.stage.style.background=e)},self.getGridPosition=function(t,e,s,i){return{x:Math.floor(t/s),y:Math.floor(e/i)}},self.parse2D=function(t){if(loader){let e=[];for(let s=0;s<t.height;s++){e[s]=[];for(let i=0;i<t.width;i++){let l=s*t.width+i;e[s][i]=t.data[l]}}return e}},self.setSize=function(t,e){this.a=t*self.scale,this.b=e*self.scale/1.5,this.a&&this.b&&(gW=self.stage.width=this.a,gH=self.stage.height=this.b)},void 0==this.a&&void 0==this.b&&(gW=self.stage.width=innerWidth,gH=self.stage.height=innerHeight),camera={x:1,y:1,width:gW,height:gH},self.stage.setBgRepeat=function(t){},self.stage.style.imageRendering="pixelated",ctx=self.stage.getContext("2d"),rectColor=function(t){ctx.fillStyle=t},strokeColor=function(t){ctx.strokeStyle=t},Rect=function(t,e=t.color){ctx.fillStyle=e,ctx.fillRect(t.x,t.y,t.w,t.h)},Stroke=function(t,e=t.color){ctx.strokeStyle=e,ctx.strokeRect(t.x,t.y,t.w,t.h)},wayPoints=[],self.spriteAnimator=function(t,e,s,i,l,h=!1){return this.speed=l,this.src=e,this.startIndex=i,this.nbFrame=s,this.obj=t,this.startIndex>0?this.index=frame%this.nbFrame+1:this.index=frame%this.nbFrame,this.parenth=h,this.parenth?this.anim=` ${this.src}(${this.index}).png`:this.anim=` ${this.src}${this.index}.png`,frame%this.speed==0&&self.setSpriteImage(this.obj,this.anim),this.index},self.getObjectLayer=function(t){let e=data.layers.find(e=>e.name==t&&"objectgroup"==e.type);return e?e.objects:null},self.normalized=function(t){let e=Math.sqrt(t.vx*t.vx+t.vy*t.vy);e>0&&(t.vx=t.vx/e,t.vy=t.vy/e)},window.onload=function(){self.start?self.start():self.start=function(){}},self.setDetector=function(t,e=!1){t.show=e,(t.collider||"boolean"==typeof e)&&(t.detector={x:t.collider.x+12,y:t.collider.y+t.collider.h,w:18,h:6,color:"rgba(25,250,255,0.5)"},t.flipX&&(t.detector.x=t.detector.x-20))},self.isLimitReach=(t,e)=>{let s=Math.abs(t.y-e.y);return!(t.x<=e.x+e.width)||!(t.x+t.w/2.5>=e.x)||!(t.y+t.h>=s)},self.overLay=function(){opacity=1,self.stage.style.zIndex=-999;var t=document.createElement("canvas");document.body.appendChild(t),e="transparent",t.width=innerWidth,t.height=innerHeight,t.style.position="absolute",screen.width>=1e3?stage.style.scale=2:stage.style.scale=1.2,t.style.zIndex=99999,t.style.background=`rgba(0, 0, 0, ${opacity})`,t.style.marginLeft="0%",t.style.marginTop="0%",setTimeout(function(){opacity-=.02,t.style.background=`rgba(0, 0, 0, ${opacity})`},300),setTimeout(function(){opacity-=.04,t.style.background=`rgba(0, 0, 0, ${opacity})`},600),setTimeout(function(){opacity-=.06,t.style.background=`rgba(0, 0, 0, ${opacity})`},900),setTimeout(function(){opacity-=.08,t.style.background=`rgba(0, 0, 0, ${opacity})`},1e3),setTimeout(function(){opacity-=.2,t.style.background=`rgba(0, 0, 0, ${opacity})`},1200),setTimeout(function(){opacity-=.04,t.style.background=`rgba(0, 0, 0, ${opacity})`},1400),setTimeout(function(){opacity=0,t.style.background=`rgba(0, 0, 0, ${opacity})`,document.body.removeChild(t)},1500)},self.light=function(t,e,s){return isLight=!0,this.obj=t,this.radius=e,this.opacity=s,light={x:this.obj.x+this.obj.w/2,y:this.obj.y+this.obj.h/2,r:this.radius,opacity:this.opacity},this},self.playSound=function(t){return this.x=t,this.audio=new Audio(this.x),this.audio.currentTime=0,this.audio.volume=.12,this.audio.play(),this.audio},self.stopSound=function(t){this.x=t,this.x.pause()},Text=function(t,e,s,i,l,h,a){this.x=h,this.y=a,this.color=t||"gold",this.fontsize=s,this.fontstyle=e,this.fontfamily=i,this.t=l,void 0==this.fontweight&&(this.fontweight="bold"),void 0==this.fontstyle&&(this.fontstyle="italic"),(void 0==this.fontfamily||null==this.fontfamily)&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(t,e,s,i){ctx.clearRect(t,e,s,i)},self.getDistance=function(t,e){if(this.a=t,this.b=e,"polygon"==t.type){var s=Math.abs(this.a.startX-this.b.x),i=Math.abs(this.a.startY-this.b.y),l=Math.hypot(s,i);return l}if("line"==e.type||e.x1){var s=Math.abs(this.a.x-this.b.x1),i=Math.abs(this.a.y-this.b.y1),l=Math.hypot(s,i);return l}if(void 0!=this.a.collider&&void 0!=this.b.collider){var s=Math.abs(this.a.collider.x-this.b.collider.x),i=Math.abs(this.a.collider.y-this.b.collider.y),l=Math.hypot(s,i);return l}if(!this.a.collider&&!this.b.collider){var s=Math.abs(this.a.x-this.b.x),i=Math.abs(this.a.y-this.b.y),l=Math.hypot(s,i);return l}},self.getAngle=function(t,e){var s;return this.a=t,this.b=e,this.a.startX||this.b.startX||(s=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x)),"polygon"==t.type&&"polygon"==e.type&&(s=Math.atan2(this.a.startY-this.b.startY,this.a.startX-this.b.startX)),!this.a.startX&&this.b.startX&&(s=Math.atan2(this.a.y-this.b.startY,this.a.x-this.b.startX)),s},self.isClosest=function(t,e){return distance=self.getDistance(t,e)},self.hasLineOfSight=function(t,e,s){let i=t.x-e.x,l=t.y-e.y,h=e.x-s.x,a=e.y-s.y;return!!(Math.sqrt(i*i+l*l)<Math.sqrt(h*h+a*a))&&!!(e.x+e.w>s.x+s.width)||!!(e.x+e.w<s.x+s.width)||!!(e.y+e.h>s.y+s.height)||!!(e.y+e.h<s.y+s.height)},self.avoidSameOverlapping=function(t){for(let e=0;e<t.length;e++)for(let s=e+1;s<t.length;s++)isCollide(t[e],t[s])&&(t[e].x=t[e].x+.528,t[e].y=t[e].y+.528)},self.setCollider=function(t,e=!1){t.isVisible=e,"boolean"!=typeof e&&(t.isVisible=!1,console.warn("Only a boolean is required in collider method !")),t.sw>100||t.sh>100?(t.collider={x:t.x+t.w/2.14,y:t.y+t.h/3,w:t.w/8,h:t.h/3,vx:t.vx,vy:t.vy,color:"rgba(255,0,0,0.5)"},t.flipX&&(t.collider.x=t.x+t.w/2.24)):(t.collider={x:t.x+t.w/4.5,y:t.y+t.h/4.5,w:t.w/3.7,h:t.h-9,color:"rgba(255,0,0,0.5)"},t.sh!=t.sw&&(t.collider={x:t.x+t.w/4.5,y:t.y+t.h/4.5,w:Math.abs(t.w-t.sw)/1.9,h:Math.abs(t.h-t.sh)/2.2,color:"rgba(255,0,0,0.5)"},t.flipX&&(t.collider.x=t.x+3+t.w/4.5,t.collider.width=Math.abs(t.w-t.sw)/1.9)),t.image||(t.collider={x:t.x+t.w/4,y:t.y,w:t.w-10,h:t.h,color:"rgba(255,0,0,0.5)"}))},self.worldThroughCamera=function(t){return(this.area=t,loader&&!this.area)?{x:0,y:0,width:data.width*data.tilewidth,height:data.height*data.tileheight}:!loader&&this.area?{x:0,y:0,width:t.w,height:t.h}:void 0};var e,s,i,l=!1;camera.setAutoScale=!1,self.setCam=function(e,s,i){if(i=i||!1,camera.setAutoScale&&(screen.width>=1e3&&(self.scale=2.5,stage.style.scale=1.7),stage.style.scale=1.2),1==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.1==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.2==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.3==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.4==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.5==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale|0,height:gH/self.scale|0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.6==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.7==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.8==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),1.9==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),2==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),2.5==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+e.w/2>>0,y=camera.height/2+e.h/2>>0),void 0==s){ctx.translate(gW/2-(e.x-5)>>0,gH/2-(e.y-5)>>0);return}return"boolean"==typeof i&&i&&(l=i),camera.x=t(camera.x,e.x+e.w+10-x,1),camera.y=t(camera.y,e.y+e.h+10-y,1),camera.x<=0&&(camera.x=0),camera.y<=0&&(camera.y=0),camera.x>=s.width-camera.width&&(camera.x=s.width-camera.width),camera.y>s.height-camera.height&&(camera.y=s.height-camera.height),e.x+camera.width*self.scale>=x&&(ctx.translate(-camera.x*self.scale|0,0),isCamera=!0),e.y+camera.height*self.scale>=y&&(ctx.translate(0,-camera.y*self.scale|0),isCamera=!0),e.x<x&&(isCamera=!1),e.y<y&&(isCamera=!1),this};let h=6;self.cameraShake=function(t,e){this.intensity=t,--h<=0&&(h=0);var s=setInterval(()=>{h>0&&(dx=this.intensity*(Math.random()-.5)>>0,dy=this.intensity*(Math.random()-.5)>>0,ctx.setTransform(1,0,0,1,dx,dy))},50);setTimeout(()=>{clearInterval(s),h=6,ctx.setTransform(1,0,0,1,0,0)},e)};var a=0;self.setAnimation=function(t){s=performance.now(),i=1e3/t,reqA=requestAnimationFrame(c)},self.stopAnimation=function(){cancelAnimationFrame(reqA)};let c=()=>{for(reqA=requestAnimationFrame(c),clear(0,0,gW,gH),now=performance.now(),++frame%4==0&&isLayer&&(layerframe++,frame=0),frame%4==0&&isObject&&(objframe++,frame=0),a+=deltaTime=now-s;a+i>deltaTime;)delta=(deltaTime/1e3).toFixed(3),self.update(delta),a-=deltaTime,s=now;if(self.stage.style.imageRendering="pixelated",ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",self.stage.style.imageRendering="pixelated",self.stage.setBg(e),isFake||self.stage.setBg(e),ctx.save(),isLight?(ctx.fillStyle="transparent",ctx.fillRect(0,0,gW,gH)):isLight||(ctx.fillStyle=e,ctx.fillRect(0,0,gW,gH)),self.drawGame?self.drawGame():self.render(),0!=particles.length&&particles.forEach(function(t){t.update(),t.draw()}),0!=snows.length&&snows.forEach(function(t,e){canDraw(t,camera)?(ctx.beginPath(),ctx.fillStyle=t.color,ctx.arc(t.x,t.y+=t.vy,t.r,1.8,1.7*Math.PI),ctx.fill(),ctx.closePath()):kill(snows,e)}),0!=rains.length)for(rain of rains){var t=rains.indexOf(rain);ctx.save(),canDraw(rain,camera)?rain.drawSprite():kill(rains,t),ctx.restore()}isLight&&((cv=document.createElement("canvas")).width=gW,cv.height=gH,cv.style.position="absolute",ctx.save(),ctx.beginPath(),ctx.fillStyle="rgba(255,255,255,0.35)",ctx.globalCompositeOperation="lighter",ctx.arc(light.x*self.scale,light.y*self.scale,light.r,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),ctx.fillStyle=`rgba(0, 0, 0, ${light.opacity})`,ctx.globalCompositeOperation="overlay",ctx.fillRect(camera.x*self.scale,camera.y*self.scale,cv.width,cv.height),ctx.drawImage(cv,0,0)),l&&(ctx.strokeStyle=camera.color,ctx.lineWidth=2*self.scale,ctx.strokeRect(camera.x*self.scale,camera.y*self.scale,camera.width*self.scale,camera.height*self.scale)),ctx.restore()};return kill=function(t,e){return t.splice(e,1)},self.isHoriBorder=function(t,e){if(void 0==t.r&&void 0==e.x){if(t.x<=0||t.x>=e.width-t.w||t.x>=e.w-t.w)return!0}else if(void 0==t.r&&void 0!==e.x){if(t.x<=e.x||t.x>=e.width-t.w||t.x>=e.w-t.w)return!0}else if(void 0!=t.r&&void 0!=e.x){if(t.x<=e.x||t.x>=e.width-t.r||t.x>=e.w-t.r)return!0}else if(void 0!=t.r&&void 0==e.x&&(t.x<=0||t.x>=e.width-t.r||t.x>=e.w-t.r))return!0},self.isVertiBorder=function(t,e){if(void 0==t.r&&void 0!==e.x){if(t.y<=e.y||t.y>=e.height-t.h||t.y>=e.h-t.h)return!0}else if(void 0!=t.r&&void 0!==e.y&&(t.y<=e.y||t.y>=e.height-t.r||t.x>=e.h-t.r))return!0;if(void 0==t.r&&void 0==e.y){if(t.y<=0||t.y>=e.height-t.h||t.y>=e.h-t.h)return!0}else if(void 0!=t.r&&void 0==e.y&&(t.y<=0||t.y>=e.height-t.r||t.x>=e.h-t.r))return!0},self.setAstar=function(t,e,s,i){let l=new Astar;return e=new self.parse2D(e),l.setGrid(e),l.setAcceptableTiles([0]),l.setIterations(s),i&&l.setDiagonal(i),l},self.preventOverlapping=function(t){for(let e=0;e<t.length;e++){let s=t[e];for(let i=0;i<t.length;i++){let l=t[i];if(s.checkCollision(l)){kill(t,e),kill(t,i),i>e&&i--;return}}}},self}var Deg2Rad=Math.PI/180;class Line{constructor(t,e,s,i,l,h){this.x1=t,this.x2=e,this.y1=s,this.y2=i,this.color=l,this.width=h,this.vx=0,this.vy=0,this.round=!1,this.type="line"}drawLine(){ctx.beginPath(),ctx.strokeStyle=this.color,this.round?(ctx.lineJoin="round",ctx.lineCap="round"):(ctx.lineJoin="miter",ctx.lineCap="butt"),ctx.moveTo(this.x1,this.y1),ctx.lineTo(this.x2,this.y2),ctx.lineWidth=this.width,ctx.stroke(),ctx.closePath()}updateLine(){this.x2+=this.vx*delta,this.y2+=this.vy*delta}lineItersect=function(t){var e=Game.getDistance(this,t);t.r?e<=this.y1&&t.y+t.r>=this.y1-5&&(t.y=this.y1-5-t.r,t.vy=0):e<=this.y1&&t.y+t.h>=this.y1-5&&(t.y=this.y1-5-t.h,t.vy=0)}}function PolyGons(t,e,s,i,l,h,a,c,o){this.startX=t,this.startY=e,this.sides=s,this.radius=i,this.angle=h||0,this.color=l,this.speedX=a||0,this.speedY=c||0,this.fill=o||!1,this.type="polygon",this.alpha=1,"boolean"==typeof this.fill&&(this.bullet=[],this.draw=function(){drawPolyBullet(this),ctx.beginPath(),ctx.moveTo(this.startX+this.radius*Math.cos(0+this.angle),this.startY+this.radius*Math.sin(0+this.angle));for(var t=1;t<=this.sides;t++)3==this.sides&&this.flipX?this.currentAngle=1-(t*(2*Math.PI)/this.sides+this.angle):this.currentAngle=t*(2*Math.PI)/this.sides+this.angle,this.fill?this.fill&&(this.x=this.startX+this.radius*Math.cos(this.currentAngle),this.y=this.startY+this.radius*Math.sin(this.currentAngle),this.alpha,ctx.globalAlpha=this.alpha,ctx.fillStyle=this.color,ctx.lineTo(this.x,this.y),ctx.fill()):(this.x=this.startX+this.radius*Math.cos(this.currentAngle),this.y=this.startY+this.radius*Math.sin(this.currentAngle),ctx.strokeStyle=this.color,ctx.lineWidth=1.5,ctx.lineTo(this.x,this.y),ctx.stroke());ctx.lineTo(this.startX+this.radius*Math.cos(0+this.angle),this.startY+this.radius*Math.sin(0+this.angle)),this.fill?this.fill&&(ctx.fillStyle=this.color,ctx.fill()):(this.alpha,ctx.globalAlpha=this.alpha,ctx.strokeStyle=this.color,ctx.lineWidth=1.5,ctx.stroke()),ctx.closePath()},this.update=function(){this.startX+=this.speedX,this.startY+=this.speedY,this.angle>0&&(this.angle+=.01)},this.addBullet=function(t,e,s,i,l,h,a){this.obj={x:t,y:e,w:s,h:i,color:l,r:h,angle:a,direction:this.direction},(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj),this.direction=function(){return this.speedX>0?1:this.speedX<0?-1:this.speedY>0?(this.speedX=0,2):this.speedY<0?-2:void 0}},this.checkCollision=function(t){var e=this.startX-t.startX,s=this.startY-t.startY;return Math.sqrt(e*e+s*s)<this.radius+t.radius})}function drawPolyBullet(t){this.isRot,this.bullet=t.bullet;for(let e=0;e<this.bullet.length;e++)(bul=this.bullet[e]).image||(ctx.fillStyle=bul.color,!this.isRot&&-1==this.direction||1==this.direction||-2==this.direction||2==this.direction&&bul.w>0?ctx.fillRect(bul.x*self.scale,bul.y*self.scale,bul.w*self.scale,bul.h*self.scale):(!this.isRot&&-1==this.direction||1==this.direction||-2==this.direction||2==this.direction&&bul.w<0)&&(ctx.beginPath(),ctx.arc(this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,this.bullet[e].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),0!=bul.w||0!=bul.h||bul.angle?0==bul.w&&0==bul.h&&0!=bul.angle?(ctx.beginPath(),ctx.arc(bul.x*self.scale,bul.y*self.scale,bul.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),bul.x+=3.5*Math.cos(bul.angle+90*Deg2Rad),bul.y+=3.5*Math.sin(bul.angle+90*Deg2Rad),this.isRot=!0):0!=bul.w&&0!=bul.h&&0!=bul.angle&&(ctx.save(),ctx.translate((bul.x+bul.w/2)*self.scale,(bul.y+bul.h/2)*self.scale),ctx.rotate(bul.angle+90*Deg2Rad),ctx.fillRect(-this.bullet[e].w/2*self.scale,-this.bullet[e].h/2*self.scale,this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore(),bul.x+=3.5*Math.cos(bul.angle+90*Deg2Rad),bul.y+=3.5*Math.sin(bul.angle+90*Deg2Rad),this.isRot=!0):(ctx.beginPath(),ctx.arc(this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,this.bullet[e].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()))}function isCollideBoxPolygon(t,e){var s=t.startX-t.radius,i=t.startX+t.radius,l=t.startY-t.radius,h=t.startY+t.radius;if(void 0==e.w){var a=t.startX-e.x,c=t.startY-e.y;if(Math.sqrt(a*a+c*c)<=e.r+t.radius/2+e.r)return!0}else var o=e.x;var n=e.x+e.w,f=e.y,d=e.y+e.h;return!!(i>=o)&&!!(s<=n)&&!!(h>=f)&&!!(l<=d)}function isOverlap(t,e){var s=Math.abs(e.x-(t.x+t.w/2)),i=Math.abs(e.y-(t.y+t.h/2));if(s<=e.r+e.r+t.w/2&&i<=e.r+e.r+t.h/2)return!0}function isCollide(t,e){if(t.x+t.w>e.x&&t.x<e.x+e.w&&t.y+t.h>e.y&&t.y<e.y+e.h||t.x+t.w>e.x&&t.x<e.x+e.width&&t.y+t.h>e.y&&t.y<e.y+e.height)return!0}function isInterCirc(t,e){if(dx=t.x-e.x,dy=t.y-e.y,sumr=t.r+e.r,(distance=Math.sqrt(dx*dx+dy*dy))<=sumr)return!0}function tileMap(t,e,s,i,l,h,a,c,o){return this.image=new Image,this.image.src=a,this.lev=t,this.total=i,this.colTCount=e,this.rowTCount=t.length,this.ts=l*self.scale,this.s=h*self.scale,this.w=c,this.h=o,this.image.onload=()=>this.drawLayer(),this.drawLayer=function(){for(var t=0;t<this.rowTCount;t++)for(var e=0;e<this.colTCount;e++){var s=this.lev[t][e],i=s/this.total>>0,a=s%this.total>>0;a+l<camera.x||a+l>camera.x+camera.width+100||(isDrawable=!0),isDrawable&&(void 0==this.w&&void 0==this.h&&ctx.drawImage(this.image,a*l,i*l,l*self.scale,l*self.scale,e*h,t*h,h*self.scale,h*self.scale),void 0!=this.w&&void 0!=this.h&&ctx.drawImage(this.image,a*l,i*l,l*self.scale,l*self.scale,e*h,t*h,this.w*self.scale,this.h*self.scale))}},this}function isFollow(t,e,s){if(e.goLeft=!1,e.goRight=!1,s|=140,e.collider&&t.collider){var i=Math.abs(t.collider.x-e.collider.x),l=Math.abs(t.collider.y-e.collider.y);return i<=20&&i>=-25?void 0:i<=s&&l<=5&&e.collider.x>t.collider.x?(e.goLeft=!0,e.goRight=!1,!0):i<=s&&l<=5&&e.collider.x<t.collider.x&&(e.goLeft=!1,e.goRight=!0,!0)}}function createGrid(t,e,s,i){this.gap=t,this.w=e,this.h=s,this.color=i,this.drawGrid=function(){ctx.beginPath();for(var t=this.gap;t<this.w;t+=this.gap)ctx.moveTo(t*self.scale,0),ctx.lineTo(t*self.scale,this.h*self.scale),ctx.strokeStyle=this.color,ctx.stroke(),ctx.closePath();for(var e=this.gap;e<this.h;e+=this.gap)ctx.beginPath(),ctx.moveTo(0,e*self.scale),ctx.lineTo(this.w*self.scale,e*self.scale),ctx.strokeStyle=this.color,ctx.stroke(),ctx.closePath()}}function createGrid(t,e,s,i){this.gap=t,this.w=e,this.h=s,this.color=i,this.drawGrid=function(){ctx.beginPath();for(var t=this.gap;t<this.w;t+=this.gap)ctx.moveTo(t*self.scale,0),ctx.lineTo(t*self.scale,this.h*self.scale),ctx.strokeStyle=this.color,ctx.stroke(),ctx.closePath();for(var e=this.gap;e<this.h;e+=this.gap)ctx.beginPath(),ctx.moveTo(0,e*self.scale),ctx.lineTo(this.w*self.scale,e*self.scale),ctx.strokeStyle=this.color,ctx.stroke(),ctx.closePath()}}function addNumber(t,e,s,i){return this.col=t,this.row=e,this.tSize=s,this.color=i,this.spaceX=spaceX=s/2-6,this.spaceY=spaceY=s/2,this.show=()=>{for(var t=0;t<=this.row;t++)for(var e=0;e<=this.col;e++){var s=e+t*this.col;ctx.font="10px arial bold",ctx.fillStyle=this.color,ctx.fillText(s,e*this.tSize*self.scale+this.spaceX*self.scale,t*this.tSize*self.scale+this.spaceY*self.scale)}},this}Sprite=function(t,e,s,i,l,h,a,c,o){this.x=t,this.y=e,this.w=s,this.h=i,this.vx=l,this.vy=h,this.id=o,this.rotation=c||0,this.angle=0,this.flipX=!1,this.flipY=!1,this.left=!1,this.hasShadow=!1,this.setGravity=function(t){this.gravity=t,this.createShadow},this.isJumping=!1,this.color=a,this.setBody=t=>{this.gv=t,void 0==this.gv?(this.setGravity(35),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy)):(this.setGravity(this.gv),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy))},this.Rotation=function(){ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.angle),ctx.translate(-this.x*self.scale,-this.y*self.scale)},this.createShadow=function(t){this.shape=t,this.hasShadow=!0,this.shadowY=this.y+this.h+4.2*this.r,this.collider?this.r=this.collider.w/1.5:this.r=this.w/1.5},this.color||(this.image=new Image),this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.scale(1,.5),ctx.fillStyle="rgba(0,0,0,0.5)",ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?ctx.fillRect(this.collider.x*self.scale,this.shadowY*self.scale,this.collider.w*self.scale,this.collider.h*self.scale):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0?this.left=!1:this.vx<0&&(this.left=!0);for(var t=!1,e=0;e<this.bullet.length;e++){var s=this.bullet[e];s.image||(ctx.fillStyle=s.color,(t||-1!=this.direction)&&1!=this.direction&&-2!=this.direction&&this.direction,(0!=s.w||0!=s.h||s.angle||-1!=this.direction)&&1!=this.direction&&-2!=this.direction&&2!=this.direction?0==s.w&&0==s.h&&0!=s.angle?(ctx.save(),ctx.beginPath(),ctx.arc(s.x-20*self.scale,s.y+2*self.scale,s.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),s.x+=3.5*Math.cos(s.angle+90*Deg2Rad),s.y+=3.5*Math.sin(s.angle+90*Deg2Rad),t=!0,ctx.restore()):0!=s.w&&0!=s.h&&0!=s.angle&&(ctx.save(),ctx.translate((s.x+s.w/2)*self.scale,(s.y+s.h/2)*self.scale),ctx.rotate(s.angle),ctx.fillRect(-this.bullet[e].w/2*self.scale,-this.bullet[e].h/2*self.scale,this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore(),s.x+=3.5*Math.cos(s.angle+90*Deg2Rad),s.y+=3.5*Math.sin(s.angle+90*Deg2Rad),t=!0):(ctx.beginPath(),ctx.arc(this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,this.bullet[e].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),s.image&&s.angle&&(ctx.save(),ctx.translate((s.x+s.w/2)*self.scale,(s.y+s.h/2)*self.scale),ctx.rotate(s.angle),ctx.drawImage(this.bullet[e].image,-(this.bullet[e].w/2)*self.scale,-(this.bullet[e].h/2)*self.scale,this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore(),s.x+=3.5*Math.cos(s.angle+90*Deg2Rad),s.y+=3.5*Math.sin(s.angle+90*Deg2Rad),t=!0)}if(this.flipX&&!this.rotation)for(var e=0;e<this.bullet.length;e++){if(this.bullet[e].image){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[e].image,-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore();return}if(this.bullet[e].w>0&&this.bullet[e].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[e].color,ctx.fillRect(-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore();return}if(0==this.bullet[e].w&&0==this.bullet[e].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.rotation&&!this.flipX&&!rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.translate(-this.x*self.scale,-this.y*self.scale),ctx.restore();return}if(this.rotation&&this.flipX&&!rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,1),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle){ctx.save(),ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),this.isVisible&&(ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale),this.flipX&&(ctx.save(),ctx.scale(-1,1),ctx.fillRect(-(this.collider.x+4.2)*self.scale,this.collider.y*self.scale,-this.w/2*self.scale,this.collider.h*self.scale),ctx.restore()))},this.reverse=!1,this.drawSpriteImg=function(){if(this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.fillStyle="rgba(0,0,0,0.5)",ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?ctx.fillRect(this.collider.x*self.scale,this.shadowY*self.scale,this.collider.w*self.scale,this.collider.h*self.scale):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0?this.left=!1:this.vx<0&&(this.left=!0),this.isVisible&&(ctx.save(),ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale),ctx.restore()),this.show&&(ctx.save(),ctx.fillStyle=this.detector.color,ctx.fillRect(this.detector.x*self.scale,this.detector.y*self.scale,this.detector.w*self.scale,this.detector.h*self.scale),ctx.restore()),this.flipX&&!rotImage)for(var t=0;t<this.bullet.length;t++){if(imSet){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[t].image,-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore();return}for(var e=0;e<this.bullet.length;e++){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[e].color,ctx.fillRect((-this.bullet[e].x-this.bullet[e].w)*self.scale,this.bullet[e].y*self.scale,this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.globalAlpha=1,ctx.restore();return}}for(var s=!1,t=0;t<this.bullet.length;t++){var i=this.bullet[t];if(i.image||(ctx.fillStyle=this.bullet[t].color,(s||-1!=i.direction)&&1!=i.direction&&-2!=i.direction&&2!=i.direction||ctx.fillRect(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),0==this.bullet[t].w&&0==this.bullet[t].h&&void 0==i.angle&&-1==this.direction||1==this.direction||-2==this.direction||2==this.direction?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()):0==this.bullet[t].w&&0==this.bullet[t].h&&void 0!=i.angle?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),i.x+=3.5*Math.cos(i.angle+90*Deg2Rad),i.y+=3.5*Math.sin(i.angle+90*Deg2Rad),s=!0):0!=i.r||void 0==i.angle||(ctx.save(),ctx.translate((i.x+i.w/2)*self.scale,(i.y+i.h/2)*self.scale),ctx.rotate(i.angle),ctx.fillRect(-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore(),i.x+=3.5*Math.cos(i.angle-90*Deg2Rad),i.y+=3.5*Math.sin(i.angle-90*Deg2Rad),s=!0)),i.image&&((s||-1!=i.direction)&&1!=i.direction&&-2!=i.direction&&2!=i.direction||i.flipX||ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),void 0!=i.angle&&(ctx.save(),ctx.translate((i.x+i.w/2)*self.scale,(i.y+i.h/2)*self.scale),ctx.rotate(i.angle),ctx.drawImage(this.bullet[t].image,-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore(),i.x+=3.5*Math.cos(i.angle+90*Deg2Rad),i.y+=3.5*Math.sin(i.angle+90*Deg2Rad),s=!0)),this.bullet[t].image&&this.bullet[t].flipX){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[t].image,-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore();return}if(this.bullet[t].image&&this.bullet[t].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,-this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,-this.bullet[t].h*self.scale),ctx.restore();return}}if(this.angle&&"up"==this.look||this.angle&&"down"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle),this.angle<=3&&this.reverse&&ctx.scale(1,-1),this.angle<=-0&&this.reverse&&ctx.scale(1,-1),ctx.drawImage(this.image,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle&&"left"==this.look||"right"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle+90*Deg2Rad),this.angle<=3&&this.reverse&&ctx.scale(1,-1),this.angle<=-0&&this.reverse&&ctx.scale(1,-1),ctx.drawImage(this.image,-this.w/8*self.scale,-this.h/8*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.flipX&&!this.rotation)for(var t=0;t<this.bullet.length;t++)if(this.bullet[t].image)ctx.drawImage(this.bullet[t].image,-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.globalAlpha=1;else{if(this.bullet[t].w>0&&this.bullet[t].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[t].color,ctx.fillRect(-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore();return}if(0==this.bullet[t].w&&0==this.bullet[t].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.flipX&&!rotImage){if(rotImage)return;ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.image,-this.x*self.scale,this.y*self.scale,-this.w*self.scale,this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipX&&imSet&&!rotImage){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.flipY&&!this.rotation&&!rotImage&&imSet){if(rotImage)return;ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipY&&!this.rotation){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.rotation&&(rotImage=!0),this.rotation&&this.flipX&&rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,1),ctx.rotate(this.rotation),ctx.drawImage(this.image,-this.w/8,-this.h/8,this.w,this.h),ctx.restore();return}if(this.rotation&&!this.flipX&&rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.rotation+90*Deg2Rad),ctx.drawImage(this.image,-this.w/8,-this.h/8,this.w,this.h),ctx.restore();return}},this.addBullet=function(t,e,s,i,l,h,a){this.obj={x:t,y:e,w:s,h:i,color:l,r:h,angle:a,direction:this.direction()},(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)},this.addBulletIm=function(t,e,s,i,l,h){this.obj={x:t,y:e,w:s,h:i,flipX:!1,flipY:!1,angle:h,direction:this.direction()},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)},this.direction=function(){return this.vx>0?1:this.vx<0?-1:this.vy>0?(this.vx=0,2):this.vy<0?-2:void 0};var n=0;this.SpriteRot=function(){n+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,n)},this.drawSpriteRot=function(t,e,s,i,l){ctx.save(),ctx.translate(t,e),ctx.rotate(l*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-s/2*self.scale,-i/2*self.scale,s*self.scale,i*self.scale),ctx.restore()};var n=0;this.SpriteImgRot=function(){n+=8,this.drawSpriteImgRot(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale,n)},this.drawSpriteImgRot=function(t,e,s,i,l,h){return ctx.save(),ctx.translate(e,s),ctx.rotate(h*Deg2Rad),ctx.drawImage(this.image,-i/2*self.scale,-l/2*self.scale,i*self.scale,l*self.scale),ctx.restore(),this}},Circle=function(t,e,s,i,l,h,a){this.x=t,this.y=e,this.r=s,this.vx=i,this.vy=l,this.id=a,this.left=!1,this.setGravity=function(t){this.gravity=t,this.isDrawn=!1,this.hasShadow=!1},this.color=h,this.bullet=[],this.bullet.image=new Image,this.createShadow=function(t){this.shape=t,this.hasShadow=!0,this.shadowY=this.y+this.h+4.2*this.r,this.collider?this.r=this.collider.w/1.5:this.r=this.w/1.5},this.setBody=t=>{this.gv=t,void 0==this.gv?(this.setGravity(35),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy)):(this.setGravity(this.gv),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy))},this.drawCirc=function(){for(b of(this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.scale(1,.5),ctx.fillStyle="rgba(0,0,0,0.5)",ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?ctx.fillRect(this.collider.x*self.scale,this.shadowY*self.scale,this.collider.w*self.scale,this.collider.h*self.scale):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0?this.left=!1:this.vx<0&&(this.left=!0),ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x*self.scale,this.y*self.scale,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),this.isDrawn=!0,this.bullet))ctx.fillStyle=b.color,b.w>0&&b.h>0&&(ctx.fillStyle=ctx.fillRect(b.x*self.scale,b.y*self.scale,b.w*self.scale,b.h*self.scale)),0==b.w&&0==b.h&&(ctx.beginPath(),ctx.arc(b.x*self.scale,b.y*self.scale,b.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())},this.addBullet=function(t,e,s,i,l,h){this.obj={x:t,y:e,w:s,h:i,color:l,r:h,direction:this.direction()},(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)},this.addBulletIm=function(t,e,s,i,l){this.obj={x:t,y:e,w:s,h:i,flipX:!1,flipY:!1,direction:this.direction()},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)}},this.direction=function(){return this.vx<0?-1:this.vx>0?1:this.vy<0?-2:this.vy>0?2:void 0},SpriteSheet=function(t,e,s,i,l,h,a,c,o,n,f){this.row=e,this.col=t,this.sw=s,this.sh=i,this.x=l,this.y=h,this.w=a,this.h=c,this.vx=o,this.vy=n,this.id=f,this.angle=0,this.flipX=!1,this.flipY=!1,this.left=!1,this.isFalling=!1,this.hasShadow=!1,this.setGravity=function(t){this.gravity=t,this.isDrawn=!1,this.hasShadow=!1},this.reverse=!1,this.createShadow=function(t){this.shape=t,this.hasShadow=!0,this.onFloor&&0===Math.floor(this.vy)?this.shadowY=this.collider.y+this.collider.h+3:this.isFalling?this.shadowY=this.collider.y+2*this.collider.h:this.vy<0&&(this.shadowY=this.collider.y+2*this.collider.h),this.collider?this.r=this.collider.w/1.5:this.r=this.w/1.5},this.setBody=t=>{this.gv=t,void 0==this.gv?(this.setGravity(40),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy),this.hasShadow=!1):(this.setGravity(this.gv),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy))},this.isVisible=!1,this.show=!1,imSet=!0,this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){if(this.vy>0&&(this.isFalling=!0),this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.scale(1,.5),ctx.fillStyle="rgba(0,0,0,0.5)",this.flipX?(ctx.arc((this.x+6+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill()):(ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?(this.flipX,ctx.fillRect(this.collider.x*self.scale,(this.shadowY+5)*self.scale,this.collider.w*self.scale,this.collider.h/2*self.scale)):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0&&(this.left=!1),this.vx<0&&(this.left=!0),this.angle&&"up"==this.look||this.angle&&"down"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle),this.angle<=3&&ctx.scale(1,-1),this.angle<=-0&&ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle&&"left"==this.look||this.angle&&"right"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle+90*Deg2Rad),this.angle<=3&&this.reverse&&ctx.scale(1,-1),this.angle<=-0&&this.reverse&&ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}this.isRot=!1;for(var t=0;t<this.bullet.length;t++){var e=this.bullet[t];if(e.image||(ctx.fillStyle=this.bullet[t].color,this.isRot||void 0!=this.angle||ctx.fillRect(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),0==this.bullet[t].w&&0==this.bullet[t].h&&void 0==this.bullet[t].angle?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()):0==this.bullet[t].w||0==this.bullet[t].h||this.bullet[t].angle?0==this.bullet[t].w&&0==this.bullet[t].h&&void 0!=e.angle?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),e.x+=3.5*Math.cos(e.angle+90*Deg2Rad),e.y+=3.5*Math.sin(e.angle+90*Deg2Rad)):0==e.r&&void 0!=this.angle&&(ctx.save(),ctx.translate((e.x+e.w/2)*self.scale,(e.y+e.h/2)*self.scale),e.x+=3.5*Math.cos(e.angle+90*Deg2Rad),e.y+=3.5*Math.sin(e.angle+90*Deg2Rad),ctx.rotate(e.angle),ctx.fillRect(-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),this.isRot=!0,ctx.restore()):ctx.fillRect(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale)),e.image&&((this.isRot||-1!=e.direction)&&1!=e.direction&&-2!=e.direction&&2!=e.direction||e.flipX||ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),void 0!=e.angle&&(ctx.save(),ctx.translate((e.x+e.w/2)*self.scale,(e.y+e.h/2)*self.scale),ctx.rotate(e.angle),ctx.drawImage(this.bullet[t].image,-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore(),e.x+=15*Math.cos(e.angle+90*Deg2Rad),e.y+=15*Math.sin(e.angle+90*Deg2Rad),this.isRot=!0)),this.bullet[t].image&&this.bullet[t].flipX&&(ctx.save(),ctx.scale(-1,1),ctx.globalAlpha=1,ctx.drawImage(this.bullet[t].image,-(this.bullet[t].x-5)*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore()),this.bullet[t].image&&this.bullet[t].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,-this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,-this.bullet[t].h*self.scale),ctx.restore();return}}if(this.flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.restore();return}this.flipX&&(ctx.save(),ctx.scale(-1,1),ctx.globalAlpha=1,ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-((this.x+5)*self.scale)-this.w*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore()),this.flipX||this.rotation||this.angle||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),this.isVisible&&(ctx.save(),ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale),ctx.restore()),this.show&&(ctx.save(),ctx.fillStyle=this.detector.color,ctx.fillRect(this.detector.x*self.scale,this.detector.y*self.scale,this.detector.w*self.scale,this.detector.h*self.scale),ctx.restore())},this.addBullet=function(t,e,s,i,l,h,a){this.obj={x:t,y:e,w:s,h:i,color:l,r:h,angle:a,direction:this.direction()},this.bullet.push(this.obj)},this.addBulletIm=function(t,e,s,i,l,h){this.obj={x:t,y:e,w:s,h:i,flipX:!1,flipY:!1,angle:h,direction:this.direction()},this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)},this.direction=function(){return this.vx>0?1:this.vx<0?-1:this.vy>0?2:this.vy<0?-2:void 0};var d=0;this.SpriteSheetRot=function(){d+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,d)},this.drawSpriteSheetRot=function(t,e,s,i,l,h,a,c,o,n){ctx.save(),ctx.translate(h*self.scale,a*self.scale),ctx.rotate(n*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-(c/2)*self.scale,-(o/2)*self.scale,c*self.scale,o*self.scale),ctx.restore()}};let loader=!1,that;var isLayer=!1,isObject=!1;function mapFromcollection(t){that=this,that.path=t,that.load=function(){var t=new XMLHttpRequest;t.open("get",that.path),t.responseType="json",t.send(),t.onreadystatechange=function(){if(4==t.readyState)return isLoading=!0,data=t.response}}}function tiledMap(t,e,s){that=this,that.path=t,that.image=e=new Image,that.size=s,that.load=function(){(xhr=new XMLHttpRequest).onload=function(){if(4==this.readyState){try{data=JSON.parse(xhr.response)}catch(t){}loader=!0,that.loadTileset(data)}},xhr.open("get",that.path),xhr.send(!0)},that.loadTileset=function(t){var e=/..\/+/;for(tile of data.tilesets)that.image.src=tile.image.replace(e,"")},animL=[];var i=!1;return that.renderLayer=function(t){for(r=0;r<t.height;r++)for(col=0;col<t.width;col++){let e=col+r*t.width,l=t.data[e];tX=--l%(tile.imagewidth/s)*s,tY=~~(l/(tile.imagewidth/s))*s,dX=e%t.width*s,dY=~~(e/t.width)*s,(isDrawable=!(dX+s<camera.x||dX+s>camera.x+camera.width+100&&dY+s<camera.y||dY+s>camera.y+camera.height+100))&&(ctx.globalAlpha=1,ctx.drawImage(that.image,tX,tY,s,s,dX*self.scale,dY*self.scale,s*self.scale,s*self.scale)),tile.tiles&&tile.tiles.forEach((h,a)=>{if(animL.push(h),0!=l&&void 0!=animL[l]||null!=animL[l]){i=!0;var c=animL[l].animation;tIndex=layerframe%(numFrames=c.length),i&&l==h.id&&(tX=(l=c[tIndex].tileid+1)%(tile.imagewidth/s)*s,tY=Math.floor(l/(tile.imagewidth/s))*s,dX=e%t.width*s,dY=Math.floor(e/t.width)*s,(isDrawable=!(dX+s<camera.x||dX+s>camera.x+camera.width+100&&dY+s<camera.y||dY+s>camera.y+camera.height+100))&&(isLayer=!0),ctx.globalAlpha=1,ctx.drawImage(that.image,tX,tY,s,s,dX*self.scale,dY*self.scale,s*self.scale,s*self.scale))}})}var h=!1;self.objectAnimation=tileAnimation=function(e,s){for(t of(that.val=e,this.nom=s,data.layers))if("objectgroup"==t.type&&this.nom==t.name&&tile.tiles)for(let i of(isObject=!0,tile.tiles)){frameIndex=objframe%(anim=i.animation).length,l=anim[frameIndex].tileid,tileColumns=tile.imagewidth/tile.tilewidth,tileRows=tile.imageheight/tile.tileheight;var l,a=tile.tileheight,c=tile.tilewidth;for(var o of t.objects)o.hasOwnProperty("gid")&&o.gid==that.val&&this.nom==t.name?h=!0:(h=!1,log(" Animation Layer's name is not defined or gidValue is incorrect in tileAnimation \n\n please read the documentation so that you may use tileAnimation correctly !!")),column=Math.floor(l%tile.columns),objrow=Math.floor(l/tile.columns),(isDrawable=!(o.x+a<camera.x)&&!(o.x+a/2>camera.x+camera.width))||(h=!1),h&&(ctx.globalAlpha=1,ctx.drawImage(that.image,a*column,c*objrow,a,c,o.x*self.scale,(o.y-c)*self.scale,o.width*self.scale,o.height*self.scale))}}},that.RenderObjectLayer=function(t){for(var e of(this.gid=t,gid=this.gid,data.layers))"objectgroup"==e.type&&(tile.rows=tile.imageheight/tile.tileheight,e.objects.forEach(function(t){if(t.hasOwnProperty("gid")&&t.gid==gid){t.gid!=gid&&(t.gid=gid);var s=tile.imagewidth/tile.columns,i=tile.imageheight/tile.rows;column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),isDrawable=!(t.x+s<camera.x)&&!((t.x+s/2)*self.scale>(camera.x+camera.width)*self.scale+100),t.hasOwnProperty("gid")&&t.gid!=that.val&&!e.hasOwnProperty("properties")&&isDrawable&&(ctx.globalAlpha=1,ctx.drawImage(that.image,s*column,i*obj2row,s,i,t.x*self.scale,(t.y-t.height)*self.scale,t.width*self.scale,t.height*self.scale))}else if(t.hasOwnProperty("gid")&&"auto"==t.type){gid=t.gid;var s=tile.imagewidth/tile.columns,i=tile.imageheight/tile.rows;column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),isDrawable=!(t.x+s<camera.x)&&!((t.x+s/2)*self.scale>(camera.x+camera.width)*self.scale+100),t.hasOwnProperty("gid")&&t.gid!=that.val&&!e.hasOwnProperty("properties")&&isDrawable&&(ctx.globalAlpha=1,ctx.drawImage(that.image,s*column,i*obj2row,s,i,t.x*self.scale,(t.y-t.height)*self.scale,t.width*self.scale,t.height*self.scale))}}))},that}function canDraw(t,e){return!(t.x+t.w<e.x)&&!(t.x+t.w>e.x+e.width)&&!(t.x+t.r<e.x)&&!(t.x+t.r>e.x+e.width)}function tiledCollider(t,e){var s=Math.abs(t.y-t.h-e.y+e.height);return!e.gid&&t.x+t.w>=e.x&&t.x<=e.x+e.width&&t.y+t.h>=e.y&&t.y<=e.y+e.height||t.x+t.w>=e.x&&t.x<=e.x+e.w&&t.y+t.h>=e.y&&t.y<=e.y+e.h||!!e.gid&&t.x+t.w>=e.x&&t.x<=e.x+e.width&&t.y+t.h>=e.y&&t.y<=e.y+e.height&&s<=20||void 0}mapFromcollection.prototype.renderLayer=function(t){let e=data.tilesets;if("tilelayer"===t.type&&"objectgroup"!=t.type){let s=t.chunks;s.forEach(t=>{let s=t.data,i=e[0].tilewidth,l=e[0].tileheight;e[0].tiles,s.forEach((s,h)=>{if(null!=s){let a=new Image;try{layerImsrc=e[0].tiles[s].image,a.src=layerImsrc}catch(c){}let o=t.x+h%t.width*i,n=t.y+Math.floor(h/t.width)*l;ctx.drawImage(a,o,n,i,l)}})})}},mapFromcollection.prototype.renderObjectLaye=function(t){let e=data.tilesets;if("objectgroup"===t.type){let s=t.objects;s.forEach(t=>{let s=new Image;s.src=e[0].tiles[t.gid-1].image,ctx.drawImage(s,t.x,t.y,t.width,t.height)})}};var isX=!1;function VrpgCollider(t,e){loader&&(e.onFloor=!0,t.objects.forEach(function(t){let s=e.collider;if(e.collider){if(isCollide(s,t)){if(e.vy<0&&s.y>t.y){e.vy=0,0==e.vy&&("circle"==e.shape&&(this.shadowY=this.shadowY-27),"rect"==e.shape&&(this.shadowY=this.shadowY-33));let i=s.y-e.y;e.y=t.y+t.height-i+.01,s.y=t.y+t.height-i+.01;return}if(e.vy>0&&t.y+t.height>=s.y){e.vy=0;let l=s.y-e.y+s.h;e.y=t.y-l-.01;return}}}else e.x+e.w>=t.x&&e.x<=t.x+t.width&&e.y+e.h>=t.y&&e.y<=t.y+t.height&&(e.y=e.oldY)}))}function HrpgCollider(t,e){loader&&(e.onFloor=!0,(isX=0!=e.vx)&&(e.vy=0),0!=!e.vy&&t.objects.forEach(function(t){let s=e.collider;if(e.collider){if(isCollide(s,t)){if(e.vx>0){e.onFloor=!0,e.vy=0;let i=s.x-e.x+s.w;return e.x=t.x-i-.01,!0}if(e.vx<0){e.onFloor=!0,e.vy=0;let l=s.x-e.x;return e.x=t.x+t.width-l+.01,!0}}}else e.x+e.w>=t.x&&e.x<=t.x+t.width&&e.y+e.h>=t.y&&e.y<=t.y+t.height&&(e.x=e.oldX,e.y=e.oldY)}))}function avoidWalls(t,e,s){for(let i of t){var l=e.x-i.x;if(Math.hypot(l,e.y-i.y)<s){let h=Math.atan2(i.y-e.y,i.x-e.x);e.vx-=Math.cos(h),e.vy-=Math.sin(h)}}}function RpgFollow(t,e,s,i){this.gap=s,this.a=t,this.b=e;var l=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),h=this.a.x-this.b.x,a=Math.hypot(this.a.y-this.b.y,h);if(!(18>=Math.abs(a))&&a<=this.gap){this.b.vx=Math.cos(l),this.b.vy=Math.sin(l),this.b.x+=this.b.vx,this.b.y+=this.b.vy;let c=Math.abs(this.a.x-this.b.x);if(this.a.y,this.b.y,t.x<e.x&&c>=5)return this.b.Rside=!1,this.b.Uside=!1,this.b.Dside=!1,avoidWalls(i,e,300),this.b.Lside=!0;if(t.x>e.x&&c>=5)return this.b.Lside=!1,this.b.Uside=!1,this.b.Dside=!1,avoidWalls(i,e,300),this.b.Rside=!0;if(t.y<e.y)return this.b.Rside=!1,this.b.Dside=!1,this.b.Lside=!1,avoidWalls(i,e,300),this.b.Uside=!0;else if(t.y>e.y)return this.b.Rside=!1,this.b.Uside=!1,this.b.Lside=!1,avoidWalls(i,e,300),this.b.Dside=!0;else return this.b.vx=0,this.b.vy=0,!1}}function sideCollision(t,e){if(loader){let s=self.getObjectLayer(e);for(let i of s)if(isCollide(t,i)){let l=t.x+t.w/2-(i.x+i.width/2),h=t.y+t.h/2-(i.y+i.height/2),a=(t.w+i.width)/2,c=(t.h+i.height)/2,o=a*h,n=c*l;Math.abs(l)<=a&&Math.abs(h)<=c&&(o>n?o>-n?t.y=i.y+i.height:t.x=i.x-t.w:o>-n?t.x=i.x+i.width:t.y=i.y-i.height),t.vx=0,t.vy=0}}}function gameRadar(t,e){this.x=t,this.y=e;var s=new Image;s.src=this.x.toDataURL(),this.y.style.background=`url(${s.src})`,this.y.style.backgroundRepeat="no-repat",this.y.style.backgroundSize="cover"}var gameFrame=0,gameSpeed=5;class layerB{constructor(t,e,s,i,l,h){i!=gW&&(i=gW),this.x=e,this.y=s,this.image=t,this.w=i,this.h=l,this.speedModifier=h,this.speed=gameSpeed*this.speedModifier}update(){this.speed=gameSpeed*this.speedModifier,this.x=gameFrame*this.speed%this.w,isFake=!0}draw(){isFake=!0,ctx.save(),0==gameFrame&&ctx.drawImage(this.image,this.x,this.y,this.w,this.h),gameFrame<0?(ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x+this.w,this.y,this.w,this.h)):gameFrame>0&&(ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x-this.w,this.y,this.w,this.h)),ctx.restore()}}var isJumping=!1;function LeftCollider(t,e,s,i){for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++)if(t[l][h]==i){var a=h*s,c=l*s;if(block=new Sprite(a,c,s,s,0,0,"red"),e.collider){let o=e.collider;if(e.vx>0&&o.x+o.w>=block.x&&o.x<=block.x+block.w&&o.y+o.h>=block.y&&o.y<=block.y+block.h&&o.y>block.y){let n=o.x-e.x+o.w;e.x=block.x-n-.01;break}}else e.vx>0&&e.x+e.w>=block.x&&e.x<=block.x+block.w&&e.y+e.h>=block.y&&e.y<=block.y+block.h&&(e.x=block.x-e.w-1)}}function RightCollider(t,e,s,i){for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++)if(t[l][h]==i){var a=h*s,c=l*s;if(block=new Sprite(a,c,s,s,0,0,"red"),e.collider){let o=e.collider;if(e.vx<0&&o.x+o.w>=block.x&&o.x<=block.x+block.w&&o.y+o.h>=block.y&&o.y<=block.y+block.h&&o.y>block.y){o.y,e.y,e.x=e.oldX+.01;break}}else if(e.vx<0&&e.x+e.w>=block.x&&e.x<=block.x+block.w&&e.y+e.h>=block.y&&e.y<=block.y+block.h){e.x=block.x+block.w+1;break}}}function TopCollider(t,e,s,i){for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++){var a=h*s,c=l*s,o=[];if(t[l][h]==i){o.push(new Sprite(a,c,s,s,0,0,"red"));for(var n=0;n<o.length;n++)var f=o[n];if(e.collider){let d=e.collider;if(isCollide(d,f)&&e.vy>0&&f.y+f.h>=d.y&&f.y>=d.y+d.h/2){let $=d.y-e.y+d.h;return e.vy=0,e.onFloor=!0,e.isJumping=!1,JumpTime=0,e.y=~~(f.y-$-.01)}}else if(isCollide(body,f)&&e.vy>0&&f.y+f.h>body.y&&f.y>body.y+body.h/2){e.vy=0,0==e.vy&&("circle"==e.shape&&(this.shadowY=this.shadowY-27),"rect"==e.shape&&(this.shadowY=this.shadowY-33)),e.y=f.y-e.h-.01,JumpTime=0,e.onFloor=!0;break}}}}function BottomCollider(t,e,s,i){for(var l=0;l<t.length;l++)for(var h,a=0;a<t[0].length;a++)if(t[l][a]==i){if(h={x:tx=a*s,y:ty=l*s,w:s,h:s},e.collider){let c=e.collider;if(e.isJumping||isJumping&&e.vy<0&&c.x-e.vx+c.w>h.x-e.vx&&c.y+c.h>=h.y&&c.x-e.vx<=h.x+h.w-e.vx&&c.y<=h.y+h.h){let o=c.y-e.y;e.y=h.y+h.h-5-o+9,e.isJumping=!1,isJumping=!1,e.vy=0;break}}else if(e.isJumping||isJumping&&e.x+e.w>h.x&&e.y+e.h>=h.y&&e.x<=h.x+h.w&&e.y<=h.y+h.h){e.y=h.y+h.h+.01,e.vy=0,isJumping=!1;break}}}function LeftTiledCollider(t,e){loader&&t.objects.forEach(function(t){if(!canDraw(t,camera))return;let s=e.collider;if(isCollide(s,t)&&e.vx>0){let i=s.x-e.x+s.w;return e.x=t.x-i-.01}})}function RightTiledCollider(t,e){loader&&t.objects.forEach(function(t){if(!canDraw(t,camera))return;let s=e.collider;if(isCollide(s,t)&&e.vx<0){let i=s.x-e.x;return e.x=t.x+t.width-i+.01}})}function TopTiledCollider(t,e){loader&&t.objects.forEach(function(t){if(!canDraw(t,camera))return;let s=e.collider;if(isCollide(s,t)&&e.vy>0&&t.y+t.height>s.y&&t.y>s.y+s.h/2){let i=s.y-e.y+s.h;return e.vy=0,e.onFloor=!0,e.isJumping=!1,JumpTime=0,e.y=~~(t.y-i-.01)}})}function BottomTiledCollider(t,e){loader&&t.objects.forEach(function(t){let s=e.collider;if(canDraw(t,camera)&&e.isJumping&&e.vy<0&&s.x-e.vx+s.w>t.x-e.vx&&s.y+s.h>=t.y&&s.x-e.vx<=t.x+t.width-e.vx&&s.y<=t.y+t.height&&s.y+s.h>t.y+t.height&&s.y>t.y){e.vy=0;let i=s.y-e.y;return e.y=t.y+t.height-7-i+9,e.onFloor=!1,e.isJumping=!1}})}class Astar{constructor(){this.openList=[],this.closedList=[],this.startNode=null,this.endNode=null,this.acceptableTiles=[],this.diagonalMovement=!1}setGrid(t){return this.grid=t}setAcceptableTiles(t){return this.acceptableTiles=t}setDiagonal(t){return this.diagonalMovement=t}setIterations(t){this.timer=t||900}findPath(t,e,s,i,l){if(!this.grid||t<0||e<0||s<0||i<0||t>this.grid[0].length||e>this.grid.length||s>this.grid[0].length||i>this.grid.length){l(null);return}this.startNode=new Node(t,e),this.endNode=new Node(s,i),this.openList=[this.startNode],this.closedList=[];let h=0,a=()=>{let t=setTimeout(()=>{for(;this.openList.length>0&&h<3;){var e;let s=this.openList[0],i=0;for(let c=0;c<this.openList.length;c++)(this.openList[c].f<s.f||this.openList[c].f===s.f&&this.openList[c].h<s.h)&&(s=this.openList[c],i=c);if(this.openList.splice(i,1),this.closedList.push(s),s.x===this.endNode.x&&s.y===this.endNode.y){let o=[],n=s;for(;null!==n;)o.push({x:n.x,y:n.y}),n=n.parent;(void 0==o||null==o)&&o.push(n);try{l(o.reverse()),clearTimeout(t)}catch(f){}return}for(let d of e=this.diagonalMovement?[[1,1],[-1,1],[1,-1],[-1,-1]]:[[1,0],[-1,0],[0,1],[0,-1]]){let $=s.x+d[0],g=s.y+d[1];if($>=0&&$<this.grid[0].length&&g>=0&&g<this.grid.length){let u=new Node($,g);if(u.isWalkable=this.acceptableTiles.includes(this.grid[g][$]),u.isWalkable&&!this.closedList.some(t=>t.x===u.x&&t.y===u.y)){let w=s.g+1;this.openList.some(t=>t.x===u.x&&t.y===u.y)?w<u.g&&(u.g=w,u.f=u.g+u.h,u.parent=s):(u.g=w,u.h=Math.abs(u.x-this.endNode.x)+Math.abs(u.y-this.endNode.y),u.f=u.g+u.h,u.parent=s,this.openList.push(u))}}}}++h>=3?(l(null),clearTimeout(t)):a()},this.timer)};a()}}class Node{constructor(t,e){this.x=t,this.y=e,this.parent=null,this.g=0,this.h=0,this.isWalkable=!0}}function isFlipCollide(t,e){var s=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);if(e.r&&s<=e.r+e.r+t.w/2&&i<=e.r+e.r+t.h/2)return(!t.flipX||!(t.x<e.x))&&(!!t.flipX||!(t.x>e.x));if(void 0==e.r){var s=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);if(!t.flipX&&t.x+t.w>=e.x&&t.x<=e.x+e.w&&t.y+t.h>=e.y&&t.y<=e.y+1.8*e.h)return!0;if(t.flipX&&t.x+t.w>=e.x&&t.x-1.8*t.w<=e.x+e.w&&t.y+t.h>=e.y&&t.y<=e.y+1.8*e.h){if(t.flipX&&t.x<e.x+e.w)return;return!0}}}var partImage=new Image;function Particles(t,e,s,i,l,h){this.name=l||"rainbow",this.speed=3*Math.random()-2,this.angle=Math.random()*Math.PI*3,i.collider?(this.x=i.collider.x+s/2,this.y=i.collider.y+5):(this.x=t+s/2,this.y=e+5),this.size=s/1.5*self.scale,this.alpha=1,this.speed=1.5*Math.random()-2,this.friction=.95,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.update=function(){if(this.vx*=this.friction+.3,this.vy*=this.friction+.3,this.x+=this.vx,this.vy-=.5,frame%4==0&&(this.y+=this.vy),"fire"==this.name)this.color="#720",this.speed=3,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.y+=this.vy*this.friction,this.vx*=this.friction;else if("dust"==this.name){if(this.vx=-.5*Math.random(),this.vy=-((Math.random()+2.2)*Math.random()*2),!i.onFloor)return;this.color="lightgray",this.vy+=1.6,this.y=i.y+i.h-.4,this.y+=.9*this.vy,this.size=.8,i.vx>0&&!i.isJumping?this.x-=.5+.2*Math.random()*self.scale:i.vx>0&&i.isJumping?this.x-=.5+.2*Math.random()*self.scale:i.vx<0&&!i.isJumping?this.x-=.3*Math.random()-5:i.vx<0&&i.isJumping?this.x-=3*Math.random()-5:i.vy>0&&!i.isJumping?this.y+=-5*Math.random():i.vy<0&&!i.isJumping&&(this.y-=-5*Math.random())}else"rainbow"==this.name?(this.color="#"+Math.random().toString(16).substr(-6),this.speed=2,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.y+=this.vy*this.friction,this.vx*=this.friction):"self"==this.name?(this.color=i.color,this.speed=1.8,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.y+=this.vy*this.friction,this.vx*=this.friction):"waterfall"==this.name?(this.y-=this.vy*this.friction*2,this.size=5*Math.random()+.9,this.color="rgba(200,200,200,0.7)"):"blood"==this.name?(this.color="rgba(255,000,000,1)",this.friction=.54,this.vx*=2*this.friction,this.vy+=this.speed*delta,this.y-=this.vy*delta-1.5,this.x=this.x+.4,this.x+=this.vx*this.speed,this.size=5*Math.random()+.09):"poison"==this.name?(this.color="rgba(205,80,255,0.8)",this.friction=.04,this.vx*=this.friction,this.vy-=.5,this.y+=this.vy,this.x+=this.vx):"smoke"==this.name?(this.color="rgba(0,0,0,1)",this.friction=.4,this.vx*=this.friction,this.vy-=.5,this.y+=this.vy,this.x+=this.vx):i.color&&(this.color=i.color)},this.draw=function(){if(frame%10==0&&"dust"!=this.name)for(let t=0;t<particles.length;t++){var e=particles[t];e.dx=i.x-e.x,e.dy=i.y-e.y,particles.length>=330&&"dust"!=this.name&&(particles.length=330);var s=Math.hypot(e.dy,e.dx);"dust"!=this.name&&s>=20&&(this.alpha-=.1,this.alpha<=.1&&(particles[0]&&(this.alpha=1),kill(particles,t)))}else if(frame%2==0&&"dust"==this.name)for(let l=0;l<particles.length;l++){var e=particles[l];e.dx=i.x-e.x,e.dy=i.y-e.y;var s=Math.hypot(e.dx,e.dy);s>=2&&"dust"==this.name&&(this.alpha-=.05,this.alpha<=.3&&(particles[0]&&(this.alpha=1),kill(particles,l)))}if(i.image&&"self"==this.name){this.vx*=this.friction,this.x+=this.vx,this.y+=this.vy,partImage.src=i.image.src,canDraw(i,camera)&&ctx.drawImage(partImage,this.x*self.scale,this.y*self.scale,2.5*this.size,2.5*this.size);return}canDraw(i,camera)&&(ctx.fillStyle=this.color,"fire"==this.name?(ctx.shadowBlur=4,ctx.shadowColor="rgba(240,200,10,0.8)"):ctx.shadowColor=this.color),canDraw(i,camera)&&("poison"!=this.name&&("polygon"==i.type?(ctx.globalAlpha=this.alpha,ctx.fillRect(this.x,this.y,this.size*Math.random()*1.5+.1,this.size*Math.random()*1.5+.3)):(ctx.save(),ctx.fillRect(this.x*self.scale,this.y*self.scale,this.size*Math.random()*1.5+.1,this.size*Math.random()*1.5+.1),ctx.restore())),"poison"==this.name&&(ctx.beginPath(),"polygon"==i.type?(ctx.beginPath(),ctx.arc(this.x,this.y,this.size*Math.random()*2+.2,1.2,2*Math.PI),ctx.fill(),ctx.closePath()):(ctx.beginPath(),ctx.arc(this.x*self.scale,this.y*self.scale,this.size*Math.random()*2+.2,1.2,2*Math.PI),ctx.fill(),ctx.closePath())))}}function createParticle(t,e,s,i){this.thesize=e,this.thesize>20&&(this.thesize=20),this.target=t;for(var l=0;l<e;l++)t.image&&canDraw(this.target,camera)&&t.onFloor&&particles.push(new Particles(t.x||t.x,t.y,2.5*Math.random()+.08,t,s)),"fire"==s||"waterfall"==s||"smoke"==s||"rainbow"==s&&"dust"!=s?canDraw(this.target,camera)&&particles.push(new Particles(t.x+t.w/2||t.x,t.y,2.5*Math.random()+.2,t,s)):"dust"==s&&t.onFloor&&canDraw(this.target,camera)?particles.push(new Particles(t.x+t.w/2||t.x,t.y,2.5*Math.random()+.08,t,s)):canDraw(this.target,camera)&&"dust"!=s&&particles.push(new Particles(t.x+t.w/2||t.x,t.y,3*Math.random()+.08,t,s));return this}function hitBox(t,e,s){if(t.collider&&e.collider)var i=Math.abs(t.collider.x-e.collider.x),l=Math.abs(t.collider.y-e.collider.y);if(t.collider&&!e.collider)var i=Math.abs(t.collider.x-e.x),l=Math.abs(t.collider.y-e.y);else var i=Math.abs(t.x-e.x),l=Math.abs(t.y-e.y);if(Math.hypot(i,l)<=s){if(t.left){if(t.collider&&e.collider&&t.collider.x>e.collider.x)return!0;if(t.collider&&!e.collider){if(t.collider.x>e.x)return!0}else if(!t.collider&&!e.collider&&t.x>e.x)return!0}if(!t.left){if(t.collider&&e.collider&&t.collider.x<e.collider.x)return!0;if(t.collider&&!e.collider){if(t.collider.x<e.x)return!0}else if(!t.collider&&!e.collider&&t.x<e.x)return!0}}return!1}function SnowEffect(t){rand=Math.random()*(num=[1,-3]).length,this.space=t;for(var e={x:Math.ceil(Math.random()*camera.width)+camera.x,y:0,s:Math.floor(1*Math.random())+.5,color:"rgb(255, 255, 255)"},s=0;s<5;s+=2)snows.push(new Circle(e.x,e.y,e.s,Math.cos(num[rand]),Math.floor(.2*Math.random())+1,e.color));for(var i=0;i<snows.length;i++)snow=snows[i],snow.y+=3,(snow.y>t.height||snow.x>t.width)&&kill(snows,i)}function RainEffect(t){this.space=t;for(var e=[-1,3],s={x:Math.floor(Math.random()*camera.width)+camera.x,y:0,w:Math.floor(.2*Math.random())+.4,h:8,color:"rgba(250, 250, 250, 0.07)"},i=0;i<50;i+=2)rand=Math.random()*e.length,rains.push(new Sprite(s.x,s.y,s.w,s.h,Math.cos(e[rand]),Math.floor(3*Math.random())+5,s.color));rains.forEach(function(e,s){e.y+=30,e.y>t.height&&kill(rains,s),rains.x>t.width&&kill(rains,s)})}log("CanvasGameJs is running !!");let isPoint=!1;function renderRWayPoint(){if(isPoint){ctx.beginPath(),ctx.strokeStyle="darkblue",ctx.moveTo(wayPoints[0].x*self.scale,wayPoints[0].y*self.scale);for(let t=0;t<wayPoints.length;t++){let e=wayPoints[t];ctx.lineTo(e.x*self.scale,e.y*self.scale)}ctx.stroke(),ctx.closePath()}}let wp;function isPath(t,e,s,i){let l=!1;for(let h of i)if(lineSegmentIntersectsObstacle(e,s,h)){l=!0;break}return l?(wp=t[0],!1):(moveAlongPath(t,e,s,i),!0)}function lineSegmentIntersectsObstacle(t,e,s){let i=t.x,l=t.y,h=e.x,a=e.y,c=s.x,o=s.y,n=s.x+s.width,f=s.y+s.height,d=((n-c)*(l-o)-(f-o)*(i-c))/((f-o)*(h-i)-(n-c)*(a-l)),$=((h-i)*(l-o)-(a-l)*(i-c))/((f-o)*(h-i)-(n-c)*(a-l));return d>=0&&d<=1&&$>=0&&$<=1}function moveAlongPath(t,e,s,i){if(pathIndex<0||pathIndex>=t.length-1)return;wp=t[pathIndex],isPoint=!0;let l=wp.x-e.x,h=Math.atan2(wp.y-e.y,l),a;if(i.some(t=>lineSegmentIntersectsObstacle({x:e.x,y:e.y},{x:wp.x,y:wp.y},{x:t.x+8,y:t.y+8,width:t.width+8,height:t.height+8}))){let c=self.getAngle(e,t[0]);e.vx=1*Math.cos(c),e.vy=1*Math.sin(c)}else e.vx=1*Math.cos(h),e.vy=1*Math.sin(h);t.length>0&&(e.x+=e.vx,e.y+=e.vy,pathIndex++),Math.abs(Math.round(e.x)-Math.round(wp.x))<Math.abs(e.vx)&&Math.abs(Math.round(e.y)-Math.round(wp.y))<Math.abs(e.vy)&&pathIndex<t.length-1&&(pathIndex++,isPoint=!0,t.splice(0,pathIndex))}class GridSize{constructor(t,e){this.cellSize=t,this.grid=gW/this.cellSize,this.gridSize=this.grid}}class Snake extends GridSize{constructor(t,e,s,i,l){super(s,l),this.cellSize=s,this.color=i,this.dir={x:0,y:0},this.lost=!1,this.oldDir={x:0,y:0},this.body=[{x:t,y:e}]}update(){let t;for(t=this.body.length-1;t>0;t--)this.body[t].x=this.body[t-1].x,this.body[t].y=this.body[t-1].y;this.body[t].x+=this.dir.x*this.cellSize,this.body[t].y+=this.dir.y*this.cellSize,(this.dir.x==-this.oldDir.x&&0!=this.dir.x||this.dir.y==-this.oldDir.y&&0!=this.dir.y)&&(this.lost=!0),this.oldDir.x=this.dir.x,this.oldDir.y=this.dir.y,(this.body[0].x<=1||this.body[0].x>=gW-this.cellSize||this.body[0].y<=1||this.body[0].y>=gH-this.cellSize)&&(this.lost=!0)}draw(){for(var t=0;t<this.body.length;t++)ctx.fillStyle=this.color,ctx.fillRect(this.body[t].x,this.body[t].y,this.cellSize,this.cellSize)}}function collidedFood(t,e){if(t.x==e.x&&t.y==e.y)return!0}class Food extends GridSize{constructor(t,e,s){super(t,s),this.cellSize=t,this.color=e,this.useImage=!1,this.image=new Image,this.size=this.cellSize,this.generateFood()}generateFood(){this.randomX=Math.floor(Math.random()*this.gridSize)*this.cellSize,this.randomY=Math.floor(Math.random()*this.gridSize)*this.cellSize,this.x=this.randomX,this.y=this.randomY}update(){(this.x<0||this.x>gW-this.cellSize||this.y<0||this.y>gH-this.cellSize)&&this.generateFood()}draw(){this.useImage?ctx.drawImage(this.image,this.x,this.y,this.size,this.size):(ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.size,this.size))}}
