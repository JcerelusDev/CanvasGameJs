var camera,light,reqA,SPEED,tileAnimation,saveBg,delta,self,ctx,row,column,data,particles=[],snows=[],rains=[],pathIndex=0,isLight=!1;get=function(t){return document.querySelector(t)},getAll=function(t){return document.querySelectorAll(t)};var imSet=!1,JumpTime=0,friction=.5,isCamera=!1,objframe=0,layerframe=0,frame=0,isFake=!1,isDrawable=!1;const log=console.log;var rotImage=!1,toJson=JSON.stringify;function Stage(){function t(t,s,e){return t*(1-e)+s*e}stage=(self={stage:document.createElement("canvas")}).stage,void 0==self.scale&&(self.scale=1),self.stage.style.position="absolute",self.stage.style.zIndex=0,self.stage.style.imageRendering="pixelated",self.stage.style.background="white",self.add=function(t,s){this.b=s,void 0==s&&document.body.appendChild(t),void 0!==s&&"before"==s&&document.body.before(t)},self.delete=function(t){document.body.removeChild(t)},self.setSpriteImage=function(t,s){try{if(!Array.isArray(t))return t.image.src=s;for(let e of t)e.image.src=s}catch(i){}},self.stage.setBg=function(t){this.c=t,isFake&&(s=this.c||"transparent"),void 0==this.c||void 0==t||""==this.c?self.stage.style.background=s:isFake&&void 0==this.c||void 0==t||""==this.c?self.stage.style.background="transparent":this.c&&!isFake&&(s=this.c,self.stage.style.background=s),void 0!=this.c||isFake||(s="rgba(17,34,51,0.8)",self.stage.style.background=s)},self.setSize=function(t,s){this.a=t*self.scale,this.b=s*self.scale/1.5,this.a&&this.b&&(gW=self.stage.width=this.a,gH=self.stage.height=this.b)},void 0==this.a&&void 0==this.b&&(gW=self.stage.width=innerWidth,gH=self.stage.height=innerHeight),camera={x:1,y:1,width:gW,height:gH},self.stage.setBgRepeat=function(t){},self.stage.style.imageRendering="pixelated",ctx=self.stage.getContext("2d"),rectColor=function(t){ctx.fillStyle=t},strokeColor=function(t){ctx.strokeStyle=t},Rect=function(t,s=t.color){ctx.fillStyle=s,ctx.fillRect(t.x,t.y,t.w,t.h)},Stroke=function(t,s=t.color){ctx.strokeStyle=s,ctx.strokeRect(t.x,t.y,t.w,t.h)},self.spriteAnimator=function(t,s,e,i,l,h=!1){return this.speed=l,this.src=s,this.startIndex=i,this.nbFrame=e,this.obj=t,this.startIndex>0?this.index=frame%this.nbFrame+1:this.index=frame%this.nbFrame,this.parenth=h,this.parenth?this.anim=` ${this.src}(${this.index}).png`:this.anim=` ${this.src}${this.index}.png`,log(this.anim),frame%this.speed==0&&self.setSpriteImage(this.obj,this.anim),this.index},self.getObjectLayer=function(t){return t.objects},window.onload=function(){self.start?self.start():self.start=function(){}},self.setDetector=function(t,s=!1){t.show=s,(t.collider||"boolean"==typeof s)&&(t.detector={x:t.collider.x+12,y:t.collider.y+t.collider.h,w:18,h:6,color:"rgba(25,250,255,0.5)"},t.flipX&&(t.detector.x=t.detector.x-20))},self.isLimitReach=(t,s)=>{let e=Math.abs(t.y-s.y);return!(t.x<=s.x+s.width)||!(t.x+t.w/2.5>=s.x)||!(t.y+t.h>=e)},self.overLay=function(){opacity=1,self.stage.style.zIndex=-999;var t=document.createElement("canvas");document.body.appendChild(t),t.style.width=gW+"px",t.style.height=gH+50+"px",t.style.position="fixed",screen.width>=1e3?stage.style.scale=2:stage.style.scale=1.2,t.style.zIndex=99999,t.style.background=`rgba(0, 0, 0, ${opacity})`,t.style.marginLeft="0%",t.style.marginTop="0%",setTimeout(function(){opacity-=.02,t.style.background=`rgba(0, 0, 0, ${opacity})`},300),setTimeout(function(){opacity-=.04,t.style.background=`rgba(0, 0, 0, ${opacity})`},600),setTimeout(function(){opacity-=.06,t.style.background=`rgba(0, 0, 0, ${opacity})`},900),setTimeout(function(){opacity-=.08,t.style.background=`rgba(0, 0, 0, ${opacity})`},1e3),setTimeout(function(){opacity-=.2,t.style.background=`rgba(0, 0, 0, ${opacity})`},1200),setTimeout(function(){opacity-=.04,t.style.background=`rgba(0, 0, 0, ${opacity})`},1400),setTimeout(function(){opacity=0,t.style.background=`rgba(0, 0, 0, ${opacity})`,document.body.removeChild(t)},1500)},self.light=function(t,s,e){return isLight=!0,this.obj=t,this.radius=s,this.opacity=e,light={x:this.obj.x+this.obj.w/2,y:this.obj.y+this.obj.h/2,r:this.radius,opacity:this.opacity},this},playSound=function(t){try{this.audio=new Audio(t),this.audio.currentTime=0,this.audio.volume=.12,this.audio.play()}catch(s){}return this},stopSound=function(t){t.currentTime=0,t.audio.pause()},Text=function(t,s,e,i,l,h,a){this.x=h,this.y=a,this.color=t||"gold",this.fontsize=e,this.fontstyle=s,this.fontfamily=i,this.t=l,void 0==this.fontweight&&(this.fontweight="bold"),void 0==this.fontstyle&&(this.fontstyle="italic"),(void 0==this.fontfamily||null==this.fontfamily)&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(t,s,e,i){ctx.clearRect(t,s,e,i)},self.getDistance=function(t,s){if(this.a=t,this.b=s,"polygon"==t.type){var e=Math.abs(this.a.startX-this.b.x),i=Math.abs(this.a.startY-this.b.y),l=Math.hypot(e,i);return l}if("line"==s.type||s.x1){var e=Math.abs(this.a.x-this.b.x1),i=Math.abs(this.a.y-this.b.y1),l=Math.hypot(e,i);return l}if(void 0!=this.a.collider&&void 0!=this.b.collider){var e=Math.abs(this.a.collider.x-this.b.collider.x),i=Math.abs(this.a.collider.y-this.b.collider.y),l=Math.hypot(e,i);return l}if(!this.a.collider&&!this.b.collider){var e=Math.abs(this.a.x-this.b.x),i=Math.abs(this.a.y-this.b.y),l=Math.hypot(e,i);return l}},self.getAngle=function(t,s){var e;return this.a=t,this.b=s,this.a.startX||this.b.startX||(e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x)),"polygon"==t.type&&"polygon"==s.type&&(e=Math.atan2(this.a.startY-this.b.startY,this.a.startX-this.b.startX)),!this.a.startX&&this.b.startX&&(e=Math.atan2(this.a.y-this.b.startY,this.a.x-this.b.startX)),e},self.isClosest=function(t,s){return distance=self.getDistance(t,s)},self.setCollider=function(t,s=!1){t.isVisible=s,"boolean"==typeof s&&(t.sw>100||t.sh>100?(t.collider={x:t.x+t.w/2.14,y:t.y+t.h/3,w:t.w/8,h:t.h/3,vx:t.vx,vy:t.vy,color:"rgba(255,0,0,0.5)"},t.flipX&&(t.collider.x=t.x+t.w/2.24)):(t.collider={x:t.x+t.w/4.5,y:t.y+t.h/4.5,w:t.w/3.7,h:t.h-9,color:"rgba(255,0,0,0.5)"},t.sh!=t.sw&&(t.collider={x:t.x+t.w/4.5,y:t.y+t.h/4.5,w:Math.abs(t.w-t.sw)/1.9,h:Math.abs(t.h-t.sh)/2.2,color:"rgba(255,0,0,0.5)"},t.flipX&&(t.collider.x=t.x+3+t.w/4.5,t.collider.width=Math.abs(t.w-t.sw)/1.9)),t.image||(t.collider={x:t.x+t.w/4,y:t.y,w:t.w-10,h:t.h,color:"rgba(255,0,0,0.5)"})))},self.worldThroughCamera=function(t){return(this.area=t,loader&&!this.area)?{x:0,y:0,width:data.width*data.tilewidth,height:data.height*data.tileheight}:!loader&&this.area?{x:0,y:0,width:t.w,height:t.h}:void 0};var s,e,i,l=!1;self.setCam=function(s,e,i){if(i=i||!1,screen.width>=1e3&&(self.scale=2.5,stage.style.scale=1.7),stage.style.scale=1.2,1==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.1==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.2==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.3==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.4==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.5==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale|0,height:gH/self.scale|0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.6==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.7==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.8==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),1.9==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),2==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),2.5==self.scale&&(x=(camera={x:0,y:0,width:gW/self.scale>>0,height:gH/self.scale>>0,color:"red"}).width/2+s.w/2>>0,y=camera.height/2+s.h/2>>0),void 0==e){ctx.translate(gW/2-(s.x-5)>>0,gH/2-(s.y-5)>>0);return}return"boolean"==typeof i&&i&&(l=i),camera.x=t(camera.x,s.x+s.w+10-x,1),camera.y=t(camera.y,s.y+s.h+10-y,1),camera.x<=0&&(camera.x=0),camera.y<=0&&(camera.y=0),camera.x>=e.width-camera.width&&(camera.x=e.width-camera.width),camera.y>e.height-camera.height&&(camera.y=e.height-camera.height),s.x+camera.width*self.scale>=x&&(ctx.translate(-camera.x*self.scale|0,0),isCamera=!0),s.y+camera.height*self.scale>=y&&(ctx.translate(0,-camera.y*self.scale|0),isCamera=!0),s.x<x&&(isCamera=!1),s.y<y&&(isCamera=!1),this};let h=6;function a(t){for(rain of(clear(0,0,gW,gH),reqA=requestAnimationFrame(a),now=t,++frame%4==0&&isLayer&&(layerframe++,frame=0),frame%4==0&&isObject&&(objframe++,frame=0),(deltaTime=now-e)>i&&(delta=(deltaTime/1e3).toFixed(3),e=t-deltaTime%i,self.update(delta)),self.stage.style.imageRendering="pixelated",ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",self.stage.style.imageRendering="pixelated",self.stage.setBg(s),isFake||self.stage.setBg(s),ctx.save(),isLight?(ctx.fillStyle="transparent",ctx.fillRect(0,0,gW,gH)):isLight||(ctx.fillStyle=s,ctx.fillRect(0,0,gW,gH)),self.drawGame?self.drawGame():self.render(),particles.forEach(function(t){t.update(),t.draw()}),snows.forEach(function(t,s){canDraw(t,camera)?(ctx.beginPath(),ctx.fillStyle=t.color,ctx.arc(t.x,t.y+=t.vy,t.r,1.8,1.7*Math.PI),ctx.fill(),ctx.closePath()):kill(snows,s)}),rains)){var h=rains.indexOf(rain);ctx.save(),canDraw(rain,camera)?rain.drawSprite():kill(rains,h),ctx.restore()}isLight&&((cv=document.createElement("canvas")).width=gW,cv.height=gH,cv.style.position="absolute",ctx.save(),ctx.beginPath(),ctx.fillStyle="rgba(255,255,255,0.35)",ctx.globalCompositeOperation="lighter",ctx.arc(light.x*self.scale,light.y*self.scale,light.r,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),ctx.fillStyle=`rgba(0, 0, 0, ${light.opacity})`,ctx.globalCompositeOperation="overlay",ctx.fillRect(camera.x*self.scale,camera.y*self.scale,cv.width,cv.height),ctx.drawImage(cv,0,0)),l&&(ctx.strokeStyle=camera.color,ctx.lineWidth=2*self.scale,ctx.strokeRect(camera.x*self.scale,camera.y*self.scale,camera.width*self.scale,camera.height*self.scale)),ctx.restore()}return self.cameraShake=function(t,s){this.intensity=t,--h<=0&&(h=0);var e=setInterval(()=>{h>0&&(dx=this.intensity*(Math.random()-.5)>>0,dy=this.intensity*(Math.random()-.5)>>0,ctx.setTransform(1,0,0,1,dx,dy))},50);setTimeout(()=>{clearInterval(e),h=6,ctx.setTransform(1,0,0,1,0,0)},s)},self.setAnimation=function(t){e=0,i=1e3/t,reqA=requestAnimationFrame(a)},self.stopAnimation=function(){cancelAnimationFrame(reqA)},kill=function(t,s){return t.splice(s,1)},self.isHoriBorder=function(t,s){if(void 0==t.r&&void 0==s.x){if(t.x<=0||t.x>=s.width-t.w||t.x>=s.w-t.w)return!0}else if(void 0==t.r&&void 0!==s.x){if(t.x<=s.x||t.x>=s.width-t.w||t.x>=s.w-t.w)return!0}else if(void 0!=t.r&&void 0!=s.x){if(t.x<=s.x||t.x>=s.width-t.r||t.x>=s.w-t.r)return!0}else if(void 0!=t.r&&void 0==s.x&&(t.x<=0||t.x>=s.width-t.r||t.x>=s.w-t.r))return!0},self.isVertiBorder=function(t,s){if(void 0==t.r&&void 0!==s.x){if(t.y<=s.y||t.y>=s.height-t.h||t.y>=s.h-t.h)return!0}else if(void 0!=t.r&&void 0!==s.y&&(t.y<=s.y||t.y>=s.height-t.r||t.x>=s.h-t.r))return!0;if(void 0==t.r&&void 0==s.y){if(t.y<=0||t.y>=s.height-t.h||t.y>=s.h-t.h)return!0}else if(void 0!=t.r&&void 0==s.y&&(t.y<=0||t.y>=s.height-t.r||t.x>=s.h-t.r))return!0},self.preventOverlapping=function(t){for(let s=0;s<t.length;s++){let e=t[s];for(let i=0;i<t.length;i++){let l=t[i];if(e.checkCollision(l)){kill(t,s),kill(t,i),i>s&&i--;return}}}},self}var Deg2Rad=Math.PI/180;class Line{constructor(t,s,e,i,l,h){this.x1=t,this.x2=s,this.y1=e,this.y2=i,this.color=l,this.width=h,this.vx=0,this.vy=0,this.round=!1,this.type="line"}drawLine(){ctx.beginPath(),ctx.strokeStyle=this.color,this.round?(ctx.lineJoin="round",ctx.lineCap="round"):(ctx.lineJoin="miter",ctx.lineCap="butt"),ctx.moveTo(this.x1,this.y1),ctx.lineTo(this.x2,this.y2),ctx.lineWidth=this.width,ctx.stroke(),ctx.closePath()}updateLine(){this.x2+=this.vx*delta,this.y2+=this.vy*delta}lineItersect=function(t){var s=Game.getDistance(this,t);t.r?s<=this.y1&&t.y+t.r>=this.y1-5&&(t.y=this.y1-5-t.r,t.vy=0):s<=this.y1&&t.y+t.h>=this.y1-5&&(t.y=this.y1-5-t.h,t.vy=0)}}function PolyGons(t,s,e,i,l,h,a,c,o){this.startX=t,this.startY=s,this.sides=e,this.radius=i,this.angle=h||0,this.color=l,this.speedX=a||0,this.speedY=c||0,this.fill=o||!1,this.type="polygon",this.alpha=1,"boolean"==typeof this.fill&&(this.bullet=[],this.draw=function(){drawPolyBullet(this),ctx.beginPath(),ctx.moveTo(this.startX+this.radius*Math.cos(0+this.angle),this.startY+this.radius*Math.sin(0+this.angle));for(var t=1;t<=this.sides;t++)3==this.sides&&this.flipX?this.currentAngle=1-(t*(2*Math.PI)/this.sides+this.angle):this.currentAngle=t*(2*Math.PI)/this.sides+this.angle,this.fill?this.fill&&(this.x=this.startX+this.radius*Math.cos(this.currentAngle),this.y=this.startY+this.radius*Math.sin(this.currentAngle),this.alpha,ctx.globalAlpha=this.alpha,ctx.fillStyle=this.color,ctx.lineTo(this.x,this.y),ctx.fill()):(this.x=this.startX+this.radius*Math.cos(this.currentAngle),this.y=this.startY+this.radius*Math.sin(this.currentAngle),ctx.strokeStyle=this.color,ctx.lineWidth=1.5,ctx.lineTo(this.x,this.y),ctx.stroke());ctx.lineTo(this.startX+this.radius*Math.cos(0+this.angle),this.startY+this.radius*Math.sin(0+this.angle)),this.fill?this.fill&&(ctx.fillStyle=this.color,ctx.fill()):(this.alpha,ctx.globalAlpha=this.alpha,ctx.strokeStyle=this.color,ctx.lineWidth=1.5,ctx.stroke()),ctx.closePath()},this.update=function(){this.startX+=this.speedX,this.startY+=this.speedY,this.angle>0&&(this.angle+=.01)},this.addBullet=function(t,s,e,i,l,h,a){this.obj={x:t,y:s,w:e,h:i,color:l,r:h,angle:a,direction:this.direction},(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj),this.direction=function(){return this.speedX>0?1:this.speedX<0?-1:this.speedY>0?(this.speedX=0,2):this.speedY<0?-2:void 0}},this.checkCollision=function(t){var s=this.startX-t.startX,e=this.startY-t.startY;return Math.sqrt(s*s+e*e)<this.radius+t.radius})}function drawPolyBullet(t){this.isRot,this.bullet=t.bullet;for(let s=0;s<this.bullet.length;s++)(bul=this.bullet[s]).image||(ctx.fillStyle=bul.color,!this.isRot&&-1==this.direction||1==this.direction||-2==this.direction||2==this.direction&&bul.w>0?ctx.fillRect(bul.x*self.scale,bul.y*self.scale,bul.w*self.scale,bul.h*self.scale):(!this.isRot&&-1==this.direction||1==this.direction||-2==this.direction||2==this.direction&&bul.w<0)&&(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),0!=bul.w||0!=bul.h||bul.angle?0==bul.w&&0==bul.h&&0!=bul.angle?(ctx.beginPath(),ctx.arc(bul.x*self.scale,bul.y*self.scale,bul.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),bul.x+=3.5*Math.cos(bul.angle+90*Deg2Rad),bul.y+=3.5*Math.sin(bul.angle+90*Deg2Rad),this.isRot=!0):0!=bul.w&&0!=bul.h&&0!=bul.angle&&(ctx.save(),ctx.translate((bul.x+bul.w/2)*self.scale,(bul.y+bul.h/2)*self.scale),ctx.rotate(bul.angle+90*Deg2Rad),ctx.fillRect(-this.bullet[s].w/2*self.scale,-this.bullet[s].h/2*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore(),bul.x+=3.5*Math.cos(bul.angle+90*Deg2Rad),bul.y+=3.5*Math.sin(bul.angle+90*Deg2Rad),this.isRot=!0):(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()))}function isCollideBoxPolygon(t,s){var e=t.startX-t.radius,i=t.startX+t.radius,l=t.startY-t.radius,h=t.startY+t.radius;if(void 0==s.w){var a=t.startX-s.x,c=t.startY-s.y;if(Math.sqrt(a*a+c*c)<=s.r+t.radius/2+s.r)return!0}else var o=s.x;var n=s.x+s.w,f=s.y,d=s.y+s.h;return!!(i>=o)&&!!(e<=n)&&!!(h>=f)&&!!(l<=d)}function isOverlap(t,s){var e=Math.abs(s.x-(t.x+t.w/2)),i=Math.abs(s.y-(t.y+t.h/2));if(e<=s.r+s.r+t.w/2&&i<=s.r+s.r+t.h/2)return!0}function isCollide(t,s){return!!(t.x+t.w>s.x)&&!!(t.x<s.x+s.w)&&!!(t.y+t.h>s.y)&&!!(t.y<s.y+s.h)||!!(t.x+t.w>s.x)&&!!(t.x<s.x+s.width)&&!!(t.y+t.h>s.y)&&!!(t.y<s.y+s.height)}function isInterCirc(t,s){if(dx=t.x-s.x,dy=t.y-s.y,sumr=t.r+s.r,(distance=Math.sqrt(dx*dx+dy*dy))<=sumr)return!0}function tileMap(t,s,e,i,l,h,a,c,o){return this.image=new Image,this.image.src=a,this.lev=t,this.total=i,this.colTCount=s,this.rowTCount=t.length,this.ts=l*self.scale,this.s=h*self.scale,this.w=c,this.h=o,this.image.onload=()=>this.drawLayer(),this.drawLayer=function(){for(var t=0;t<this.rowTCount;t++)for(var s=0;s<this.colTCount;s++){var e=this.lev[t][s],i=e/this.total>>0,a=e%this.total>>0;(isDrawable=!(a+l<camera.x)&&!(a+l>camera.x+camera.width+100))&&(void 0==this.w&&void 0==this.h&&ctx.drawImage(this.image,a*l,i*l,l*self.scale,l*self.scale,s*h,t*h,h*self.scale,h*self.scale),void 0!=this.w&&void 0!=this.h&&ctx.drawImage(this.image,a*l,i*l,l*self.scale,l*self.scale,s*h,t*h,this.w*self.scale,this.h*self.scale))}},this}function isFollow(t,s,e){if(s.goLeft=!1,s.goRight=!1,e|=140,s.collider&&t.collider){var i=Math.abs(t.collider.x-s.collider.x),l=Math.abs(t.collider.y-s.collider.y);return i<=20&&i>=-25?void 0:i<=e&&l<=5&&s.collider.x>t.collider.x?(s.goLeft=!0,s.goRight=!1,!0):i<=e&&l<=5&&s.collider.x<t.collider.x&&(s.goLeft=!1,s.goRight=!0,!0)}}function createGrid(t,s,e,i){this.gap=t,this.w=s,this.h=e,this.color=i,this.drawGrid=function(){ctx.beginPath();for(var t=this.gap;t<this.w;t+=this.gap)ctx.moveTo(t*self.scale,0),ctx.lineTo(t*self.scale,this.h*self.scale),ctx.strokeStyle=this.color,ctx.stroke(),ctx.closePath();for(var s=this.gap;s<this.h;s+=this.gap)ctx.beginPath(),ctx.moveTo(0,s*self.scale),ctx.lineTo(this.w*self.scale,s*self.scale),ctx.strokeStyle=this.color,ctx.stroke(),ctx.closePath()}}function addNumber(t,s,e,i,l,h){return this.col=t,this.row=s,this.tSize=e,this.color=i,this.spaceX=l,this.spaceY=h,this.show=()=>{for(var t=0;t<=this.row;t++)for(var s=0;s<=this.col;s++){var e=s+t*this.col;ctx.font="12px arial bold",ctx.fillStyle=this.color,ctx.fillText(e,s*this.tSize*self.scale+this.spaceX*self.scale,t*this.tSize*self.scale+this.spaceY*self.scale)}},this}Sprite=function(t,s,e,i,l,h,a,c,o){this.x=t,this.y=s,this.w=e,this.h=i,this.vx=l,this.vy=h,this.id=o,this.rotation=c||0,this.angle=0,this.flipX=!1,this.flipY=!1,this.left=!1,this.hasShadow=!1,this.setGravity=function(t){this.gravity=t,this.createShadow},this.isJumping=!1,this.color=a,this.setBody=t=>{this.gv=t,void 0==this.gv?(this.setGravity(35),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy)):(this.setGravity(this.gv),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy))},this.Rotation=function(){ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.angle),ctx.translate(-this.x*self.scale,-this.y*self.scale)},this.createShadow=function(t){this.shape=t,this.hasShadow=!0,this.shadowY=this.y+this.h+4.2*this.r,this.collider?this.r=this.collider.w/1.5:this.r=this.w/1.5},this.color||(this.image=new Image),this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.scale(1,.5),ctx.fillStyle="rgba(0,0,0,0.5)",ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?ctx.fillRect(this.collider.x*self.scale,this.shadowY*self.scale,this.collider.w*self.scale,this.collider.h*self.scale):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0?this.left=!1:this.vx<0&&(this.left=!0);for(var t=!1,s=0;s<this.bullet.length;s++){var e=this.bullet[s];e.image||(ctx.fillStyle=e.color,(t||-1!=this.direction)&&1!=this.direction&&-2!=this.direction&&this.direction,(0!=e.w||0!=e.h||e.angle||-1!=this.direction)&&1!=this.direction&&-2!=this.direction&&2!=this.direction?0==e.w&&0==e.h&&0!=e.angle?(ctx.save(),ctx.beginPath(),ctx.arc(e.x-20*self.scale,e.y+2*self.scale,e.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),e.x+=3.5*Math.cos(e.angle+90*Deg2Rad),e.y+=3.5*Math.sin(e.angle+90*Deg2Rad),t=!0,ctx.restore()):0!=e.w&&0!=e.h&&0!=e.angle&&(ctx.save(),ctx.translate((e.x+e.w/2)*self.scale,(e.y+e.h/2)*self.scale),ctx.rotate(e.angle),ctx.fillRect(-this.bullet[s].w/2*self.scale,-this.bullet[s].h/2*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore(),e.x+=3.5*Math.cos(e.angle+90*Deg2Rad),e.y+=3.5*Math.sin(e.angle+90*Deg2Rad),t=!0):(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),e.image&&e.angle&&(ctx.save(),ctx.translate((e.x+e.w/2)*self.scale,(e.y+e.h/2)*self.scale),ctx.rotate(e.angle),ctx.drawImage(this.bullet[s].image,-(this.bullet[s].w/2)*self.scale,-(this.bullet[s].h/2)*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore(),e.x+=3.5*Math.cos(e.angle+90*Deg2Rad),e.y+=3.5*Math.sin(e.angle+90*Deg2Rad),t=!0)}if(this.flipX&&!this.rotation)for(var s=0;s<this.bullet.length;s++){if(this.bullet[s].image){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}if(this.bullet[s].w>0&&this.bullet[s].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[s].color,ctx.fillRect(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}if(0==this.bullet[s].w&&0==this.bullet[s].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.rotation&&!this.flipX&&!rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.translate(-this.x*self.scale,-this.y*self.scale),ctx.restore();return}if(this.rotation&&this.flipX&&!rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,1),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle){ctx.save(),ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),this.isVisible&&(ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale),this.flipX&&(ctx.save(),ctx.scale(-1,1),ctx.fillRect(-(this.collider.x+4.2)*self.scale,this.collider.y*self.scale,-this.w/2*self.scale,this.collider.h*self.scale),ctx.restore()))},this.reverse=!1,this.drawSpriteImg=function(){if(this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.fillStyle="rgba(0,0,0,0.5)",ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?ctx.fillRect(this.collider.x*self.scale,this.shadowY*self.scale,this.collider.w*self.scale,this.collider.h*self.scale):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0?this.left=!1:this.vx<0&&(this.left=!0),this.isVisible&&(ctx.save(),ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale),ctx.restore()),this.show&&(ctx.save(),ctx.fillStyle=this.detector.color,ctx.fillRect(this.detector.x*self.scale,this.detector.y*self.scale,this.detector.w*self.scale,this.detector.h*self.scale),ctx.restore()),this.flipX&&!rotImage)for(var t=0;t<this.bullet.length;t++){if(imSet){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[t].image,-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore();return}for(var s=0;s<this.bullet.length;s++){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[s].color,ctx.fillRect((-this.bullet[s].x-this.bullet[s].w)*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.globalAlpha=1,ctx.restore();return}}for(var e=!1,t=0;t<this.bullet.length;t++){var i=this.bullet[t];if(i.image||(ctx.fillStyle=this.bullet[t].color,(e||-1!=i.direction)&&1!=i.direction&&-2!=i.direction&&2!=i.direction||ctx.fillRect(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),0==this.bullet[t].w&&0==this.bullet[t].h&&void 0==i.angle&&-1==this.direction||1==this.direction||-2==this.direction||2==this.direction?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()):0==this.bullet[t].w&&0==this.bullet[t].h&&void 0!=i.angle?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),i.x+=3.5*Math.cos(i.angle+90*Deg2Rad),i.y+=3.5*Math.sin(i.angle+90*Deg2Rad),e=!0):0!=i.r||void 0==i.angle||(ctx.save(),ctx.translate((i.x+i.w/2)*self.scale,(i.y+i.h/2)*self.scale),ctx.rotate(i.angle),ctx.fillRect(-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore(),i.x+=3.5*Math.cos(i.angle-90*Deg2Rad),i.y+=3.5*Math.sin(i.angle-90*Deg2Rad),e=!0)),i.image&&((e||-1!=i.direction)&&1!=i.direction&&-2!=i.direction&&2!=i.direction||i.flipX||ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),void 0!=i.angle&&(ctx.save(),ctx.translate((i.x+i.w/2)*self.scale,(i.y+i.h/2)*self.scale),ctx.rotate(i.angle),ctx.drawImage(this.bullet[t].image,-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore(),i.x+=3.5*Math.cos(i.angle+90*Deg2Rad),i.y+=3.5*Math.sin(i.angle+90*Deg2Rad),e=!0)),this.bullet[t].image&&this.bullet[t].flipX){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[t].image,-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore();return}if(this.bullet[t].image&&this.bullet[t].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,-this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,-this.bullet[t].h*self.scale),ctx.restore();return}}if(this.angle&&"up"==this.look||this.angle&&"down"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle),this.angle<=3&&this.reverse&&ctx.scale(1,-1),this.angle<=-0&&this.reverse&&ctx.scale(1,-1),ctx.drawImage(this.image,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle&&"left"==this.look||"right"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle+90*Deg2Rad),this.angle<=3&&this.reverse&&ctx.scale(1,-1),this.angle<=-0&&this.reverse&&ctx.scale(1,-1),ctx.drawImage(this.image,-this.w/8*self.scale,-this.h/8*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.flipX&&!this.rotation)for(var t=0;t<this.bullet.length;t++)if(this.bullet[t].image)ctx.drawImage(this.bullet[t].image,-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.globalAlpha=1;else{if(this.bullet[t].w>0&&this.bullet[t].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[t].color,ctx.fillRect(-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore();return}if(0==this.bullet[t].w&&0==this.bullet[t].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.flipX&&!rotImage){if(rotImage)return;ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.image,-this.x*self.scale,this.y*self.scale,-this.w*self.scale,this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipX&&imSet&&!rotImage){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.flipY&&!this.rotation&&!rotImage&&imSet){if(rotImage)return;ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipY&&!this.rotation){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.rotation&&(rotImage=!0),this.rotation&&this.flipX&&rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,1),ctx.rotate(this.rotation),ctx.drawImage(this.image,-this.w/8,-this.h/8,this.w,this.h),ctx.restore();return}if(this.rotation&&!this.flipX&&rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.rotation+90*Deg2Rad),ctx.drawImage(this.image,-this.w/8,-this.h/8,this.w,this.h),ctx.restore();return}},this.addBullet=function(t,s,e,i,l,h,a){this.obj={x:t,y:s,w:e,h:i,color:l,r:h,angle:a,direction:this.direction()},(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)},this.addBulletIm=function(t,s,e,i,l,h){this.obj={x:t,y:s,w:e,h:i,flipX:!1,flipY:!1,angle:h,direction:this.direction()},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)},this.direction=function(){return this.vx>0?1:this.vx<0?-1:this.vy>0?(this.vx=0,2):this.vy<0?-2:void 0};var n=0;this.SpriteRot=function(){n+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,n)},this.drawSpriteRot=function(t,s,e,i,l){ctx.save(),ctx.translate(t,s),ctx.rotate(l*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-e/2*self.scale,-i/2*self.scale,e*self.scale,i*self.scale),ctx.restore()};var n=0;this.SpriteImgRot=function(){n+=8,this.drawSpriteImgRot(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale,n)},this.drawSpriteImgRot=function(t,s,e,i,l,h){return ctx.save(),ctx.translate(s,e),ctx.rotate(h*Deg2Rad),ctx.drawImage(this.image,-i/2*self.scale,-l/2*self.scale,i*self.scale,l*self.scale),ctx.restore(),this}},Circle=function(t,s,e,i,l,h,a){this.x=t,this.y=s,this.r=e,this.vx=i,this.vy=l,this.id=a,this.left=!1,this.setGravity=function(t){this.gravity=t,this.isDrawn=!1,this.hasShadow=!1},this.color=h,this.bullet=[],this.bullet.image=new Image,this.createShadow=function(t){this.shape=t,this.hasShadow=!0,this.shadowY=this.y+this.h+4.2*this.r,this.collider?this.r=this.collider.w/1.5:this.r=this.w/1.5},this.setBody=t=>{this.gv=t,void 0==this.gv?(this.setGravity(35),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy)):(this.setGravity(this.gv),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy))},this.drawCirc=function(){for(b of(this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.scale(1,.5),ctx.fillStyle="rgba(0,0,0,0.5)",ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?ctx.fillRect(this.collider.x*self.scale,this.shadowY*self.scale,this.collider.w*self.scale,this.collider.h*self.scale):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0?this.left=!1:this.vx<0&&(this.left=!0),ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x*self.scale,this.y*self.scale,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),this.isDrawn=!0,this.bullet))ctx.fillStyle=b.color,b.w>0&&b.h>0&&(ctx.fillStyle=ctx.fillRect(b.x*self.scale,b.y*self.scale,b.w*self.scale,b.h*self.scale)),0==b.w&&0==b.h&&(ctx.beginPath(),ctx.arc(b.x*self.scale,b.y*self.scale,b.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())},this.addBullet=function(t,s,e,i,l,h){this.obj={x:t,y:s,w:e,h:i,color:l,r:h,direction:this.direction()},(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)},this.addBulletIm=function(t,s,e,i,l){this.obj={x:t,y:s,w:e,h:i,flipX:!1,flipY:!1,direction:this.direction()},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,(this.obj.direction||this.obj.angle)&&this.bullet.push(this.obj)}},this.direction=function(){return this.vx<0?-1:this.vx>0?1:this.vy<0?-2:this.vy>0?2:void 0},SpriteSheet=function(t,s,e,i,l,h,a,c,o,n,f){this.row=s,this.col=t,this.sw=e,this.sh=i,this.x=l,this.y=h,this.w=a,this.h=c,this.vx=o,this.vy=n,this.id=f,this.angle=0,this.flipX=!1,this.flipY=!1,this.left=!1,this.isFalling=!1,this.hasShadow=!1,this.setGravity=function(t){this.gravity=t,this.isDrawn=!1,this.hasShadow=!1},this.reverse=!1,this.createShadow=function(t){this.shape=t,this.hasShadow=!0,this.onFloor&&0===Math.floor(this.vy)?this.shadowY=this.collider.y+this.collider.h+3:this.isFalling?this.shadowY=this.collider.y+2*this.collider.h:this.vy<0&&(this.shadowY=this.collider.y+2*this.collider.h),this.collider?this.r=this.collider.w/1.5:this.r=this.w/1.5},this.setBody=t=>{this.gv=t,void 0==this.gv?(this.setGravity(40),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy),this.hasShadow=!1):(this.setGravity(this.gv),this.vy+=.016*this.gravity,this.y+=Math.floor(this.vy))},this.isVisible=!1,this.show=!1,imSet=!0,this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){if(this.vy>0&&(this.isFalling=!0),this.hasShadow&&(ctx.save(),"circle"==this.shape&&(ctx.beginPath(),ctx.scale(1,.5),ctx.fillStyle="rgba(0,0,0,0.5)",this.flipX?(ctx.arc((this.x+6+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill()):(ctx.arc((this.x+this.w/2)*self.scale,this.shadowY*self.scale*2,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),"rect"==this.shape&&(ctx.fillStyle="rgba(0,0,0,0.5)",this.collider?(this.flipX,ctx.fillRect(this.collider.x*self.scale,(this.shadowY+5)*self.scale,this.collider.w*self.scale,this.collider.h/2*self.scale)):ctx.fillRect(this.x*self.scale,this.shadowY*self.scale,this.w*self.scale,this.h*self.scale)),ctx.restore()),this.vx>0&&(this.left=!1),this.vx<0&&(this.left=!0),this.angle&&"up"==this.look||this.angle&&"down"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle),this.angle<=3&&ctx.scale(1,-1),this.angle<=-0&&ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle&&"left"==this.look||this.angle&&"right"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle+90*Deg2Rad),this.angle<=3&&this.reverse&&ctx.scale(1,-1),this.angle<=-0&&this.reverse&&ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}this.isRot=!1;for(var t=0;t<this.bullet.length;t++){var s=this.bullet[t];if(s.image||(ctx.fillStyle=this.bullet[t].color,this.isRot||void 0!=this.angle||(log(this.angle),ctx.fillRect(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale)),0==this.bullet[t].w&&0==this.bullet[t].h&&void 0==this.bullet[t].angle?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()):0==this.bullet[t].w&&0==this.bullet[t].h&&void 0!=s.angle?(ctx.beginPath(),ctx.arc(this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),s.x+=3.5*Math.cos(s.angle+90*Deg2Rad),s.y+=3.5*Math.sin(s.angle+90*Deg2Rad)):0==s.r&&void 0!=this.angle&&(ctx.save(),ctx.translate((s.x+s.w/2)*self.scale,(s.y+s.h/2)*self.scale),s.x+=3.5*Math.cos(s.angle+90*Deg2Rad),s.y+=3.5*Math.sin(s.angle+90*Deg2Rad),ctx.rotate(s.angle),ctx.fillRect(-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),this.isRot=!0,ctx.restore())),s.image&&((this.isRot||-1!=s.direction)&&1!=s.direction&&-2!=s.direction&&2!=s.direction||s.flipX||ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),void 0!=s.angle&&(ctx.save(),ctx.translate((s.x+s.w/2)*self.scale,(s.y+s.h/2)*self.scale),ctx.rotate(s.angle),ctx.drawImage(this.bullet[t].image,-this.bullet[t].w/2*self.scale,-this.bullet[t].h/2*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore(),s.x+=15*Math.cos(s.angle+90*Deg2Rad),s.y+=15*Math.sin(s.angle+90*Deg2Rad),this.isRot=!0)),this.bullet[t].image&&this.bullet[t].flipX&&(ctx.save(),ctx.scale(-1,1),ctx.globalAlpha=1,ctx.drawImage(this.bullet[t].image,-(this.bullet[t].x-5)*self.scale,this.bullet[t].y*self.scale,-this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.restore()),this.bullet[t].image&&this.bullet[t].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[t].image,this.bullet[t].x*self.scale,-this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,-this.bullet[t].h*self.scale),ctx.restore();return}}if(this.flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.restore();return}this.flipX&&(ctx.save(),ctx.scale(-1,1),ctx.globalAlpha=1,ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-((this.x+5)*self.scale)-this.w*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore()),this.flipX||this.rotation||this.angle||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),this.isVisible&&(ctx.save(),ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale),ctx.restore()),this.show&&(ctx.save(),ctx.fillStyle=this.detector.color,ctx.fillRect(this.detector.x*self.scale,this.detector.y*self.scale,this.detector.w*self.scale,this.detector.h*self.scale),ctx.restore())},this.addBullet=function(t,s,e,i,l,h,a){this.obj={x:t,y:s,w:e,h:i,color:l,r:h,angle:a,direction:this.direction()},this.bullet.push(this.obj)},this.addBulletIm=function(t,s,e,i,l,h){this.obj={x:t,y:s,w:e,h:i,flipX:!1,flipY:!1,angle:h,direction:this.direction()},this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)},this.direction=function(){return this.vx>0?1:this.vx<0?-1:this.vy>0?2:this.vy<0?-2:void 0};var d=0;this.SpriteSheetRot=function(){d+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,d)},this.drawSpriteSheetRot=function(t,s,e,i,l,h,a,c,o,n){ctx.save(),ctx.translate(h*self.scale,a*self.scale),ctx.rotate(n*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-(c/2)*self.scale,-(o/2)*self.scale,c*self.scale,o*self.scale),ctx.restore()}};let loader=!1,that;var isLayer=!1,isObject=!1;function tiledMap(t,s,e){that=this,that.path=t,that.image=s=new Image,that.size=e,that.load=function(){(xhr=new XMLHttpRequest).onload=function(){if(4==this.readyState){try{data=JSON.parse(xhr.response)}catch(t){}loader=!0,that.loadTileset(data)}},xhr.open("get",that.path),xhr.send(!0)},that.loadTileset=function(t){var s=/..\/+/;for(tile of data.tilesets)that.image.src=tile.image.replace(s,"")},animL=[];var i=!1;return that.renderLayer=function(t){for(r=0;r<t.height;r++)for(col=0;col<t.width;col++){let s=col+r*t.width,l=t.data[s];tX=--l%(tile.imagewidth/e)*e,tY=~~(l/(tile.imagewidth/e))*e,dX=s%t.width*e,dY=~~(s/t.width)*e,(isDrawable=!(dX+e<camera.x||dX+e>camera.x+camera.width+100&&dY+e<camera.y||dY+e>camera.y+camera.height+100))&&(ctx.globalAlpha=1,ctx.drawImage(that.image,tX,tY,e,e,dX*self.scale,dY*self.scale,e*self.scale,e*self.scale)),tile.tiles&&tile.tiles.forEach((h,a)=>{if(animL.push(h),0!=l&&void 0!=animL[l]||null!=animL[l]){i=!0;var c=animL[l].animation;tIndex=layerframe%(numFrames=c.length),i&&l==h.id&&(tX=(l=c[tIndex].tileid+1)%(tile.imagewidth/e)*e,tY=Math.floor(l/(tile.imagewidth/e))*e,dX=s%t.width*e,dY=Math.floor(s/t.width)*e,(isDrawable=!(dX+e<camera.x||dX+e>camera.x+camera.width+100&&dY+e<camera.y||dY+e>camera.y+camera.height+100))&&(isLayer=!0),ctx.globalAlpha=1,ctx.drawImage(that.image,tX,tY,e,e,dX*self.scale,dY*self.scale,e*self.scale,e*self.scale))}})}var h=!1;self.objectAnimation=tileAnimation=function(s,e){for(t of(that.val=s,this.nom=e,data.layers))if("objectgroup"==t.type&&this.nom==t.name&&tile.tiles)for(let i of(isObject=!0,tile.tiles)){frameIndex=objframe%(anim=i.animation).length,l=anim[frameIndex].tileid,tileColumns=tile.imagewidth/tile.tilewidth,tileRows=tile.imageheight/tile.tileheight;var l,a=tile.tileheight,c=tile.tilewidth;for(var o of t.objects)o.hasOwnProperty("gid")&&o.gid==that.val&&this.nom==t.name?h=!0:(h=!1,log(" Animation Layer's name is not defined or gidValue is incorrect in tileAnimation \n\n please read the documentation so that you may use tileAnimation correctly !!")),column=Math.floor(l%tile.columns),objrow=Math.floor(l/tile.columns),(isDrawable=!(o.x+a<camera.x)&&!(o.x+a/2>camera.x+camera.width))||(h=!1),h&&(ctx.globalAlpha=1,ctx.drawImage(that.image,a*column,c*objrow,a,c,o.x*self.scale,(o.y-c)*self.scale,o.width*self.scale,o.height*self.scale))}}},that.RenderObjectLayer=function(t){for(var s of(this.gid=t,gid=this.gid,data.layers))"objectgroup"==s.type&&(tile.rows=tile.imageheight/tile.tileheight,s.objects.forEach(function(t){if(t.hasOwnProperty("gid")&&t.gid==gid){t.gid!=gid&&(t.gid=gid);var e=tile.imagewidth/tile.columns,i=tile.imageheight/tile.rows;column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),isDrawable=!(t.x+e<camera.x)&&!((t.x+e/2)*self.scale>(camera.x+camera.width)*self.scale+100),t.hasOwnProperty("gid")&&t.gid!=that.val&&!s.hasOwnProperty("properties")&&isDrawable&&(ctx.globalAlpha=1,ctx.drawImage(that.image,e*column,i*obj2row,e,i,t.x*self.scale,(t.y-t.height)*self.scale,t.width*self.scale,t.height*self.scale))}else if(t.hasOwnProperty("gid")&&"auto"==t.type){gid=t.gid;var e=tile.imagewidth/tile.columns,i=tile.imageheight/tile.rows;column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),isDrawable=!(t.x+e<camera.x)&&!((t.x+e/2)*self.scale>(camera.x+camera.width)*self.scale+100),t.hasOwnProperty("gid")&&t.gid!=that.val&&!s.hasOwnProperty("properties")&&isDrawable&&(ctx.globalAlpha=1,ctx.drawImage(that.image,e*column,i*obj2row,e,i,t.x*self.scale,(t.y-t.height)*self.scale,t.width*self.scale,t.height*self.scale))}}))},that}function canDraw(t,s){return!(t.x+t.w<s.x)&&!(t.x+t.w>s.x+s.width)&&!(t.x+t.r<s.x)&&!(t.x+t.r>s.x+s.width)}function tiledCollider(t,s){var e=Math.abs(t.y-t.h-s.y+s.height);return!s.gid&&t.x+t.w>=s.x&&t.x<=s.x+s.width&&t.y+t.h>=s.y&&t.y<=s.y+s.height||t.x+t.w>=s.x&&t.x<=s.x+s.w&&t.y+t.h>=s.y&&t.y<=s.y+s.h||!!s.gid&&t.x+t.w>=s.x&&t.x<=s.x+s.width&&t.y+t.h>=s.y&&t.y<=s.y+s.height&&e<=20||void 0}var isX=!1;function VrpgCollider(t,s){loader&&(s.onFloor=!0,t.objects.forEach(function(t){let e=s.collider;if(s.collider){if(isCollide(e,t)){if(s.vy<0&&e.y>t.y){s.vy=0,0==s.vy&&("circle"==s.shape&&(this.shadowY=this.shadowY-27),"rect"==s.shape&&(this.shadowY=this.shadowY-33));let i=e.y-s.y;s.y=t.y+t.height-i+.01,e.y=t.y+t.height-i+.01;return}if(s.vy>0&&t.y+t.height>=e.y){s.vy=0;let l=e.y-s.y+e.h;s.y=t.y-l-.01;return}}}else s.x+s.w>=t.x&&s.x<=t.x+t.width&&s.y+s.h>=t.y&&s.y<=t.y+t.height&&(s.y=s.oldY)}))}function HrpgCollider(t,s){loader&&(s.onFloor=!0,(isX=0!=s.vx)&&(s.vy=0),0!=!s.vy&&t.objects.forEach(function(t){let e=s.collider;if(s.collider){if(isCollide(e,t)){if(s.vx>0){s.vy=0;let i=e.x-s.x+e.w;return s.x=t.x-i-.01,!0}if(s.vx<0){s.onFloor=!0,s.vy=0;let l=e.x-s.x;return s.x=t.x+t.width-l+.01,!0}}}else s.x+s.w>=t.x&&s.x<=t.x+t.width&&s.y+s.h>=t.y&&s.y<=t.y+t.height&&(s.x=s.oldX,s.y=s.oldY)}))}function RpgFollow(t,s,e){this.gap=e,this.a=t,this.b=s;var i=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x);this.a.x,this.b.x,this.a.y,this.b.y;var l=self.getDistance(this.a,this.b);if(!(18>=Math.abs(l))&&l<=this.gap){this.b.x+=this.b.vx,this.b.y+=this.b.vy,this.b.vx=Math.cos(i),this.b.vy=Math.sin(i),this.b.x+=this.b.vx,this.b.y+=this.b.vy;let h=Math.abs(this.a.x-this.b.x);if(this.a.y,this.b.y,t.x<s.x&&h>=5)return this.b.Rside=!1,this.b.Uside=!1,this.b.Dside=!1,this.b.Lside=!0;if(t.x>s.x&&h>=5)return this.b.Lside=!1,this.b.Uside=!1,this.b.Dside=!1,this.b.Rside=!0;if(t.y<s.y)return this.b.Rside=!1,this.b.Dside=!1,this.b.Lside=!1,this.b.Uside=!0;else if(t.y>s.y)return this.b.Rside=!1,this.b.Uside=!1,this.b.Lside=!1,this.b.Dside=!0;else return this.b.vx=0,this.b.vy=0,!1}}function gameRadar(t,s){this.x=t,this.y=s;var e=new Image;e.src=this.x.toDataURL(),this.y.style.background=`url(${e.src})`,this.y.style.backgroundRepeat="no-repat",this.y.style.backgroundSize="cover"}var gameFrame=0,gameSpeed=5;class layerB{constructor(t,s,e,i,l,h){i!=gW&&(i=gW),this.x=s,this.y=e,this.image=t,this.w=i,this.h=l,this.speedModifier=h,this.speed=gameSpeed*this.speedModifier}update(){this.speed=gameSpeed*this.speedModifier,this.x=gameFrame*this.speed%this.w,isFake=!0}draw(){isFake=!0,ctx.save(),0==gameFrame&&ctx.drawImage(this.image,this.x,this.y,this.w,this.h),gameFrame<0?(ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x+this.w,this.y,this.w,this.h)):gameFrame>0&&(ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x-this.w,this.y,this.w,this.h)),ctx.restore()}}var isJumping=!1;function LeftCollider(t,s,e,i){for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++)if(t[l][h]==i){var a=h*e,c=l*e;if(block=new Sprite(a,c,e,e,0,0,"red"),s.collider){let o=s.collider;if(s.vx>0&&o.x+o.w>=block.x&&o.x<=block.x+block.w&&o.y+o.h>=block.y&&o.y<=block.y+block.h&&o.y>block.y){let n=o.x-s.x+o.w;s.x=block.x-n-.01;break}}else s.vx>0&&s.x+s.w>=block.x&&s.x<=block.x+block.w&&s.y+s.h>=block.y&&s.y<=block.y+block.h&&(s.x=block.x-s.w-1)}}function RightCollider(t,s,e,i){for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++)if(t[l][h]==i){var a=h*e,c=l*e;if(block=new Sprite(a,c,e,e,0,0,"red"),s.collider){let o=s.collider;if(s.vx<0&&o.x+o.w>=block.x&&o.x<=block.x+block.w&&o.y+o.h>=block.y&&o.y<=block.y+block.h&&o.y>block.y){o.y,s.y,s.x=s.oldX+.01;break}}else if(s.vx<0&&s.x+s.w>=block.x&&s.x<=block.x+block.w&&s.y+s.h>=block.y&&s.y<=block.y+block.h){s.x=block.x+block.w+1;break}}}function TopCollider(t,s,e,i){for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++){var a=h*e,c=l*e,o=[];if(t[l][h]==i){o.push(new Sprite(a,c,e,e,0,0,"red"));for(var n=0;n<o.length;n++)var f=o[n];if(s.collider){let d=s.collider;if(isCollide(d,f)&&s.vy>0&&f.y+f.h>=d.y&&f.y>=d.y+d.h/2){let $=d.y-s.y+d.h;return s.vy=0,s.onFloor=!0,s.isJumping=!1,JumpTime=0,s.y=~~(f.y-$-.01)}}else if(isCollide(body,f)&&s.vy>0&&f.y+f.h>body.y&&f.y>body.y+body.h/2){s.vy=0,0==s.vy&&("circle"==s.shape&&(this.shadowY=this.shadowY-27),"rect"==s.shape&&(this.shadowY=this.shadowY-33)),s.y=f.y-s.h-.01,JumpTime=0,s.onFloor=!0;break}}}}function BottomCollider(t,s,e,i){for(var l=0;l<t.length;l++)for(var h,a=0;a<t[0].length;a++)if(t[l][a]==i){if(h={x:tx=a*e,y:ty=l*e,w:e,h:e},s.collider){let c=s.collider;if(s.isJumping||isJumping&&s.vy<0&&c.x-s.vx+c.w>h.x-s.vx&&c.y+c.h>=h.y&&c.x-s.vx<=h.x+h.w-s.vx&&c.y<=h.y+h.h){let o=c.y-s.y;s.y=h.y+h.h-5-o+9,s.isJumping=!1,isJumping=!1,s.vy=0;break}}else if(s.isJumping||isJumping&&s.x+s.w>h.x&&s.y+s.h>=h.y&&s.x<=h.x+h.w&&s.y<=h.y+h.h){s.y=h.y+h.h+.01,s.vy=0,isJumping=!1;break}}}function LeftTiledCollider(t,s){loader&&t.objects.forEach(function(t){if(!canDraw(t,camera))return;let e=s.collider;if(isCollide(e,t)&&s.vx>0){let i=e.x-s.x+e.w;return s.x=t.x-i-.01}})}function RightTiledCollider(t,s){loader&&t.objects.forEach(function(t){if(!canDraw(t,camera))return;let e=s.collider;if(isCollide(e,t)&&s.vx<0){let i=e.x-s.x;return s.x=t.x+t.width-i+.01}})}function TopTiledCollider(t,s){loader&&t.objects.forEach(function(t){if(!canDraw(t,camera))return;let e=s.collider;if(isCollide(e,t)&&s.vy>0&&t.y+t.height>e.y&&t.y>e.y+e.h/2){let i=e.y-s.y+e.h;return s.vy=0,s.onFloor=!0,s.isJumping=!1,JumpTime=0,s.y=~~(t.y-i-.01)}})}function BottomTiledCollider(t,s){loader&&t.objects.forEach(function(t){let e=s.collider;if(canDraw(t,camera)&&s.isJumping&&s.vy<0&&e.x-s.vx+e.w>t.x-s.vx&&e.y+e.h>=t.y&&e.x-s.vx<=t.x+t.width-s.vx&&e.y<=t.y+t.height&&e.y+e.h>t.y+t.height&&e.y>t.y){s.vy=0;let i=e.y-s.y;return s.y=t.y+t.height-7-i+9,s.onFloor=!1,s.isJumping=!1}})}function isFlipCollide(t,s){var e=Math.abs(t.x-s.x),i=Math.abs(t.y-s.y);if(s.r&&e<=s.r+s.r+t.w/2&&i<=s.r+s.r+t.h/2)return(!t.flipX||!(t.x<s.x))&&(!!t.flipX||!(t.x>s.x));if(void 0==s.r){var e=Math.abs(t.x-s.x),i=Math.abs(t.y-s.y);if(!t.flipX&&t.x+t.w>=s.x&&t.x<=s.x+s.w&&t.y+t.h>=s.y&&t.y<=s.y+1.8*s.h)return!0;if(t.flipX&&t.x+t.w>=s.x&&t.x-1.8*t.w<=s.x+s.w&&t.y+t.h>=s.y&&t.y<=s.y+1.8*s.h){if(t.flipX&&t.x<s.x+s.w)return;return!0}}}Array.prototype.parse2D=function(t){for(var s=[],e=0;e<this.length;e+=t)s.push(this.slice(e,e+t));return s};var partImage=new Image;function Particles(t,s,e,i,l,h){this.name=l||"rainbow",this.speed=3*Math.random()-2,this.angle=Math.random()*Math.PI*3,i.collider?(this.x=i.collider.x+e/2,this.y=i.collider.y+5):(this.x=t+e/2,this.y=s+5),this.size=e/1.5*self.scale,this.alpha=1,this.speed=1.5*Math.random()-2,this.friction=.95,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.update=function(){if(this.vx*=this.friction+.3,this.vy*=this.friction+.3,this.x+=this.vx,this.vy-=.5,frame%4==0&&(this.y+=this.vy),"fire"==this.name)this.color="#720",this.speed=3,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.y+=this.vy*this.friction,this.vx*=this.friction;else if("dust"==this.name){if(this.vx=-.5*Math.random(),this.vy=-((Math.random()+2.2)*Math.random()*2),!i.onFloor)return;this.color="lightgray",this.vy+=1.6,this.y=i.y+i.h-.4,this.y+=.9*this.vy,this.size=.8,i.vx>0&&!i.isJumping?this.x-=.5+.2*Math.random()*self.scale:i.vx>0&&i.isJumping?this.x-=.5+.2*Math.random()*self.scale:i.vx<0&&!i.isJumping?this.x-=.3*Math.random()-5:i.vx<0&&i.isJumping?this.x-=3*Math.random()-5:i.vy>0&&!i.isJumping?this.y+=-5*Math.random():i.vy<0&&!i.isJumping&&(this.y-=-5*Math.random())}else"rainbow"==this.name?(this.color="#"+Math.random().toString(16).substr(-6),this.speed=2,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.y+=this.vy*this.friction,this.vx*=this.friction):"self"==this.name?(this.color=i.color,this.speed=1.8,this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.y+=this.vy*this.friction,this.vx*=this.friction):"waterfall"==this.name?(this.y-=this.vy*this.friction*2,this.size=5*Math.random()+.9,this.color="rgba(200,200,200,0.7)"):"blood"==this.name?(this.color="rgba(255,000,000,1)",this.friction=.54,this.vx*=2*this.friction,this.vy+=this.speed*delta,this.y-=this.vy*delta-1.5,this.x=this.x+.4,this.x+=this.vx*this.speed,this.size=5*Math.random()+.09):"poison"==this.name?(this.color="rgba(205,80,255,0.8)",this.friction=.04,this.vx*=this.friction,this.vy-=.5,this.y+=this.vy,this.x+=this.vx):"smoke"==this.name?(this.color="rgba(0,0,0,1)",this.friction=.4,this.vx*=this.friction,this.vy-=.5,this.y+=this.vy,this.x+=this.vx):i.color&&(this.color=i.color)},this.draw=function(){if(frame%10==0&&"dust"!=this.name)for(let t=0;t<particles.length;t++){var s=particles[t];s.dx=i.x-s.x,s.dy=i.y-s.y,particles.length>=330&&"dust"!=this.name&&(particles.length=330);var e=Math.hypot(s.dy,s.dx);"dust"!=this.name&&e>=20&&(this.alpha-=.1,this.alpha<=.1&&(particles[0]&&(this.alpha=1),kill(particles,t)))}else if(frame%2==0&&"dust"==this.name)for(let l=0;l<particles.length;l++){var s=particles[l];s.dx=i.x-s.x,s.dy=i.y-s.y;var e=Math.hypot(s.dx,s.dy);e>=2&&"dust"==this.name&&(this.alpha-=.05,this.alpha<=.3&&(particles[0]&&(this.alpha=1),kill(particles,l)))}if(i.image&&"self"==this.name){this.vx*=this.friction,this.x+=this.vx,this.y+=this.vy,partImage.src=i.image.src,canDraw(i,camera)&&ctx.drawImage(partImage,this.x*self.scale,this.y*self.scale,2.5*this.size,2.5*this.size);return}canDraw(i,camera)&&(ctx.fillStyle=this.color,"fire"==this.name?(ctx.shadowBlur=4,ctx.shadowColor="rgba(240,200,10,0.8)"):ctx.shadowColor=this.color),canDraw(i,camera)&&("poison"!=this.name&&("polygon"==i.type?(ctx.globalAlpha=this.alpha,ctx.fillRect(this.x,this.y,this.size*Math.random()*1.5+.1,this.size*Math.random()*1.5+.3)):(ctx.save(),ctx.fillRect(this.x*self.scale,this.y*self.scale,this.size*Math.random()*1.5+.1,this.size*Math.random()*1.5+.1),ctx.restore())),"poison"==this.name&&(ctx.beginPath(),"polygon"==i.type?(ctx.beginPath(),ctx.arc(this.x,this.y,this.size*Math.random()*2+.2,1.2,2*Math.PI),ctx.fill(),ctx.closePath()):(ctx.beginPath(),ctx.arc(this.x*self.scale,this.y*self.scale,this.size*Math.random()*2+.2,1.2,2*Math.PI),ctx.fill(),ctx.closePath())))}}function createParticle(t,s,e,i){this.thesize=s,this.thesize>20&&(this.thesize=20),this.target=t;for(var l=0;l<s;l++)t.image&&canDraw(this.target,camera)&&t.onFloor&&particles.push(new Particles(t.x||t.x,t.y,2.5*Math.random()+.08,t,e)),"fire"==e||"waterfall"==e||"smoke"==e||"rainbow"==e&&"dust"!=e?canDraw(this.target,camera)&&particles.push(new Particles(t.x+t.w/2||t.x,t.y,2.5*Math.random()+.2,t,e)):"dust"==e&&t.onFloor&&canDraw(this.target,camera)?particles.push(new Particles(t.x+t.w/2||t.x,t.y,2.5*Math.random()+.08,t,e)):canDraw(this.target,camera)&&"dust"!=e&&particles.push(new Particles(t.x+t.w/2||t.x,t.y,3*Math.random()+.08,t,e));return this}function hitBox(t,s,e){if(t.collider&&s.collider)var i=Math.abs(t.collider.x-s.collider.x),l=Math.abs(t.collider.y-s.collider.y);if(t.collider&&!s.collider)var i=Math.abs(t.collider.x-s.x),l=Math.abs(t.collider.y-s.y);else var i=Math.abs(t.x-s.x),l=Math.abs(t.y-s.y);if(Math.hypot(i,l)<=e){if(t.left){if(t.collider&&s.collider&&t.collider.x>s.collider.x)return!0;if(t.collider&&!s.collider){if(t.collider.x>s.x)return!0}else if(!t.collider&&!s.collider&&t.x>s.x)return!0}if(!t.left){if(t.collider&&s.collider&&t.collider.x<s.collider.x)return!0;if(t.collider&&!s.collider){if(t.collider.x<s.x)return!0}else if(!t.collider&&!s.collider&&t.x<s.x)return!0}}return!1}function SnowEffect(t){rand=Math.random()*(num=[1,-3]).length,this.space=t;for(var s={x:Math.ceil(Math.random()*camera.width)+camera.x,y:0,s:Math.floor(1*Math.random())+.5,color:"rgb(255, 255, 255)"},e=0;e<5;e+=2)snows.push(new Circle(s.x,s.y,s.s,Math.cos(num[rand]),Math.floor(.2*Math.random())+1,s.color));for(var i=0;i<snows.length;i++)snow=snows[i],snow.y+=3,(snow.y>t.height||snow.x>t.width)&&kill(snows,i)}function RainEffect(t){this.space=t;for(var s=[-1,3],e={x:Math.floor(Math.random()*camera.width)+camera.x,y:0,w:Math.floor(.2*Math.random())+.4,h:8,color:"rgba(250, 250, 250, 0.07)"},i=0;i<50;i+=2)rand=Math.random()*s.length,rains.push(new Sprite(e.x,e.y,e.w,e.h,Math.cos(s[rand]),Math.floor(3*Math.random())+5,e.color));rains.forEach(function(s,e){s.y+=30,s.y>t.height&&kill(rains,e),rains.x>t.width&&kill(rains,e)})}function isPath(t,s,e){index=0;var i=Math.abs(e.x-s.x),l=Math.abs(e.y-s.y);dx=(wp=t[pathIndex]).x-s.x;var h=Math.atan2(dy=wp.y-s.y,dx),a=Math.hypot(i,l);if(s.vx=Math.cos(h),s.vy=Math.sin(h),s.x+=2*s.vx,s.y+=2*s.vy,a>=-5&&a<=150)return!!(Math.abs(Math.round(s.x)-Math.round(wp.x))<Math.abs(2*s.vx)&&Math.abs(Math.round(s.y)-Math.round(wp.y))<Math.abs(2*s.vy))&&!!(pathIndex<t.length-1)}log("CanvasGameJs is running !!");class GridSize{constructor(t,s){this.cellSize=t,this.grid=gW/this.cellSize,this.gridSize=this.grid}}class Snake extends GridSize{constructor(t,s,e,i,l){super(e,l),this.cellSize=e,this.color=i,this.dir={x:0,y:0},this.lost=!1,this.oldDir={x:0,y:0},this.body=[{x:t,y:s}]}update(){let t;for(t=this.body.length-1;t>0;t--)this.body[t].x=this.body[t-1].x,this.body[t].y=this.body[t-1].y;this.body[t].x+=this.dir.x*this.cellSize,this.body[t].y+=this.dir.y*this.cellSize,(this.dir.x==-this.oldDir.x&&0!=this.dir.x||this.dir.y==-this.oldDir.y&&0!=this.dir.y)&&(this.lost=!0),this.oldDir.x=this.dir.x,this.oldDir.y=this.dir.y,(this.body[0].x<=1||this.body[0].x>=gW-this.cellSize||this.body[0].y<=1||this.body[0].y>=gH-this.cellSize)&&(this.lost=!0)}draw(){for(var t=0;t<this.body.length;t++)ctx.fillStyle=this.color,ctx.fillRect(this.body[t].x,this.body[t].y,this.cellSize,this.cellSize)}}function collidedFood(t,s){if(t.x==s.x&&t.y==s.y)return!0}class Food extends GridSize{constructor(t,s,e){super(t,e),this.cellSize=t,this.color=s,this.useImage=!1,this.image=new Image,this.size=this.cellSize,this.generateFood()}generateFood(){this.randomX=Math.floor(Math.random()*this.gridSize)*this.cellSize,this.randomY=Math.floor(Math.random()*this.gridSize)*this.cellSize,this.x=this.randomX,this.y=this.randomY}update(){(this.x<0||this.x>gW-this.cellSize||this.y<0||this.y>gH-this.cellSize)&&this.generateFood()}draw(){this.useImage?ctx.drawImage(this.image,this.x,this.y,this.size,this.size):(ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.size,this.size))}}
