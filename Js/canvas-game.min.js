const get=function(a){return document.querySelector(a)},getAll=function(a){return document.querySelectorAll(a)};var reqA,SPEED,tileAnimation,spc,row,column,imSet,frames=0;let fr;const log=console.log;let self;function Stage(){(self={stage:document.createElement("canvas")}).add=function(b,a){this.b=a,void 0==a&&document.body.appendChild(b),void 0!==a&&"before"==a&&document.body.before(b)},self.setSize=function(a,b){this.a=a,this.b=b,gW=self.stage.width=this.a,gH=self.stage.height=this.b},self.stage.setBg=function(a){self.stage.style.background=a},self.stage.setBgSize=function(a){self.stage.style.backgroundSize=a},self.stage.setBgRepeat=function(a){self.stage.style.backgroundRepeat=a},ctx=self.stage.getContext("2d"),self.setCam=function(a){ctx.translate(self.stage.width/2-25-a.x,self.stage.height/2-20-a.y)},rectColor=function(a){ctx.fillStyle=a},strokeColor=function(a){ctx.strokeStyle=a},Rect=function(a,b,c,d,e=new rectColor(a)){ctx.fillStyle=this.color,ctx.fillRect(a,b,c,d)},Stroke=function(a,b,c,d,e=new strokeColor(a)){ctx.strokeStyle=this.color,ctx.strokeRect(a,b,c,d)},playSound=function(a){this.audio=new Audio(a),this.audio.volume=.3,this.audio.play()},Text=function(a,b,c,d,e,f,g){this.x=f,this.y=g,this.color=a||"gold",this.fontsize=c,this.fontstyle=b||void 0,this.fontfamily=d||void 0,this.t=e,void 0==this.fontweight&&(this.fontweight="bold"),void 0==this.fontstyle&&(this.fontstyle="italic"),void 0==this.fontfamily&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(a,b,c,d){ctx.clearRect(a,b,c,d)};let b=performance.now(),c,d;function a(){d=performance.now(),fr=self.fps||30,reqA=requestAnimationFrame(a),c=d-b,30==fr&&c>2930/fr-.19&&(clear(0,0,self.stage.width,self.stage.height),b=d,ctx.save(),ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",self.drawGame?self.drawGame():self.render(),self.update(),SPEED=.19,ctx.restore()),60==fr&&c>5500/fr-.19&&(clear(0,0,self.stage.width,self.stage.height),b=d,ctx.save(),ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",self.drawGame?self.drawGame():self.render(),self.update(),SPEED=.19,ctx.restore())}return reqA=requestAnimationFrame(a),self.stopAnimation=function(){return cancelAnimationFrame(reqA)},kill=function(a,b){a.splice(b,1)},self.isHoriBorder=function(a,b){if(void 0==a.r&& void 0!==b.x){if(a.x<=b.x||a.x>=b.width-a.w||a.x>=b.w-a.w)return!0}else if(void 0!=a.r&& void 0!=b.x&&(a.x<=b.x||a.x>=b.width-a.r||a.x>=b.w-a.r))return!0;if(void 0==a.r&& void 0==b.x){if(a.x<=0||a.x>=b.width-a.w||a.x>=b.w-a.w)return!0}else if(void 0!=a.r&& void 0==b.x&&(a.x<=0||a.x>=b.width-a.r||a.x>=b.w-a.r))return!0},self.isVertiBorder=function(a,b){if(void 0==a.r&& void 0!==b.x){if(a.y<=b.y||a.y>=b.height-a.h||a.y>=b.h-a.h)return!0}else if(void 0!=a.r&& void 0!==b.y&&(a.y<=b.y||a.y>=b.height-a.r||a.x>=b.h-a.r))return!0;if(void 0==a.r&& void 0==b.y){if(a.y<=0||a.y>=b.height-a.h||a.y>=b.h-a.h)return!0}else if(void 0!=a.r&& void 0==b.y&&(a.y<=0||a.y>=b.height-a.r||a.x>=b.h-a.r))return!0},self}var Deg2Rad=Math.PI/180;function isOverlap(b,a){var c=Math.abs(b.x-(a.x+a.w/2)),d=Math.abs(b.y-(a.y+a.h/2));if(c<=b.r+a.w/2&&d<=b.r+a.h/2)return!0}function isCollide(a,b){if(a.x+a.w-9.7>=b.x&&a.x<=b.x+b.w-9.7&&a.y+a.h-1.6>=b.y&&a.y<=b.y+b.h-1.6||a.x+a.w-9.7>=b.x&&a.x<=b.x+b.width-9.7&&a.y+a.h-1.6>=b.y&&a.y<=b.y+b.height-1.6)return!0}function isInterCirc(a,b){if(dx=a.x-b.x,dy=a.y-b.y,sumr=a.r+b.r,distance=Math.sqrt(dx*dx+dy*dy),distance<=sumr)return!0}function tileMap(a,b,i,c,d,e,f,g,h){return this.image=new Image,this.image.src=f,this.lev=a,this.colTCount=b,this.rowTCount=a.length,this.total=c,this.ts=d,this.s=e,this.w=g,this.h=h,this.image.onload=this.drawLayer,this.drawLayer=function(){for(var a=0;a<this.rowTCount;a++)for(var b=0;b<this.colTCount;b++){var f=this.lev[a][b],g=f/c|0,h=f%c|0;void 0==this.w&& void 0==this.h&&ctx.drawImage(this.image,h*d,g*d,d,d,b*e,a*e,e,e),this.w&&this.h&&ctx.drawImage(this.image,h*d,g*d,d,d,b*e,a*e,this.w,this.h)}},this}Sprite=function(a,b,c,d,e,f,g,h){this.x=a,this.y=b,this.w=c,this.h=d,this.vx=e,this.vy=f,this.id=h,this.flipX=!1,this.flipY=!1,this.setGravity=function(a){this.gravity=a},this.color=g,this.setBody=()=>{this.setGravity(7),this.vy+=this.gravity,this.y+=this.vy},this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){for(var a=0;a<this.bullet.length;a++)ctx.fillStyle=this.bullet[a].color,ctx.fillRect(this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h),imSet&&ctx.drawImage(this.bullet[a].image,this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h),imSet||(ctx.fillStyle=this.bullet[a].color,this.bullet[a].w>0&&this.bullet[a].h>0?ctx.fillRect(this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h):0==this.bullet[a].w&&0==this.bullet[a].h&&(ctx.beginPath(),ctx.arc(this.bullet[a].x,this.bullet[a].y,this.bullet[a].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.w,this.h)},this.drawSpriteImg=function(){for(var a=0;a<this.bullet.length;a++)imSet&&ctx.drawImage(this.bullet[a].image,this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h),imSet||(ctx.fillStyle=this.bullet[a].color,this.bullet[a].w>0&&this.bullet[a].h>0?ctx.fillRect(this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h):0==this.bullet[a].w&&0==this.bullet[a].h&&(ctx.beginPath(),ctx.arc(this.bullet[a].x,this.bullet[a].y,this.bullet[a].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX)for(var a=0;a<this.bullet.length;a++)if(imSet)ctx.drawImage(this.bullet[a].image,-this.bullet[a].x,this.bullet[a].y,-this.bullet[a].w,this.bullet[a].h),ctx.globalAlpha=1;else for(var b=0;b<this.bullet.length;b++)ctx.fillStyle=this.bullet[b].color,ctx.fillRect(-this.bullet[b].x-this.bullet[b].w,this.bullet[b].y,this.bullet[b].w,this.bullet[b].h),ctx.globalAlpha=1;else for(var a=0;a<this.bullet.length;a++)if(imSet)ctx.drawImage(this.bullet[a].image,this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h);else for(var a=0;a<this.bullet.length;a++)ctx.fillStyle=this.bullet[a].color,this.bullet[a].w>0&&this.bullet[a].h>0?ctx.fillRect(this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h):0==this.bullet[a].w&&0==this.bullet[a].h&&(ctx.beginPath(),ctx.arc(this.bullet[a].x,this.bullet[a].y,this.bullet[a].r,0,2*Math.PI),ctx.fill(),ctx.closePath());this.flipX&&(ctx.scale(-1,1),ctx.drawImage(this.image,-this.x,this.y,-this.w,this.h),ctx.globalAlpha=0),this.flipX||ctx.drawImage(this.image,this.x,this.y,this.w,this.h),this.flipY&&(ctx.scale(1,-1),ctx.drawImage(this.image,this.x,-this.y,this.w,-this.h),ctx.globalAlpha=0),this.flipY||ctx.drawImage(this.image,this.x,this.y,this.w,this.h)},this.addBullet=function(a,b,c,d,e,f){this.obj={x:a,y:b,w:c,h:d,color:e,r:f},this.bullet.push(this.obj)},this.addBulletIm=function(a,b,c,d,e){this.obj={x:a,y:b,w:c,h:d},imSet=!0,this.obj.image=new Image,this.obj.image.src=e,this.bullet.push(this.obj)};var i=0;this.SpriteRot=function(){i+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,i)},this.drawSpriteRot=function(c,d,a,b,e){ctx.save(),ctx.translate(c,d),ctx.rotate(e*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-a/2,-b/2,a,b),ctx.restore()};var i=0;return this.SpriteImgRot=function(){i+=8,this.drawSpriteImgRot(this.image,this.x,this.y,this.w,this.h,i)},this.drawSpriteImgRot=function(f,c,d,a,b,e){ctx.save(),ctx.translate(c,d),ctx.rotate(e*Deg2Rad),ctx.drawImage(this.image,-a/2,-b/2,a,b),ctx.restore()},this},Circle=function(a,b,c,d,e,f,g){this.x=a,this.y=b,this.r=c,this.vx=d,this.vy=e,this.id=g,this.setGravity=function(a){this.gravity=a},this.color=f,this.setBody=()=>{this.setGravity(7),this.vy+=this.gravity,this.y+=this.vy},this.drawCirc=function(){ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.fill(),ctx.closePath()}},SpriteSheet=function(a,b,c,d,e,f,g,h,i,j,k){this.row=b,this.col=a,this.sw=c,this.sh=d,this.x=e,this.y=f,this.w=g,this.h=h,this.vx=i,this.vy=j,this.id=k,this.flipX=!1,this.flipY=!1,this.setGravity=function(a){this.gravity=a},this.setBody=()=>{this.setGravity(7),this.vy+=this.gravity,this.y+=this.vy},this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){if(this.flipX)for(var a=0;a<this.bullet.length;a++)if(void 0!=this.bullet[a].image.src)ctx.drawImage(this.bullet[a].image,-this.bullet[a].x,this.bullet[a].y,-this.bullet[a].w,this.bullet[a].h),ctx.globalAlpha=1;else for(var b=0;b<this.bullet.length;b++)ctx.scale(-1,1),ctx.fillStyle=this.bullet[a].color,this.bullet[a].w>0&&this.bullet[a].h>0&&ctx.fillRect(this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h),0==this.bullet[a].w&&0==this.bullet[a].h&&(ctx.beginPath(),ctx.arc(this.bullet[a].x,this.bullet[a].y,this.bullet[a].r,0,2*Math.PI),ctx.fill(),ctx.closePath()),ctx.globalAlpha=1;else for(var a=0;a<this.bullet.length;a++){if(!imSet)for(var a=0;a<this.bullet.length;a++)ctx.fillStyle=this.bullet[a].color,this.bullet[a].w>0&&this.bullet[a].h>0?ctx.fillRect(this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h):0==this.bullet[a].w&&0==this.bullet[a].h&&(ctx.beginPath(),ctx.arc(this.bullet[a].x,this.bullet[a].y,this.bullet[a].r,0,2*Math.PI),ctx.fill(),ctx.closePath());imSet&&ctx.drawImage(this.bullet[a].image,this.bullet[a].x,this.bullet[a].y,this.bullet[a].w,this.bullet[a].h)}this.flipX&&(ctx.scale(-1,1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.x-this.w,this.y,this.w,this.h),ctx.globalAlpha=0),this.flipX||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h),this.flipY&&(ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,-this.y-this.h,this.w,this.h),ctx.globalAlpha=0),this.flipY||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h)},this.addBullet=function(a,b,c,d,e,f){this.obj={x:a,y:b,w:c,h:d,color:e,r:f},this.bullet.push(this.obj)},this.addBulletIm=function(a,b,c,d,e){this.obj={x:a,y:b,w:c,h:d},imSet=!0,this.obj.image=new Image,this.obj.image.src=e,this.bullet.push(this.obj)};var l=0;this.SpriteSheetRot=function(){l+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,l)},this.drawSpriteSheetRot=function(f,g,h,i,j,c,d,a,b,e){ctx.save(),ctx.translate(c,d),ctx.rotate(e*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-a/2,-b/2,a,b),ctx.restore()}};var goLeft=!1,goRight=!1;function isFollow(a,b){return(gap=a.x-b.x,diffY=Math.abs(a.y-b.y),gap<= -3&&gap>= -150&&diffY<=20)?(goLeft=!0,goRight=!1,!0):gap>=0&&gap<=150&&diffY<=20?(goLeft=!1,goRight=!0,!0):void 0}function createGrid(a,b,c,d){this.gap=a,this.gW=b,this.gH=c,this.color=d,this.drawGrid=function(){for(var a=this.gap;a<this.gW;a+=this.gap)this.gW>=this.gH?(ctx.moveTo(a,0),ctx.lineTo(a,this.gW)):(ctx.moveTo(a,0),ctx.lineTo(a,this.gH));for(var b=this.gap;b<this.gH;b+=this.gap)ctx.moveTo(0,b),ctx.lineTo(this.gW,b);ctx.strokeStyle=this.color,ctx.lineWidth=1,ctx.stroke()}}function addNumber(a,b,c,d,e,f){return this.col=a,this.row=b,this.tSize=c,this.color=d,this.spaceX=e,this.spaceY=f,this.show=()=>{for(var a=0;a<=this.row;a++)for(var b=0;b<=this.col;b++){var c=b+a*this.col;ctx.font="9px arial bold",ctx.fillStyle=this.color,ctx.fillText(c,b*this.tSize+this.spaceX,a*this.tSize+this.spaceY)}},this}let loader=!1,that,data;function tiledMap(a,c,b){return that=this,that.path=a,that.image=new Image,that.size=b,that.load=function(){(xhr=new XMLHttpRequest).onreadystatechange=function(){4==this.readyState&&(data=JSON.parse(xhr.responseText),loader=!0,that.loadTileset(data))},xhr.open("get",that.path),xhr.send(null)},that.loadTileset=function(a){for(tile of data.tilesets)that.image.src=tile.image},that.renderLayers=function(a){a=data.layers,(a=Array.isArray(a)?a:data.layers).forEach(that.renderLayer())},that.renderLayer=function(a){a.data.forEach(function(c,d){var b=that.size;imgX=--c%(tile.imagewidth/b)*b,imgY=~~(c/(tile.imagewidth/b))*b,sX=d%a.width*b,sY=~~(d/a.width)*b,ctx.drawImage(that.image,imgX,imgY,b,b,sX,sY,b,b)});var b=!1;tileAnimation=function(g,h){for(var i in that.val=g,this.nom=h,data.layers)if("objectgroup"==(a=data.layers[i]).type&&this.nom==a.name)for(let j of tile.tiles){frames++;var f=j.animation;frameIndex=frames%f.length,value=f[frameIndex].tileid+.13,tile.rows=tile.imageheight/tile.tileheight;var d=tile.imagewidth/tile.columns,c=tile.imageheight/tile.rows;for(var e of a.objects)e.hasOwnProperty("gid")&&e.gid==that.val&&this.nom==a.name&&a.name.includes(this.nom)?b=!0:(b=!1,log(" Animation Layer's name is not defined or gidValue is incorrect in tileAnimation \n\n please read the documentation so that you may use tileAnimation correctly !!")),16==d&&16==c&&(column=Math.round(value%tile.columns*d/2*.1),row=Math.floor(value*c/2/1e3*tile.columns)),32==d&&32==c&&(column=Math.round(value%tile.columns*d/4*.1),row=value*c/2/1e3*tile.columns>>0),48==d&&48==c&&(column=Math.round(value%tile.columns*d/6*.1),row=value*c/4/1e3*tile.columns>>0),64==d&&64==c&&(column=Math.round(value%tile.columns*d/8*.1),row=value*c/6/1e3*tile.columns>>0),94==d&&96==c&&(column=Math.round(value%tile.columns*d/10*.1),row=value*c/8/1e3*tile.columns>>0),b&&ctx.drawImage(that.image,d*column,c*row,d,c,e.x,e.y-c,e.width,e.height)}}},that.RenderObjectLayer=function(e){for(var d of data.layers)if("objectgroup"==d.type){for(var c of(tile.rows=tile.imageheight/tile.tileheight,d.objects))if(c.hasOwnProperty("gid")){var b=tile.imagewidth/tile.columns,a=tile.imageheight/tile.rows;this.gid=e,gid=e,(null==this.gid|| void 0==gid)&&(gid=c.gid),16==b&&16==a&&(column=Math.round(gid%tile.columns*b/2*.1),row=gid*a/1e3*tile.columns>>0),32==b&&32==a&&(column=Math.floor(gid%tile.columns*b/4*.11),row=gid*a/2/1e3*tile.columns>>0),48==b&&48==a&&(column=Math.floor(gid%tile.columns*b/6*.11),row=gid*a/4/1e3*tile.columns>>0),64==b&&64==a&&(column=Math.floor(gid%tile.columns*b/8*.11),row=gid*a/6/1e3*tile.columns>>0),96==b&&96==a&&(column=Math.floor(gid%tile.columns*b/10*.11),row=gid*a/8/1e3*tile.columns>>0),c.hasOwnProperty("gid")&&c.gid!=that.val&&!d.hasOwnProperty("properties")&&ctx.drawImage(that.image,b*column,a*row,b,a,c.x,c.y-a,c.width,c.height)}}},that}function tiledCollider(a,b){if(a.x+a.w-9.7>b.x&&a.x<b.x+b.width-9.7&&a.y+a.h-5.6>b.y&&a.y+6<b.y+b.height-15)return!0}var canJump=!1;function topCol(d,a,g,e){if(Down)for(var b=0;b<d.length;b++)for(var c=0;c<d[0].length;c++){tx=c*ts,ty=b*ts;var f=d[b][c];f!=e&&a.y+a.h>=ty&&a.y<=ty+ts&&a.x+a.w>=tx&&a.x<=tx+ts&&(a.vy=0,a.y=ty-a.h-.001,a.y==ty-a.h-.001&&(canJump=!0))}}function downCol(d,a,f,g){if(Top)for(var b=0;b<d.length;b++)for(var c=0;c<d[0].length;c++){tx=c*ts,ty=b*ts;var e=d[b][c];0!=e&&a.y+a.h>=ty&&a.y<=ty+ts&&a.x+a.w>=tx&&a.x<=tx+ts&&(a.y=ty+1.5*ts)}}function RightCol(d,a,h,f,g){if(rity=!1,a.vx=10,lefy)for(var b=0;b<d.length;b++)for(var c=0;c<d[0].length;c++){tx=c*ts,ty=b*ts;var e=d[b][c];(e==f||e==g)&&a.x+a.w>=tx&&a.x<=tx+ts&&a.y+a.h>=ty&&a.y<=ty+ts&&(a.x=tx+ts+.001,a.vx=0,a.vy=0)}}function LeftCol(d,a,h,f,g){if(lefy=!1,a.vx=10,rity)for(var b=0;b<d.length;b++)for(var c=0;c<d[0].length;c++){tx=c*ts,ty=b*ts;var e=d[b][c];(e==f||e==g)&&a.x+a.w>=tx&&a.x<=tx+ts&&a.y+a.h>=ty&&a.y<=ty+ts&&(a.x=tx-a.w-.001,a.vx=0,a.vy=0)}}function gameRadar(b,c){this.x=b,this.y=c;var a=new Image;a.src=this.x.toDataURL(),this.y.style.background=`url(${a.src})`,this.y.style.backgroundRepeat="no-repat",this.y.style.backgroundSize="cover"}console.dir("CanvasgGameJs is running !!");var gameFrame=0,gameSpeed=5;class layerB{constructor(a,b,c,d,e,f){this.x=b,this.y=c,this.image=a,this.w=d,this.h=e,this.speedModifier=f,this.speed=gameSpeed*this.speedModifier}update(){this.speed=gameSpeed*this.speedModifier,this.x=gameFrame*this.speed%this.w}draw(){ctx.save(),ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x+this.w,this.y,this.w,this.h),ctx.restore()}}
