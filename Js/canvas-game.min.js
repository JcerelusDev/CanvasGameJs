const get=function(t){return document.querySelector(t)},getAll=function(t){return document.querySelectorAll(t)};var reqA;const log=console.log;let self;function Stage(){(self={stage:document.createElement("canvas")}).add=function(t){document.body.appendChild(t)},self.stage.setBg=function(t){self.stage.style.background=t},self.stage.setBgSize=function(t){self.stage.style.backgroundSize=t},self.stage.setBgRepeat=function(t){self.stage.style.backgroundRepeat=t},ctx=self.stage.getContext("2d"),self.setCam=function(t,i){ctx.translate(i.width/2-t.x,i.height/2-t.y)},rectColor=function(t){ctx.fillStyle=t},strokeColor=function(t){ctx.strokeStyle=t},Rect=function(t,i,s,h){ctx.fillRect(t,i,s,h)},Stroke=function(t,i,s,h){ctx.strokeRect(t,i,s,h)},playSound=function(t){this.audio=new Audio(t),this.audio.volume=.3,this.audio.play()},Text=function(t,i,s,h,e,l,a){this.x=l,this.y=a,this.color=t||"gold",this.fontsize=s,this.fontstyle=i||void 0,this.fontfamily=h||void 0,this.t=e,null==this.fontweight&&(this.fontweight="bold"),null==this.fontstyle&&(this.fontstyle="italic"),null==this.fontfamily&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(t,i,s,h){ctx.clearRect(t,i,s,h)};var t,i=Date.now();return gameLoop=function(){reqA=requestAnimationFrame(gameLoop),fps=self.fps||30,t=Date.now(),dT=t-i,dT>1e3/fps&&(clear(0,0,self.stage.width,self.stage.height),ctx.save(),ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",i=t,self.animate=self.drawGame(),update=self.update(),ctx.restore())},gameLoop(),self.stopAnimation=function(){return cancelAnimationFrame(reqA)},kill=function(t){t.splice(t,1)},self.isHoriBorder=function(t,i){if(null==t.r){if(t.x<=i.x||t.x>=i.width-t.w/2||t.x>=i.w-t.w/2)return!0}else if(null!=t.r&&(t.x<=t.r||t.x>=i.width-t.r||t.x>=i.w-t.r))return!0},self.isVertiBorder=function(t,i){if(null==t.r){if(t.y<=t.w||t.y>=i.height-t.h/2||t.y>=i.h-t.h/2)return!0}else if(null!=t.r&&(t.y<=t.r||t.y>=i.height-t.r||t.x>=i.h-t.r))return!0},self}var Deg2Rad=Math.PI/180;function isOverlap(t,i){var s=Math.abs(t.x-(i.x+i.w/2)),h=Math.abs(t.y-(i.y+i.h/2));if(s<=t.r+i.w/2&&h<=t.r+i.h/2)return!0}function isCollide(t,i){if(t.x+t.w>=i.x&&t.x<=i.x+i.w&&t.y+t.h>=i.y&&t.y<=i.y+i.h)return!0}function isInterCirc(t,i){if(dx=t.x-i.x,dy=t.y-i.y,sumr=t.r+i.r,distance=Math.sqrt(dx*dx+dy*dy),distance<=sumr)return!0}Sprite=function(t,i,s,h,e,l,a,o){if(this.x=t,this.y=i,this.w=s,this.h=h,this.vx=e,this.vy=l,this.id=o,this.flipX=!1,this.flipY=!1,this.setGravity=function(t){this.gravity=t},this.color=a,this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){if(ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.w,this.h),!this.bullet.image.src)for(var t=0;t<this.bullet.length;t++)ctx.fillStyle=this.bullet[t].color,ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h)},this.drawSpriteImg=function(){this.flipX&&(ctx.scale(-1,1),ctx.drawImage(this.image,-this.x,this.y,-this.w,this.h),ctx.globalAlpha=0),this.flipX||ctx.drawImage(this.image,this.x,this.y,this.w,this.h),this.flipY&&(ctx.scale(1,-1),ctx.drawImage(this.image,this.x,-this.y,this.w,-this.h),ctx.globalAlpha=0),this.flipY||ctx.drawImage(this.image,this.x,this.y,this.w,this.h)},this.flipX)if(this.bullet.image.src)for(var r=0;r<this.bullet.length;r++)ctx.drawImage(this.bullet.image,-this.bullet[r].x,this.bullet[r].y,-this.bullet[r].w,this.bullet[r].h),ctx.globalAlpha=1;else for(var c=0;c<this.bullet.length;c++)ctx.fillStyle=this.bullet[c].color,ctx.fillRect(-this.bullet[c].x-this.bullet[c].w,this.bullet[c].y,this.bullet[c].w,this.bullet[c].h),ctx.globalAlpha=1;else if(this.bullet.image.src)for(r=0;r<this.bullet.length;r++)ctx.drawImage(this.bullet.image,this.bullet[r].x,this.bullet[r].y,this.bullet[r].w,this.bullet[r].h);else for(r=0;r<this.bullet.length;r++)ctx.fillStyle=this.bullet[r].color,ctx.fillRect(this.bullet[r].x,this.bullet[r].y,this.bullet[r].w,this.bullet[r].h);this.setBody=(()=>{this.gravity=2,this.vy+=this.gravity,this.y+=this.vy}),this.addBullet=function(t,i,s,h,e){this.obj={x:t,y:i,w:s,h:h,color:e},this.bullet.push(this.obj)};c=0;this.SpriteRot=function(){c+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,c)},this.drawSpriteRot=function(t,i,s,h,e){ctx.save(),ctx.translate(t,i),ctx.rotate(e*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-s/2,-h/2,s,h),ctx.restore()};c=0;this.SpriteImgRot=function(){c+=8,this.drawSpriteImgRot(this.image,this.x,this.y,this.w,this.h,c)},this.drawSpriteImgRot=function(t,i,s,h,e,l){ctx.save(),ctx.translate(i,s),ctx.rotate(l*Deg2Rad),ctx.drawImage(this.image,-h/2,-e/2,h,e),ctx.restore()}},Circle=function(t,i,s,h,e,l,a){this.x=t,this.y=i,this.r=s,this.vx=h,this.vy=e,this.id=a,this.setGravity=function(t){this.gravity=t},this.color=l,this.drawCirc=function(){ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.fill(),ctx.closePath()},this.setBody=(()=>{this.gravity=2,this.vy+=this.gravity,this.y+=this.vy})},SpriteSheet=function(t,i,s,h,e,l,a,o,r,c,n){this.row=i,this.col=t,this.sw=s,this.sh=h,this.x=e,this.y=l,this.w=a,this.h=o,this.vx=r,this.vy=c,this.id=n,this.flipX=!1,this.flipY=!1,this.setGravity=function(t){this.gravity=t},this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){if(this.flipX&&(ctx.scale(-1,1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.x-this.w,this.y,this.w,this.h),ctx.globalAlpha=0),this.flipX||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h),this.flipY&&(ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,-this.y-this.h,this.w,this.h),ctx.globalAlpha=0),this.flipY||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h),this.flipX)if(this.bullet.image.src)for(var t=0;t<this.bullet.length;t++)ctx.drawImage(this.bullet.image,-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h),ctx.globalAlpha=1;else for(var i=0;i<this.bullet.length;i++)ctx.scale(-1,1),ctx.fillStyle=this.bullet[i].color,ctx.fillRect(-this.bullet[i].x,this.bullet[i].y,-this.bullet[i].w,this.bullet[i].h),ctx.globalAlpha=1;else if(this.bullet.image.src)for(t=0;t<this.bullet.length;t++)ctx.drawImage(this.bullet.image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h);else for(t=0;t<this.bullet.length;t++)ctx.fillStyle=this.bullet[t].color,ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h)},this.setBody=(()=>{this.gravity=2,this.vy+=this.gravity,this.y+=this.vy}),this.addBullet=function(t,i,s,h,e,l){this.obj={x:t,y:i,w:s,h:h,color:e},this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)};var u=0;this.SpriteSheetRot=function(){u+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,u)},this.drawSpriteSheetRot=function(t,i,s,h,e,l,a,o,r,c){ctx.save(),ctx.translate(l,a),ctx.rotate(c*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-o/2,-r/2,o,r),ctx.restore()}};
