const get=function(t){return document.querySelector(t)},getAll=function(t){return document.querySelectorAll(t)};var reqA,SPEED,tileAnimation,frames=0;let fr;const log=console.log;let self;function Stage(){(self={stage:document.createElement("canvas")}).add=function(t,i){this.b=i,null==i&&document.body.appendChild(t),void 0!==i&&"before"==i&&document.body.before(t)},self.setSize=function(t,i){this.a=t,this.b=i,gW=self.stage.width=this.a,gH=self.stage.height=this.b},self.stage.setBg=function(t){self.stage.style.background=t},self.stage.setBgSize=function(t){self.stage.style.backgroundSize=t},self.stage.setBgRepeat=function(t){self.stage.style.backgroundRepeat=t},ctx=self.stage.getContext("2d"),self.setCam=function(t){ctx.translate(self.stage.width/2-t.x,self.stage.height/2-t.y)},rectColor=function(t){ctx.fillStyle=t},strokeColor=function(t){ctx.strokeStyle=t},Rect=function(t,i,e,s,l=new rectColor(t)){ctx.fillStyle=this.color,ctx.fillRect(t,i,e,s)},Stroke=function(t,i,e,s,l=new strokeColor(t)){ctx.strokeStyle=this.color,ctx.strokeRect(t,i,e,s)},playSound=function(t){this.audio=new Audio(t),this.audio.volume=.3,this.audio.play()},Text=function(t,i,e,s,l,h,a){this.x=h,this.y=a,this.color=t||"gold",this.fontsize=e,this.fontstyle=i||void 0,this.fontfamily=s||void 0,this.t=l,null==this.fontweight&&(this.fontweight="bold"),null==this.fontstyle&&(this.fontstyle="italic"),null==this.fontfamily&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(t,i,e,s){ctx.clearRect(t,i,e,s)};var t,i=performance.now();updateLoop=function(){reqA=requestAnimationFrame(updateLoop),(l<=30||self.fps<=30)&&(fr=self.fps/2||l/2),(l>=60||self.fps>=60)&&(fr=self.fps/6||l/4.2),t=performance.now(),delta=t-i,delta>1e3/fr&&(i=t,SPEED=delta/200,ctx.save(),self.update(),ctx.restore())},reqA=requestAnimationFrame(updateLoop);var e,s=performance.now();let l;return gameLoop=function(){requestAnimationFrame(gameLoop),((l=self.fps||30)<=30||self.fps<=30)&&(l/=3),(l>=40||self.fps>=40&&game.fps<60||l<60)&&(l/=4),60!=l&&60!=self.fps||(l/=1.3),e=performance.now(),dt=e-s,dt>1e3/l&&(clear(0,0,self.stage.width,self.stage.height),s=e,ctx.save(),ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",self.drawGame?self.drawGame():self.render(),ctx.restore())},requestAnimationFrame(gameLoop),self.stopAnimation=function(){return cancelAnimationFrame(reqA)},kill=function(t,i){t.splice(i,1)},self.isHoriBorder=function(t,i){if(null==t.r&&void 0!==i.x){if(t.x<=i.x||t.x>=i.width-t.w||t.x>=i.w-t.w)return!0}else if(null!=t.r&&null!=i.x&&(t.x<=i.x||t.x>=i.width-t.r||t.x>=i.w-t.r))return!0;if(null==t.r&&null==i.x){if(t.x<=0||t.x>=i.width-t.w||t.x>=i.w-t.w)return!0}else if(null!=t.r&&null==i.x&&(t.x<=0||t.x>=i.width-t.r||t.x>=i.w-t.r))return!0},self.isVertiBorder=function(t,i){if(null==t.r&&void 0!==i.x){if(t.y<=i.y||t.y>=i.height-t.h||t.y>=i.h-t.h)return!0}else if(null!=t.r&&void 0!==i.y&&(t.y<=i.y||t.y>=i.height-t.r||t.x>=i.h-t.r))return!0;if(null==t.r&&null==i.y){if(t.y<=0||t.y>=i.height-t.h||t.y>=i.h-t.h)return!0}else if(null!=t.r&&null==i.y&&(t.y<=0||t.y>=i.height-t.r||t.x>=i.h-t.r))return!0},self}var Deg2Rad=Math.PI/180;function isOverlap(t,i){var e=Math.abs(t.x-(i.x+i.w/2)),s=Math.abs(t.y-(i.y+i.h/2));if(e<=t.r+i.w/2&&s<=t.r+i.h/2)return!0}function isCollide(t,i){if(t.x+t.w-9.7>=i.x&&t.x<=i.x+i.w-9.7&&t.y+t.h-1.6>=i.y&&t.y<=i.y+i.h-1.6||t.x+t.w-9.7>=i.x&&t.x<=i.x+i.width-9.7&&t.y+t.h-1.6>=i.y&&t.y<=i.y+i.height-1.6)return!0}function isInterCirc(t,i){if(dx=t.x-i.x,dy=t.y-i.y,sumr=t.r+i.r,distance=Math.sqrt(dx*dx+dy*dy),distance<=sumr)return!0}function tileMap(t,i,e,s,l,h,a,o,r){return this.image=new Image,this.image.src=a,this.lev=t,this.colTCount=i,this.rowTCount=t.length,this.total=s,this.ts=l,this.s=h,this.w=o,this.h=r,this.image.onload=this.drawLayer,this.drawLayer=function(){for(var t=0;t<this.rowTCount;t++)for(var i=0;i<this.colTCount;i++){var e=this.lev[t][i],a=e/s|0,o=e%s|0;null==this.w&&null==this.h&&ctx.drawImage(this.image,o*l,a*l,l,l,i*h,t*h,h,h),this.w&&this.h&&ctx.drawImage(this.image,o*l,a*l,l,l,i*h,t*h,this.w,this.h)}},this}Sprite=function(t,i,e,s,l,h,a,o){this.x=t,this.y=i,this.w=e,this.h=s,this.vx=l,this.vy=h,this.id=o,this.flipX=!1,this.flipY=!1,this.setGravity=function(t){this.gravity=t},this.color=a,this.setBody=(()=>{this.setGravity(6),this.vy+=this.gravity,this.y+=this.vy}),this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){for(var t=0;t<this.bullet.length;t++)ctx.fillStyle=this.bullet[t].color,ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),imSet&&ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),imSet||(ctx.fillStyle=this.bullet[t].color,this.bullet[t].w>0&&this.bullet[t].h>0?ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.w,this.h)},this.drawSpriteImg=function(){for(var t=0;t<this.bullet.length;t++)imSet&&ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),imSet||(ctx.fillStyle=this.bullet[t].color,this.bullet[t].w>0&&this.bullet[t].h>0?ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX)for(t=0;t<this.bullet.length;t++)if(imSet)ctx.drawImage(this.bullet[t].image,-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h),ctx.globalAlpha=1;else for(var i=0;i<this.bullet.length;i++)ctx.fillStyle=this.bullet[i].color,ctx.fillRect(-this.bullet[i].x-this.bullet[i].w,this.bullet[i].y,this.bullet[i].w,this.bullet[i].h),ctx.globalAlpha=1;else for(t=0;t<this.bullet.length;t++)if(imSet)ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h);else for(t=0;t<this.bullet.length;t++)ctx.fillStyle=this.bullet[t].color,this.bullet[t].w>0&&this.bullet[t].h>0?ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath());this.flipX&&(ctx.scale(-1,1),ctx.drawImage(this.image,-this.x,this.y,-this.w,this.h),ctx.globalAlpha=0),this.flipX||ctx.drawImage(this.image,this.x,this.y,this.w,this.h),this.flipY&&(ctx.scale(1,-1),ctx.drawImage(this.image,this.x,-this.y,this.w,-this.h),ctx.globalAlpha=0),this.flipY||ctx.drawImage(this.image,this.x,this.y,this.w,this.h)},this.addBullet=function(t,i,e,s,l,h){this.obj={x:t,y:i,w:e,h:s,color:l,r:h},this.bullet.push(this.obj)},this.addBulletIm=function(t,i,e,s,l){this.obj={x:t,y:i,w:e,h:s},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)};var r=0;this.SpriteRot=function(){r+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,r)},this.drawSpriteRot=function(t,i,e,s,l){ctx.save(),ctx.translate(t,i),ctx.rotate(l*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-e/2,-s/2,e,s),ctx.restore()};r=0;return this.SpriteImgRot=function(){r+=8,this.drawSpriteImgRot(this.image,this.x,this.y,this.w,this.h,r)},this.drawSpriteImgRot=function(t,i,e,s,l,h){ctx.save(),ctx.translate(i,e),ctx.rotate(h*Deg2Rad),ctx.drawImage(this.image,-s/2,-l/2,s,l),ctx.restore()},this},Circle=function(t,i,e,s,l,h,a){this.x=t,this.y=i,this.r=e,this.vx=s,this.vy=l,this.id=a,this.setGravity=function(t){this.gravity=t},this.color=h,this.setBody=(()=>{this.setGravity(6),this.vy+=this.gravity,this.y+=this.vy}),this.drawCirc=function(){ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.fill(),ctx.closePath()}},SpriteSheet=function(t,i,e,s,l,h,a,o,r,n,c){this.row=i,this.col=t,this.sw=e,this.sh=s,this.x=l,this.y=h,this.w=a,this.h=o,this.vx=r,this.vy=n,this.id=c,this.flipX=!1,this.flipY=!1,this.setGravity=function(t){this.gravity=t},this.setBody=(()=>{randval=Math.random()+fr,this.setGravity(6),this.vy+=this.gravity,this.y+=this.vy}),this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){if(this.flipX)for(var t=0;t<this.bullet.length;t++)if(null!=this.bullet[t].image.src)ctx.drawImage(this.bullet[t].image,-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h),ctx.globalAlpha=1;else for(var i=0;i<this.bullet.length;i++)ctx.scale(-1,1),ctx.fillStyle=this.bullet[t].color,this.bullet[t].w>0&&this.bullet[t].h>0&&ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()),ctx.globalAlpha=1;else for(t=0;t<this.bullet.length;t++){if(!imSet)for(t=0;t<this.bullet.length;t++)ctx.fillStyle=this.bullet[t].color,this.bullet[t].w>0&&this.bullet[t].h>0?ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath());imSet&&ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h)}this.flipX&&(ctx.scale(-1,1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.x-this.w,this.y,this.w,this.h),ctx.globalAlpha=0),this.flipX||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h),this.flipY&&(ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,-this.y-this.h,this.w,this.h),ctx.globalAlpha=0),this.flipY||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h)},this.addBullet=function(t,i,e,s,l,h){this.obj={x:t,y:i,w:e,h:s,color:l,r:h},this.bullet.push(this.obj)},this.addBulletIm=function(t,i,e,s,l){this.obj={x:t,y:i,w:e,h:s},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)};var u=0;this.SpriteSheetRot=function(){u+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,u)},this.drawSpriteSheetRot=function(t,i,e,s,l,h,a,o,r,n){ctx.save(),ctx.translate(h,a),ctx.rotate(n*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-o/2,-r/2,o,r),ctx.restore()}};var goLeft=!1,goRight=!1;function isFollow(t,i){return gap=t.x-i.x,diffY=Math.abs(t.y-i.y),gap<=-3&&gap>=-100&&diffY<=20?(goLeft=!0,goRight=!1,!0):gap>=0&&gap<=100&&diffY<=20?(goLeft=!1,goRight=!0,!0):void 0}function createGrid(t,i,e,s){this.gap=t,this.gW=i,this.gH=e,this.color=s,this.drawGrid=function(){for(var t=this.gap;t<this.gW;t+=this.gap)this.gW>=this.gH?(ctx.moveTo(t,0),ctx.lineTo(t,this.gW)):(ctx.moveTo(t,0),ctx.lineTo(t,this.gH));for(var i=this.gap;i<this.gH;i+=this.gap)ctx.moveTo(0,i),ctx.lineTo(this.gW,i);ctx.strokeStyle=this.color,ctx.lineWidth=1,ctx.stroke()}}function addNumber(t,i,e,s,l,h){return this.col=t,this.row=i,this.tSize=e,this.color=s,this.spaceX=l,this.spaceY=h,this.show=(()=>{for(var t=0;t<=this.row;t++)for(var i=0;i<=this.col;i++){var e=i+t*this.col;ctx.font="9px arial bold",ctx.fillStyle=this.color,ctx.fillText(e,i*this.tSize+this.spaceX,t*this.tSize+this.spaceY)}}),this}let that,data,loader=!1;function tiledMap(t,i,e){return(that=this).path=t,that.image=new Image,that.size=e,that.load=function(){xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){4==this.readyState&&(data=JSON.parse(xhr.responseText),loader=!0,that.loadTileset(data))},xhr.open("get",that.path),xhr.send()},that.loadTileset=function(t){that.image.src=data.tilesets[0].image},that.renderLayers=function(t){t=data.layers,(t=Array.isArray(t)?t:data.layers).forEach(that.renderLayer())},that.renderLayer=function(t){t.data.forEach(function(i,e){var s=data.tilewidth;tile=data.tilesets[0],i--,imgX=i%(tile.imagewidth/s)*s,imgY=~~(i/(tile.imagewidth/s))*s,sX=e%t.width*s,sY=~~(e/t.width)*s,ctx.drawImage(that.image,imgX,imgY,s,s,sX,sY,s,s)});var i=!1;tileAnimation=function(e,s){for(var l in this.val=e,that.val=this.val,this.nom=s,data.layers)if("objectgroup"==(t=data.layers[l]).type&&this.nom==t.name)for(let e of tile.tiles){frames++;var h=e.animation,a=h.length,o=frames%a;for(var r of(value=h[o].tileid+1,t.objects)){if(!(i=!(!r.hasOwnProperty("gid")||r.gid!=that.val||this.nom!=t.name||null==value)))return void log(" Animation Layer's name is not defined or gidValue is incorrect in tileAnimation \n\n please read the documentation so that you may use tileAnimation correctly !!");tile.rows=tile.imageheight/tile.tileheight;var n=tile.imagewidth/tile.columns,c=tile.imageheight/tile.rows;16==n&&16==c&&(column=Math.round(value%tile.columns*n/2*.1),row=value*c/1e3*tile.columns>>0),32==n&&32==c&&(column=Math.round(value%tile.columns*n/4*.1),row=value*c/2/1e3*tile.columns>>0),48==n&&48==c&&(column=Math.round(value%tile.columns*n/6*.1),row=value*c/4/1e3*tile.columns>>0),64==n&&64==c&&(column=Math.round(value%tile.columns*n/8*.1),row=value*c/6/1e3*tile.columns>>0),94==n&&96==c&&(column=Math.round(value%tile.columns*n/10*.1),row=value*c/8/1e3*tile.columns>>0),i&&ctx.drawImage(that.image,n*column,c*row,n,c,r.x,r.y-c,r.width,r.height)}}}},that.RenderObjectLayer=function(t){for(var i of data.layers)if("objectgroup"==i.type)for(var e of(tile.rows=tile.imageheight/tile.tileheight,i.objects))if(e.hasOwnProperty("gid")){var s=tile.imagewidth/tile.columns,l=tile.imageheight/tile.rows;gid=e.gid,null!=this.gid&&null!=gid||(gid=e.gid),16==s&&16==l&&(column=Math.round(gid%tile.columns*s/2*.1),row=gid*l/1e3*tile.columns>>0),32==s&&32==l&&(column=Math.round(gid%tile.columns*s/4*.1),row=gid*l/2/1e3*tile.columns>>0),48==s&&48==l&&(column=Math.round(gid%tile.columns*s/6*.1),row=gid*l/4/1e3*tile.columns>>0),64==s&&64==l&&(column=Math.round(gid%tile.columns*s/8*.1),row=gid*l/6/1e3*tile.columns>>0),96==s&&96==l&&(column=Math.round(gid%tile.columns*s/10*.1),row=gid*l/8/1e3*tile.columns>>0),e.hasOwnProperty("gid")&&gid!==that.val&&ctx.drawImage(that.image,s*column,l*row,s,l,e.x,e.y-l,e.width,e.height)}},that}function tiledCollider(t,i){if(t.x+t.w-9.7>i.x&&t.x<i.x+i.width-9.7&&t.y+t.h-1.6>i.y&&t.y<i.y+i.height-1.6)return!0}var imSet,canJump=!1;function topCol(t,i,e,s){if(Down)for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++){tx=h*ts,ty=l*ts,t[l][h]!=s&&i.y+i.h>=ty&&i.y<=ty+ts&&i.x+i.w>=tx&&i.x<=tx+ts&&(i.vy=0,i.y=ty-i.h-.001,i.y==ty-i.h-.001&&(canJump=!0))}}function downCol(t,i,e,s){if(Top)for(var l=0;l<t.length;l++)for(var h=0;h<t[0].length;h++){tx=h*ts,ty=l*ts,0!=t[l][h]&&i.y+i.h>=ty&&i.y<=ty+ts&&i.x+i.w>=tx&&i.x<=tx+ts&&(i.y=ty+1.5*ts)}}function RightCol(t,i,e,s,l){if(rity=!1,rity||(i.vx=10),lefy)for(var h=0;h<t.length;h++)for(var a=0;a<t[0].length;a++){tx=a*ts,ty=h*ts;var o=t[h][a];o!=s&&o!=l||i.x+i.w>=tx&&i.x<=tx+ts&&i.y+i.h>=ty&&i.y<=ty+ts&&(i.x=tx+ts+.001,i.vx=0,i.vy=0)}}function LeftCol(t,i,e,s,l){if(lefy=!1,lefy||(i.vx=10),rity)for(var h=0;h<t.length;h++)for(var a=0;a<t[0].length;a++){tx=a*ts,ty=h*ts;var o=t[h][a];o!=s&&o!=l||i.x+i.w>=tx&&i.x<=tx+ts&&i.y+i.h>=ty&&i.y<=ty+ts&&(i.x=tx-i.w-.001,i.vx=0,i.vy=0)}}function gameRadar(t,i){this.x=t,this.y=i;var e=new Image;e.src=this.x.toDataURL(),this.y.style.background=`url(${e.src})`,this.y.style.backgroundRepeat="no-repat",this.y.style.backgroundSize="cover"}console.dir("CanvasgGameJs is running !!");var gameFrame=0,gameSpeed=5;class layerB{constructor(t,i,e,s,l,h){this.x=i,this.y=e,this.image=t,this.w=s,this.h=l,this.speedModifier=h,this.speed=gameSpeed*this.speedModifier}update(){this.speed=gameSpeed*this.speedModifier,this.x=gameFrame*this.speed%this.w}draw(){ctx.save(),ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x+this.w,this.y,this.w,this.h),ctx.restore()}}
