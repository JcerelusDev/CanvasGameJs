var camera,light,reqA,SPEED,tileAnimation,saveBg,self,row,column,data,particles=[],snows=[],rains=[],pathIndex=0,isLight=!1;get=function(e){return document.querySelector(e)},getAll=function(e){return document.querySelectorAll(e)};var imSet=!1,JumpTime=0,friction=.5,isCamera=!1,objframe=0,layerframe=0,frame=0;const log=console.log;var rotImage=!1,isOnAir=!1,onFloor=!1,pStr=JSON.stringify;function Stage(){void 0==(self={stage:document.createElement("canvas")}).scale&&(self.scale=1),self.stage.style.zIndex=-1,self.add=function(e,s){this.b=s,void 0==s&&document.body.appendChild(e),void 0!==s&&"before"==s&&document.body.before(e)},self.delete=function(e){document.body.removeChild(e)},self.stage.setBg=function(s){this.c=s,e=this.c||"rgba(17,34,51,0.7)",(void 0==this.c||void 0==s||""==this.c)&&(self.stage.style.background=e),self.stage.style.background=e},window.onload=self.stage.setBg(),self.setSize=function(e,s){this.a=e*self.scale,this.b=s*self.scale/1.5,this.a&&this.b&&(gW=self.stage.width=this.a,gH=self.stage.height=this.b)},void 0==this.a&&void 0==this.b&&(gW=self.stage.width=600,gH=self.stage.height=400),camera={x:1,y:1,width:gW,height:gH},self.stage.setBgRepeat=function(e){self.stage.style.backgroundRepeat=e},self.stage.style.imageRendering="pixelated",ctx=self.stage.getContext("2d",{alpha:!1}),rectColor=function(e){ctx.fillStyle=e},strokeColor=function(e){ctx.strokeStyle=e},Rect=function(e,s=e.color){ctx.fillStyle=s,ctx.fillRect(e.x,e.y,e.w,e.h)},Stroke=function(e,s=e.color){ctx.strokeStyle=s,ctx.strokeRect(e.x,e.y,e.w,e.h)},self.overLay=function(){opacity=1,self.stage.style.zIndex=-999;var e=document.createElement("canvas");document.body.appendChild(e),e.style.width=gW+"px",e.style.height=gH+"px",e.style.position="absolute",e.style.zIndex=99999,e.style.background=`rgba(0,0,0,${opacity})`,setTimeout(function(){opacity-=.02,e.style.background=`rgba(0,0,0,${opacity})`},300),setTimeout(function(){opacity-=.04,e.style.background=`rgba(0,0,0,${opacity})`},600),setTimeout(function(){opacity-=.06,e.style.background=`rgba(0,0,0,${opacity})`},900),setTimeout(function(){opacity-=.08,e.style.background=`rgba(0,0,0,${opacity})`},1e3),setTimeout(function(){opacity-=.2,e.style.background=`rgba(0,0,0,${opacity})`},1200),setTimeout(function(){opacity-=.04,e.style.background=`rgba(0,0,0,${opacity})`},1400),setTimeout(function(){opacity=0,e.style.background=`rgba(0,0,0,${opacity})`},1500)},self.light=function(e,s,t){return isLight=!0,this.obj=e,this.radius=s,this.opacity=t,light={x:this.obj.x+this.obj.w/2,y:this.obj.y+this.obj.h/2,r:this.radius,opacity:this.opacity},this},playSound=function(e){return this.audio=new Audio(e),this.audio.currentTime=.1,this.audio.volume=.2,this.audio.play(),this},stopSound=function(e){e.audio.pause(),e.currentTime=0},Text=function(e,s,t,l,i,a,h){this.x=a,this.y=h,this.color=e||"gold",this.fontsize=t,this.fontstyle=s,this.fontfamily=l,this.t=i,void 0==this.fontweight&&(this.fontweight="bold"),void 0==this.fontstyle&&(this.fontstyle="italic"),(void 0==this.fontfamily||null==this.fontfamily)&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(e,s,t,l){ctx.clearRect(e,s,t,l)},self.getDistance=function(e,s){this.a=e,this.b=s;var t,l=Math.abs(this.a.x-this.b.x);return Math.hypot(l,Math.abs(this.a.y-this.b.y))},self.getAngle=function(e,s){return this.a=e,this.b=s,Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x)},self.setCollider=function(e,s){e.isVisible=s,"boolean"!=typeof s||(e.collider={x:e.x+e.w/4,y:e.y+e.h/4,w:e.w/2.2,h:e.h/1.35,vy:e.vy,color:"rgba(255,0,0,0.5)"},e.image||(e.collider={x:e.x+e.w/4,y:e.y,w:e.w-10,h:e.h,vy:e.vy,color:"rgba(255,0,0,0.5)"}))};var e,s,t,l,i,a,h=!1;function o(){if(reqA=requestAnimationFrame(o),a=Date.now(),frame++,(t=(a-i)/1e3)>s/700&&(i=a-t%s,objframe++,layerframe++,self.update(t),friction=isJumping?1:.7),SPEED=friction,ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="low",ctx.save(),isLight?(ctx.fillStyle="transparent",ctx.fillRect(0,0,gW,gH)):(ctx.fillStyle=e,ctx.fillRect(0,0,gW,gH)),self.drawGame?self.drawGame():self.render(),isLight&&((cv=document.createElement("canvas")).width=gW,cv.height=gH,cv.style.position="absolute",ctx.save(),ctx.beginPath(),ctx.fillStyle="rgba(255,255,255,0.35)",ctx.globalCompositeOperation="lighter",ctx.arc(light.x*self.scale,light.y*self.scale,light.r,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),ctx.fillStyle=`rgba(0,0,0,${light.opacity})`,ctx.globalCompositeOperation="overlay",ctx.fillRect(camera.x*self.scale,camera.y*self.scale,cv.width,cv.height),ctx.drawImage(cv,0,0)),h&&(ctx.strokeStyle=camera.color,ctx.lineWidth=2*self.scale,ctx.strokeRect(camera.x*self.scale,camera.y*self.scale,camera.width*self.scale,camera.height*self.scale)),t>s/5e3){for(var l=0;l<particles.length;l++)(particle=particles[l]).update(),particle.draw();for(var l=0;l<snows.length;l++)canDraw(snows[l],camera)?(ctx.beginPath(),ctx.fillStyle=snows[l].color,ctx.arc(snows[l].x,snows[l].y+=snows[l].vy,snows[l].r,1.8,1.7*Math.PI),ctx.fill(),ctx.closePath()):kill(snows,l);for(var c=0;c<rains.length;c++)ctx.save(),canDraw(rains[c],camera)?rains[c].drawSprite():kill(rains,c),ctx.restore()}ctx.restore()}return self.setCam=function(e,s,t){if(1==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2),y=Math.floor(gH/2)),1.1==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.1),y=Math.floor(gH/2)),1.2==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.2),y=Math.floor(gH/2)),1.3==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.4),y=Math.floor(gH/2)),1.4==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.5),y=Math.floor(gH/2)),1.5==self.scale&&(camera={x:0,y:0,width:gW/self.scale|0,height:gH/self.scale|0,color:"red"},x=gW/3|0,y=gH/2|0),1.6==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=gW/3,y=gH/2.2),1.7==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=gW/3,y=gH/2.3),1.8==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=gW/3,y=gH/2.5),1.9==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=gW/3,y=gH/2.7),2==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=gW/5,y=gH/3),void 0==s){ctx.translate(gW/2-(e.x-5),gH/2-(e.y-5));return}this.debug=t,this.debug&&"boolean"==typeof this.debug&&(h=!0),camera.x=e.x+e.w-x,camera.y=e.y+e.h-y,camera.x<=0&&(camera.x=0),camera.y<=0&&(camera.y=0),camera.x>=s.width-camera.width&&(camera.x=s.width-camera.width),camera.y>s.height-camera.height&&(camera.y=s.height-camera.height),e.x+camera.width>=x&&(ctx.translate(-camera.x*self.scale,0),isCamera=!0),e.y+camera.height>=y&&(ctx.translate(0,-camera.y*self.scale),isCamera=!0),e.x<x&&(isCamera=!1),e.y<y&&(isCamera=!1)},self.setAnimation=function(e){s=1e3/e,l=i=Date.now(),reqA=requestAnimationFrame(o)},self.stopAnimation=function(){cancelAnimationFrame(reqA)},kill=function(e,s){e.splice(s,1)},self.isHoriBorder=function(e,s){if(void 0==e.r&&void 0==s.x){if(e.x<=0||e.x>=s.width-e.w||e.x>=s.w-e.w)return!0}else if(void 0==e.r&&void 0!==s.x){if(e.x<=s.x||e.x>=s.width-e.w||e.x>=s.w-e.w)return!0}else if(void 0!=e.r&&void 0!=s.x){if(e.x<=s.x||e.x>=s.width-e.r||e.x>=s.w-e.r)return!0}else if(void 0!=e.r&&void 0==s.x&&(e.x<=0||e.x>=s.width-e.r||e.x>=s.w-e.r))return!0},self.isVertiBorder=function(e,s){if(void 0==e.r&&void 0!==s.x){if(e.y<=s.y||e.y>=s.height-e.h||e.y>=s.h-e.h)return!0}else if(void 0!=e.r&&void 0!==s.y&&(e.y<=s.y||e.y>=s.height-e.r||e.x>=s.h-e.r))return!0;if(void 0==e.r&&void 0==s.y){if(e.y<=0||e.y>=s.height-e.h||e.y>=s.h-e.h)return!0}else if(void 0!=e.r&&void 0==s.y&&(e.y<=0||e.y>=s.height-e.r||e.x>=s.h-e.r))return!0},self}var Deg2Rad=Math.PI/180;function isOverlap(e,s){var t=Math.abs(s.x-(e.x+e.w/2)),l=Math.abs(s.y-(e.y+e.h/2));if(t<=s.r+s.r+e.w/2&&l<=s.r+s.r+e.h/2)return!0}function isCollide(e,s){if(e.x+e.w>=s.x&&e.x<=s.x+s.w&&e.y+e.h>=s.y&&e.y<=s.y+s.h||e.x+e.w>=s.x&&e.x<=s.x+s.width&&e.y+e.h>=s.y&&e.y<=s.y+s.height||e.x+e.w>=s.x&&e.x<=s.x+s.w&&e.y+e.h+e.vy>=s.y&&e.y<=s.y+s.h)return!0}function isInterCirc(e,s){if(dx=e.x-s.x,dy=e.y-s.y,sumr=e.r+s.r,(distance=Math.sqrt(dx*dx+dy*dy))<=sumr)return!0}Sprite=function(e,s,t,l,i,a,h,o,c){this.x=e,this.y=s,this.w=t,this.h=l,this.vx=i,this.vy=a,this.id=c,this.rotation=o||0,this.angle=0,this.flipX=!1,this.flipY=!1,this.setGravity=function(e){this.gravity=e,this.shadow},this.color=h,this.setBody=e=>{this.gv=e,void 0==this.gv?(this.setGravity(4),this.vy+=this.gravity*SPEED,this.y+=this.vy):(this.setGravity(this.gv),this.vy+=this.gravity*SPEED,this.y+=this.vy)},this.Rotation=function(){ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.angle),ctx.translate(-this.x*self.scale,-this.y*self.scale)},this.color||(this.image=new Image),this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){for(var e=!1,s=0;s<this.bullet.length;s++){var t=this.bullet[s];t.image?ctx.drawImage(t.image,t.x*self.scale,t.y*self.scale,t.w*self.scale,t.h*self.scale):(e||(ctx.fillStyle=t.color,ctx.fillRect(t.x*self.scale,t.y*self.scale,t.w*self.scale,t.h*self.scale)),0!=t.w||0!=t.h||t.angle?0==t.w&&0==t.h&&0!=t.angle?(ctx.beginPath(),ctx.arc(t.x*self.scale,t.y*self.scale,t.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),t.x+=10*Math.cos(t.angle),t.y+=10*Math.sin(t.angle)):0!=t.w&&0!=t.h&&0!=t.angle&&(ctx.save(),ctx.translate((t.x+t.w/2)*self.scale,(t.y+t.h/2)*self.scale),ctx.rotate(t.angle),ctx.fillRect(-this.bullet[s].w/2*self.scale,-this.bullet[s].h/2*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore(),t.x+=15*Math.cos(t.angle+90*Deg2Rad),t.y+=15*Math.sin(t.angle+90*Deg2Rad),e=!0):(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()))}if(this.flipX&&!this.rotation)for(var s=0;s<this.bullet.length;s++){if(this.bullet[s].image){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}if(this.bullet[s].w>0&&this.bullet[s].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[s].color,ctx.fillRect(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}if(0==this.bullet[s].w&&0==this.bullet[s].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.rotation&&!this.flipX&&!rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.translate(-this.x*self.scale,-this.y*self.scale),ctx.restore();return}if(this.rotation&&this.flipX&&!rotImage){ctx.save(),this.x=(this.x-this.w/1.1)*self.scale,this.y=(this.y-this.h/2.8)*self.scale,ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,1),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle){ctx.save(),ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),this.shadow&&(this.r=10,ctx.save(),ctx.beginPath(),ctx.fillStyle="#555",ctx.arc(this.x+this.w/2,this.y+3*this.r,this.r,0,Math.PI),ctx.fill(),ctx.closePath(),ctx.restore()),this.isVisible&&(ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale))},this.drawSpriteImg=function(){if(this.isVisib&&(ctx.strokeStyle=this.boxCollider.color,ctx.strokeRect(this.boxCollider.x,this.boxCollider.y,this.boxCollider.w,this.boxCollider.h)),this.flipX&&!rotImage)for(var e=0;e<this.bullet.length;e++){if(imSet){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[e].image,-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore();return}for(var s=0;s<this.bullet.length;s++){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[s].color,ctx.fillRect((-this.bullet[s].x-this.bullet[s].w)*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.globalAlpha=1,ctx.restore();return}}for(var t=!1,e=0;e<this.bullet.length;e++){var l=this.bullet[e];if(!l.image&&(t||(ctx.fillStyle=this.bullet[e].color,ctx.fillRect(this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,this.bullet[e].w*self.scale,this.bullet[e].h*self.scale)),0!=this.bullet[e].w||0!=this.bullet[e].h||this.angle?0==this.bullet[e].w&&0==this.bullet[e].h&&l.angle?(ctx.beginPath(),ctx.arc(this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,this.bullet[e].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),l.x+=15*Math.cos(l.angle-90*Deg2Rad),l.y+=15*Math.sin(l.angle-90*Deg2Rad)):0==l.r&&l.angle&&(ctx.save(),ctx.translate((l.x+l.w/2)*self.scale,(l.y+l.h/2)*self.scale),ctx.rotate(l.angle),ctx.fillRect(-this.bullet[e].w/2*self.scale,-this.bullet[e].h/2*self.scale,this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore(),l.x+=15*Math.cos(l.angle-90*Deg2Rad),l.y+=-2+15*Math.sin(l.angle-90*Deg2Rad),t=!0):(ctx.beginPath(),ctx.arc(this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,this.bullet[e].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),this.bullet[e].image&&this.bullet[e].flipX){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[e].image,-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore();return}if(this.bullet[e].image&&this.bullet[e].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[e].image,this.bullet[e].x*self.scale,-this.bullet[e].y*self.scale,this.bullet[e].w*self.scale,-this.bullet[e].h*self.scale),ctx.restore();return}}if(this.angle&&"up"==this.look||"down"==this.look){ctx.save(),centerX=(this.x+this.w/2)*self.scale,centerY=(this.y+this.h/2)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle),ctx.drawImage(this.image,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle&&"left"==this.look||"right"==this.look){ctx.save(),centerX=(this.x+this.w/1.5)*self.scale,centerY=(this.y+this.h/1.5)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle+90*Deg2Rad),ctx.drawImage(this.image,-this.w/2*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.flipX&&!this.rotation)for(var e=0;e<this.bullet.length;e++)if(this.bullet[e].image)ctx.drawImage(this.bullet[e].image,-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.globalAlpha=1;else{if(this.bullet[e].w>0&&this.bullet[e].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[e].color,ctx.fillRect(-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].w*self.scale,this.bullet[e].h*self.scale),ctx.restore();return}if(0==this.bullet[e].w&&0==this.bullet[e].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[e].x*self.scale,this.bullet[e].y*self.scale,-this.bullet[e].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.flipX&&!rotImage){if(rotImage)return;ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.image,-this.x*self.scale,this.y*self.scale,-this.w*self.scale,this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipX&&imSet&&!rotImage){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.flipY&&!this.rotation&&!rotImage&&imSet){if(rotImage)return;ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipY&&!this.rotation){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.rotation&&(rotImage=!0),this.rotation&&(rotImage=!0),this.rotation&&this.flipX&&rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,1),ctx.rotate(this.rotation),ctx.drawImage(this.image,-this.w/8,-this.h/8,this.w,this.h),ctx.restore();return}},this.addBullet=function(e,s,t,l,i,a,h){this.obj={x:e,y:s,w:t,h:l,color:i,r:a,angle:h},this.bullet.push(this.obj)},this.addBulletIm=function(e,s,t,l,i,a){this.obj={x:e,y:s,w:t,h:l,flipX:!1,flipY:!1,angle:a},imSet=!0,this.obj.image=new Image,this.obj.image.src=i,this.bullet.push(this.obj)};var f=0;this.SpriteRot=function(){f+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,f)},this.drawSpriteRot=function(e,s,t,l,i){ctx.save(),ctx.translate(e,s),ctx.rotate(i*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-t/2*self.scale,-l/2*self.scale,t*self.scale,l*self.scale),ctx.restore()};var f=0;this.SpriteImgRot=function(){f+=8,this.drawSpriteImgRot(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale,f)},this.drawSpriteImgRot=function(e,s,t,l,i,a){return ctx.save(),ctx.translate(s,t),ctx.rotate(a*Deg2Rad),ctx.drawImage(this.image,-l/2*self.scale,-i/2*self.scale,l*self.scale,i*self.scale),ctx.restore(),this}},Circle=function(e,s,t,l,i,a,h){this.x=e,this.y=s,this.r=t,this.vx=l,this.vy=i,this.id=h,this.setGravity=function(e){this.gravity=e,this.isDrawn=!1},this.color=a,this.bullet=[],this.bullet.image=new Image,this.setBody=e=>{this.gv=e,void 0==this.gv?(this.setGravity(4),this.vy+=this.gravity*SPEED,this.y+=this.vy):(this.setGravity(this.gv),this.vy+=this.gravity*SPEED,this.y+=this.vy)},this.drawCirc=function(){for(b of(ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x*self.scale,this.y*self.scale,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),this.isDrawn=!0,this.bullet))ctx.fillStyle=b.color,b.w>0&&b.h>0&&(ctx.fillStyle=ctx.fillRect(b.x*self.scale,b.y*self.scale,b.w*self.scale,b.h*self.scale)),0==b.w&&0==b.h&&(ctx.beginPath(),ctx.arc(b.x*self.scale,b.y*self.scale,b.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())},this.addBullet=function(e,s,t,l,i,a){this.obj={x:e,y:s,w:t,h:l,color:i,r:a},this.bullet.push(this.obj)},this.addBulletIm=function(e,s,t,l,i){this.obj={x:e,y:s,w:t,h:l,flipX:!1,flipY:!1},imSet=!0,this.obj.image=new Image,this.obj.image.src=i,this.bullet.push(this.obj)}},SpriteSheet=function(e,s,t,l,i,a,h,o,c,f,n){this.row=s,this.col=e,this.sw=t,this.sh=l,this.x=i,this.y=a,this.w=h,this.h=o,this.vx=c,this.vy=f,this.id=n,this.angle=0,this.flipX=!1,this.flipY=!1,this.setGravity=function(e){this.gravity=e},this.setBody=e=>{this.gv=e,void 0==this.gv?(this.setGravity(4),this.vy+=this.gravity*SPEED,this.y+=this.vy):(this.setGravity(this.gv),this.vy+=this.gravity*SPEED,this.y+=this.vy)},this.isVisible=!1,imSet=!0,this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){this.flipX||this.rotation||this.angle||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),(this.angle&&"up"==this.look||"down"==this.look)&&(ctx.save(),centerX=(this.x+this.w/1.5)*self.scale,centerY=(this.y+this.h/1.5)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle+90*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.w/1.5*self.scale,-this.h/1.5*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore()),(this.angle&&"left"==this.look||"right"==this.look)&&(ctx.save(),centerX=(this.x+this.w/1.5)*self.scale,centerY=(this.y+this.h/1.5)*self.scale,ctx.translate(centerX,centerY),ctx.rotate(this.angle+90*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.w/1.5*self.scale,-this.h/1.5*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore());for(var e=!1,s=0;s<this.bullet.length;s++){var t=this.bullet[s];if(!t.image&&(e||(ctx.fillStyle=this.bullet[s].color,ctx.fillRect(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale)),0!=this.bullet[s].w||0!=this.bullet[s].h||this.angle?0==this.bullet[s].w&&0==this.bullet[s].h&&t.angle?(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),t.x+=15*Math.cos(t.angle-90*Deg2Rad),t.y+=15*Math.sin(t.angle-90*Deg2Rad)):0==t.r&&t.angle&&(ctx.save(),ctx.translate((t.x+t.w/1.5)*self.scale,(t.y+t.h/2)*self.scale),ctx.rotate(t.angle),ctx.fillRect(-this.bullet[s].w/1.5*self.scale,-this.bullet[s].h/2*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore(),t.x+=15*Math.cos(t.angle-90*Deg2Rad),t.y+=-2+15*Math.sin(t.angle-90*Deg2Rad),e=!0):(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),this.bullet[s].image&&this.bullet[s].flipX)ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();else if(this.bullet[s].image&&this.bullet[s].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,-this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,-this.bullet[s].h*self.scale),ctx.restore();return}else!this.bullet[s].image||this.bullet[s].flipY||this.bullet[s].flipX||ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale)}if(this.flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.restore();return}if(this.flipX){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.x*self.scale,this.y*self.scale,-this.w*self.scale,this.h*self.scale),ctx.restore();return}this.flipY||this.flipX,this.isVisible&&(ctx.fillStyle=this.collider.color,ctx.fillRect(this.collider.x*self.scale,this.collider.y*self.scale,this.collider.w*self.scale,this.collider.h*self.scale))},this.addBullet=function(e,s,t,l,i,a,h){this.obj={x:e,y:s,w:t,h:l,color:i,r:a,angle:h},this.bullet.push(this.obj)},this.addBulletIm=function(e,s,t,l,i,a){this.obj={x:e,y:s,w:t,h:l,flipX:!1,flipY:!1,angle:a},this.obj.image=new Image,this.obj.image.src=i,this.bullet.push(this.obj)};var $=0;this.SpriteSheetRot=function(){$+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,$)},this.drawSpriteSheetRot=function(e,s,t,l,i,a,h,o,c,f){ctx.save(),ctx.translate(a*self.scale,h*self.scale),ctx.rotate(f*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-(o/2)*self.scale,-(c/2)*self.scale,o*self.scale,c*self.scale),ctx.restore()}};var isDrawable=!0;function tileMap(e,s,t,l,i,a,h,o,c){return this.image=new Image,this.image.src=h,this.lev=e,this.colTCount=s,this.rowTCount=e.length,this.total=l,this.ts=i,this.s=a,this.w=o,this.h=c,this.image.onload=this.drawLayer,this.drawLayer=function(){for(var e=0;e<this.rowTCount;e++)for(var s=0;s<this.colTCount;s++){var t=this.lev[e][s],h=t/l|0,o=t%l|0;(isDrawable=!(o+i/2<camera.x-i/2)&&!(o+i>camera.x+camera.width+i/2))&&void 0==this.w&&void 0==this.h&&ctx.drawImage(this.image,o*i,h*i,i,i,s*a*self.scale,e*a*self.scale,a*self.scale,a*self.scale),this.w&&this.h&&ctx.drawImage(this.image,o*i,h*i,i,i,s*a*self.scale,e*a*self.scale,this.w*self.scale,this.h*self.scale)}},this}var goLeft=!1,goRight=!1;function isFollow(e,s){gap=e.x-s.x;var t=Math.abs(e.y-s.y);return gap<=20&&gap>=-20?void 0:gap<=-20&&gap>=-140&&t<=20?(goLeft=!0,goRight=!1,!0):gap>=0&&gap<=140&&t<=20?(goLeft=!1,goRight=!0,!0):void 0}function createGrid(e,s,t,l){this.gap=e,this.gW=s,this.gH=t,this.color=l,this.drawGrid=function(){for(var e=this.gap;e<this.gW;e+=this.gap)this.gW>=this.gH?(ctx.moveTo(e,0),ctx.lineTo(e,this.gW)):(ctx.moveTo(e,0),ctx.lineTo(e,this.gH));for(var s=this.gap;s<this.gH;s+=this.gap)ctx.moveTo(0,s),ctx.lineTo(this.gW,s);ctx.strokeStyle=this.color,ctx.lineWidth=1,ctx.stroke()}}function addNumber(e,s,t,l,i,a){return this.col=e,this.row=s,this.tSize=t,this.color=l,this.spaceX=i,this.spaceY=a,this.show=()=>{for(var e=0;e<=this.row;e++)for(var s=0;s<=this.col;s++){var t=s+e*this.col;ctx.font="9px arial bold",ctx.fillStyle=this.color,ctx.fillText(t,s*this.tSize+this.spaceX,e*this.tSize+this.spaceY)}},this}let loader=!1,that;function tiledMap(e,s,t){that=this,that.path=e,that.image=s=new Image,that.size=t,that.load=function(){(xhr=new XMLHttpRequest).onload=function(){4==this.readyState&&(data=JSON.parse(xhr.response),loader=!0,that.loadTileset(data))},xhr.open("get",that.path),xhr.send(!0)},that.loadTileset=function(e){var s=/..\/+/;for(tile of data.tilesets)that.image.src=tile.image.replace(s,"")},that.renderLayers=function(e){(e=Array.isArray(e=data.layers)?e:data.layers).forEach(that.renderLayer())},animL=[];var l=!1;return that.renderLayer=function(e){for(r=0;r<e.height;r++)for(col=0;col<e.width;col++){let s=col+r*e.width,i=e.data[s];tX=~~(--i%(tile.imagewidth/t))*t,tY=Math.floor(i/(tile.imagewidth/t))*t,dX=~~(s%e.width)*t,dY=Math.floor(s/e.width)*t,(isDrawable=!(dX+t<camera.x||dX+t>camera.x+camera.width+100))&&ctx.drawImage(that.image,tX,tY,t,t,dX*self.scale,dY*self.scale,t*self.scale,t*self.scale),tile.tiles&&tile.tiles.forEach((a,h)=>{if(animL.push(a),0!=i&&void 0!=animL[i]||null!=animL[i]){l=!0;var o=animL[i].animation;tIndex=layerframe%(numFrames=o.length),l&&i==a.id&&(tX=(i=o[tIndex].tileid+1)%(tile.imagewidth/t)*t,tY=Math.floor(i/(tile.imagewidth/t))*t,dX=s%e.width*t,dY=Math.floor(s/e.width)*t,(isDrawable=!(dX+t<camera.x||dX+t/2>camera.x+camera.width+100))&&ctx.drawImage(that.image,tX,tY,t,t,dX*self.scale,dY*self.scale,t*self.scale,t*self.scale))}})}var a=!1;self.objectAnimation=tileAnimation=function(s,t){for(e of(that.val=s,this.nom=t,data.layers))if("objectgroup"==e.type&&this.nom==e.name&&tile.tiles)for(let l of tile.tiles){frameIndex=objframe%(anim=l.animation).length,i=anim[frameIndex].tileid,tileColumns=tile.imagewidth/tile.tilewidth,tileRows=tile.imageheight/tile.tileheight;var i,h=tile.tileheight,o=tile.tilewidth;for(var c of e.objects)c.hasOwnProperty("gid")&&c.gid==that.val&&this.nom==e.name?a=!0:(a=!1,log(" Animation Layer's name is not defined or gidValue is incorrect in tileAnimation \n\n please read the documentation so that you may use tileAnimation correctly !!")),column=Math.floor(i%tile.columns),objrow=Math.floor(i/tile.columns),(isDrawable=!(c.x+h<camera.x)&&!(c.x+h/2>camera.x+camera.width))||(a=!1),a&&ctx.drawImage(that.image,h*column,o*objrow,h,o,c.x*self.scale,(c.y-o)*self.scale,c.width*self.scale,c.height*self.scale)}}},that.RenderObjectLayer=function(e){for(var s of(this.gid=e,gid=this.gid,data.layers))if("objectgroup"==s.type){for(var t of(tile.rows=tile.imageheight/tile.tileheight,s.objects))if(t.hasOwnProperty("gid")&&t.gid==gid){t.gid!=gid&&(t.gid=gid);var l=tile.imagewidth/tile.columns,i=tile.imageheight/tile.rows;column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),isDrawable=!(t.x+l<camera.x)&&!((t.x+l/2)*self.scale>(camera.x+camera.width)*self.scale+100),t.hasOwnProperty("gid")&&t.gid!=that.val&&!s.hasOwnProperty("properties")&&isDrawable&&ctx.drawImage(that.image,l*column,i*obj2row,l,i,t.x*self.scale,(t.y-t.height)*self.scale,t.width*self.scale,t.height*self.scale)}else if(t.hasOwnProperty("gid")&&"auto"==t.type){gid=t.gid;var l=tile.imagewidth/tile.columns,i=tile.imageheight/tile.rows;column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),isDrawable=!(t.x+l<camera.x)&&!((t.x+l/2)*self.scale>(camera.x+camera.width)*self.scale+100),t.hasOwnProperty("gid")&&t.gid!=that.val&&!s.hasOwnProperty("properties")&&isDrawable&&ctx.drawImage(that.image,l*column,i*obj2row,l,i,t.x*self.scale,(t.y-t.height)*self.scale,t.width*self.scale,t.height*self.scale)}}},that}function canDraw(e,s){return!(e.x+e.w<=s.x)&&!(e.x+e.w>=s.x+s.width)&&!(e.x+e.r<=s.x)&&!(e.x+e.r>=s.x+s.width)}function tiledCollider(e,s){var t=Math.abs(e.y-e.h-s.y+s.height);return!s.gid&&e.x+e.w>=s.x&&e.x<=s.x+s.width&&e.y+e.h>=s.y&&e.y<=s.y+s.height||e.x+e.w>=s.x&&e.x<=s.x+s.w&&e.y+e.h>=s.y&&e.y<=s.y+s.h||!!s.gid&&e.x+e.w>=s.x&&e.x<=s.x+s.width&&e.y+e.h>=s.y&&e.y<=s.y+s.height&&t<=20||void 0}var isX=!1;function VrpgCollider(e,s){for(layer of(onFloor=!0,data.layers))if("objectgroup"==layer.type&&layer.name==e)for(let t of layer.objects){let l=s.collider;if(s.collider){if(isCollide(l,t)){if(s.vy<0&&l.y>t.y){s.vy=0;let i=l.y-s.y;s.y=t.y+t.height-i+.01,l.y=t.y+t.height-i+.01;break}if(s.vy>0&&l.y<t.y){s.vy=0,l.y,s.y,l.h,s.y=t.y-t.height-.01;break}}}else s.x+s.w>=t.x&&s.x<=t.x+t.width&&s.y+s.h>=t.y&&s.y<=t.y+t.height&&(s.x=s.oldX,s.y=s.oldY)}}function HrpgCollider(e,s){if(onFloor=!0,(isX=0!=s.vx)&&(s.vy=0),0!=!s.vy){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==e)for(let t of layer.objects){let l=s.collider;if(s.collider){if(isCollide(l,t)){if(s.vx>0){s.vy=0;let i=l.x-s.x+l.w;return s.x=t.x-i-.01,!0}if(s.vx<0){onFloor=!0,s.vy=0;let a=l.x-s.x;return s.x=t.x+t.width-a+.01,!0}}}else s.x+s.w>=t.x&&s.x<=t.x+t.width&&s.y+s.h>=t.y&&s.y<=t.y+t.height&&(s.x=s.oldX,s.y=s.oldY)}}}var canJump=!1,Lside=!1,Rside=!1,Uside=!1,Dside=!1;function RpgFollow(e,s,t){this.gap=t;var l=Math.atan2(e.y-s.y,e.x-s.x);e.x,s.x,e.y,s.y;var i=self.getDistance(e,s);if(i<=this.gap){if(i<=20&&i>=-20)return;s.vx=Math.cos(l),s.vy=Math.sin(l),s.x+=s.vx,s.y+=s.vy,s.vx<0?(Lside=!0,Rside=!1,Uside=!1,Dside=!1):s.vx>0?(Rside=!0,Lside=!1,Uside=!1,Dside=!1):s.vy<0?(Uside=!0,Rside=!1,Dside=!1,Lside=!1):s.vy>0&&(Dside=!0,Rside=!1,Uside=!1,Lside=!1)}}function gameRadar(e,s){this.x=e,this.y=s;var t=new Image;t.src=this.x.toDataURL(),this.y.style.background=`url(${t.src})`,this.y.style.backgroundRepeat="no-repat",this.y.style.backgroundSize="cover"}var gameFrame=0,gameSpeed=5;class layerB{constructor(e,s,t,l,i,a){this.x=s,this.y=t,this.image=e,this.w=l,this.h=i,this.speedModifier=a,this.speed=gameSpeed*this.speedModifier}update(){this.speed=gameSpeed*this.speedModifier,this.x=gameFrame*this.speed%this.w}draw(){ctx.save(),ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x+this.w,this.y,this.w,this.h),ctx.restore()}}console.dir("CanvasgGameJs is running !!");var isJumping=!1;function LeftCollider(e,s,t,l){for(var i=0;i<e.length;i++)for(var a=0;a<e[0].length;a++)if(e[i][a]==l){var h=a*t,o=i*t;if(block=new Sprite(h,o,t,t,0,0,"red"),s.collider){let c=s.collider;if(s.vx>0&&c.x+c.w>=block.x&&c.x<=block.x+block.w&&c.y+c.h>=block.y&&c.y<=block.y+block.h&&c.y>block.y){let f=c.x-s.x+c.w;s.x=block.x-f-.01;break}}else s.vx>0&&s.x+s.w>=block.x&&s.x<=block.x+block.w&&s.y+s.h>=block.y&&s.y<=block.y+block.h&&(s.x=block.x-s.w-1)}}function RightCollider(e,s,t,l){for(var i=0;i<e.length;i++)for(var a=0;a<e[0].length;a++)if(e[i][a]==l){var h=a*t,o=i*t;if(block=new Sprite(h,o,t,t,0,0,"red"),s.collider){let c=s.collider;if(s.vx<0&&c.x+c.w>=block.x&&c.x<=block.x+block.w&&c.y+c.h>=block.y&&c.y<=block.y+block.h&&c.y>block.y){c.y,s.y,s.x=s.oldX+.01;break}}else if(s.vx<0&&s.x+s.w>=block.x&&s.x<=block.x+block.w&&s.y+s.h>=block.y&&s.y<=block.y+block.h){s.x=block.x+block.w+1;break}}}function TopCollider(e,s,t,l){for(var i=0;i<e.length;i++)for(var a=0;a<e[0].length;a++){var h=a*t,o=i*t,c=[];if(e[i][a]==l){c.push(new Sprite(h,o,t,t,0,0,"red"));for(var f=0;f<c.length;f++)var n=c[f];if(s.collider){let $=s.collider;if(s.vy>0&&$.x+$.w>n.x&&$.y+$.h+s.vy>n.y&&$.x<n.x+n.w&&$.y+s.vy<n.y+n.h&&s.y<n.y){$.y,s.y,$.h,s.vy=0,s.y=n.y-s.h-.01,s.collider.y=n.y-s.collider.h-.01,JumpTime=0;break}}else if(s.vy>0&&s.x+s.w>n.x&&s.y+s.h+s.vy>n.y&&s.x<n.x+n.w&&s.y+s.vy<n.y+n.h&&s.y<n.y){s.vy=0,s.y=n.y-s.h-.01,s.shadow=!1,JumpTime=0;break}}}}function BottomCollider(e,s,t,l){for(var i=0;i<e.length;i++)for(var a,h=0;h<e[0].length;h++)if(e[i][h]==l){if(a={x:tx=h*t,y:ty=i*t,w:t,h:t},s.collider){let o=s.collider;if(isJumping&&s.vy<0&&o.x-s.vx+o.w>a.x&&o.y+o.h>=a.y&&o.x-s.vx<=a.x+a.w&&o.y<=a.y+a.h){let c=o.y-s.y;s.y=a.y+a.h-5-c+9,s.collider.y=a.y+a.h-c+9,isOnAir=!1,isJumping=!1,s.vy=0;break}}else if(isJumping&&s.x+s.w>a.x&&s.y+s.h>=a.y&&s.x<=a.x+a.w&&s.y<=a.y+a.h){s.y=a.y+a.h+.01,s.vy=0,isOnAir=!1,isJumping=!1;break}}}function TopTiledCollider(e,s){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==e)for(let t of layer.objects){let l=s.collider;if(canDraw(t,camera)&&s.vy>0&&s.collider.x+s.collider.w>=t.x&&s.collider.y+s.collider.h+s.vy>=t.y&&s.collider.x<=t.x+t.width&&s.collider.y+s.vy<=t.y+t.height&&s.y<t.y){s.vy=0,onFloor=!0,l.y,s.y,l.h,s.y=t.y-s.h-.01,s.collider.y=t.y-s.collider.h-.01,s.shadow=!1,JumpTime=0,onFloor=!0;return}}}function BottomTiledCollider(e,s){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==e)for(let t of layer.objects){let l=s.collider;if(canDraw(t,camera)&&isJumping&&s.vy<0&&l.x-s.vx+l.w>t.x&&l.y+l.h>=t.y&&l.x-s.vx<=t.x+t.width&&l.y<=t.y+t.height&&l.y+l.h>t.y+t.height){s.vy=0;let i=l.y-s.y;s.y=t.y+t.height-7-i+9,s.collider.y=t.y+t.height-i+9;return}}}function LeftTiledCollider(e,s){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==e)for(let t of layer.objects){let l=s.collider;if(isCollide(l,t)&&s.vx>0){let i=l.x-s.x+l.w;s.x=t.x-i-.01}}}function RightTiledCollider(e,s){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==e)for(let t of layer.objects){let l=s.collider;if(isCollide(l,t)&&s.vx<-0){let i=l.x-s.x;return s.x=t.x+t.width-i+.01,!0}}}function isFlipCollide(e,s){var t=Math.abs(e.x-s.x),l=Math.abs(e.y-s.y);if(s.r){if(e.flipX&&e.x+e.w>s.x&&e.x-1.5*e.w<=s.x+1.5*s.r&&e.y+e.h>s.y&&e.y<s.y+1.8*s.r||t<s.r+e.w&&l<s.r+e.h){if(e.flipX&&e.x<s.x+s.r/1.8)return;return!0}if(!e.flpiX&&e.x+e.w/1.5>s.x&&e.x<s.x+s.r&&e.y+e.h>s.y&&e.y<s.y+s.r/1.8||t<s.r+e.w&&l<s.r+e.h)return!0}if(void 0==s.r){var t=Math.abs(e.x-s.x),l=Math.abs(e.y-s.y);if(!e.flipX&&e.x+e.w>=s.x&&e.x<=s.x+s.w&&e.y+e.h>=s.y&&e.y<=s.y+1.8*s.h)return!0;if(e.flipX&&e.x+e.w>=s.x&&e.x-1.8*e.w<=s.x+s.w&&e.y+e.h>=s.y&&e.y<=s.y+1.8*s.h){if(e.flipX&&e.x<s.x+s.w)return;return!0}}}Array.prototype.parse2D=function(e){for(var s=[],t=0;t<this.length;t+=e)s.push(this.slice(t,t+e));return s};var partImage=new Image;function Particles(e,s,t,l,i,a){this.name=i,this.x=e+1.5,this.y=s,this.size=t/1.5*self.scale,this.alpha=1,this.friction=.8,this.vx=-.5*Math.random()+-5.7*Math.random(),this.vy=(Math.random()-3.2)*Math.random()*2,this.update=function(){this.vx*=this.friction,this.x+=this.vx,this.vy+=3,frame%4==0&&(this.y+=this.vy),"fire"==this.name?(this.color="#720",this.vy-=3.6,this.y+=this.vy*this.friction):"dust"==this.name?(this.color="white",this.vy-=1.6,this.y=l.y+l.h,this.y+=this.vy*this.friction,this.size=.5,l.vx>0&&!isJumping?this.x+=-5*Math.random():l.vx<0&&!isJumping?this.x-=-5*Math.random():l.vy>0&&!isJumping?this.y+=-5*Math.random():l.vy<0&&!isJumping&&(this.y-=-5*Math.random())):"rainbow"==this.name?(this.color="#"+Math.random().toString(16).substr(-6),this.vy-=3.5,this.y+=this.vy):"waterfall"==this.name?(this.color="rgba(200,200,200,0.4)",this.vy-=1.5,this.y+=this.vy*this.friction):"blood"==this.name?(this.color="rgba(255,000,000,1)",this.vy-=1.5,this.y+=this.vy*this.friction,this.size=(.8*Math.random()+.07)*self.scale):"poison"==this.name?(this.color="rgba(205,80,255,0.8)",this.vy-=3.5,this.y+=this.vy):"smoke"==this.name?(this.color="rgba(0,0,0,1)",this.vy-=3.5,this.y+=this.vy):l.color?this.color=l.color:this.color="#"+Math.random().toString(16).substr(-6)},this.draw=function(){for(let e=0;e<particles.length;e++){var s=particles[e];s.dx=l.x-s.x,s.dy=l.y-s.y;var t=Math.hypot(s.dx,s.dy);t>=10&&"dust"==this.name&&(this.alpha-=.02,this.alpha<=.3&&(particles[0]&&(this.alpha=1),kill(particles,e))),"dust"!=this.name&&t>=20&&(this.alpha-=.2,this.alpha<=.1&&(particles[0]&&(this.alpha=1),kill(particles,e)))}if(l.image&&"self"==this.name){partImage.src=l.image.src,ctx.save(),ctx.globalAlpha=this.alpha,canDraw(l,camera)&&ctx.drawImage(partImage,this.x*self.scale,this.y*self.scale,5.5*this.size*self.scale,3.5*this.size*self.scale),ctx.restore();return}ctx.save(),ctx.globalAlpha=this.alpha,ctx.fillStyle=this.color,"fire"==this.name?(ctx.shadowBlur=4,ctx.shadowColor="rgba(240,200,10,0.8)"):ctx.shadowColor=this.color,canDraw(l,camera)&&ctx.beginPath(),ctx.arc(this.x*self.scale,this.y*self.scale,1.9*this.size*self.scale,0,2*Math.PI),ctx.fill(),ctx.restore()}}function createParticle(e,s,t,l){this.thesize=s,this.target=e;for(var i=0;i<s;i++)e.image&&canDraw(this.target,camera)&&onFloor&&particles.push(new Particles(e.x+e.w/2||e.x,e.y,3*Math.random()+.3,e,t)),"fire"==t||"waterfall"==t||"smoke"==t||"rainbow"==t&&"dust"!=t?canDraw(this.target,camera)&&particles.push(new Particles(e.x+e.w/2||e.x,e.y,1.5*Math.random()+.2,e,t)):"dust"==t&&onFloor&&canDraw(this.target,camera)?particles.push(new Particles(e.x+e.w/2||e.x,e.y,2*Math.random()+.2,e,t)):canDraw(this.target,camera)&&"dust"!=t&&particles.push(new Particles(e.x+e.w/2||e.x,e.y,3*Math.random()+.2,e,t));return this}function hitBox(e,s,t){var l,i=Math.abs(e.x-s.x);if(Math.hypot(i,Math.abs(e.y-s.y))<=t)return!0}function SnowEffect(e){var s=[-1,1];rand=Math.random()*length,this.space=e;for(var t={x:Math.floor(Math.random()*camera.width)+camera.x,y:0,s:Math.floor(1*Math.random())+.5,color:"rgb(255,255,255)"},l=0;l<10;l+=2)rand=Math.random()*s.length,snows.push(new Circle(t.x,t.y,t.s,Math.cos(s[rand]),Math.floor(.4*Math.random())+1,t.color));for(var i=0;i<snows.length;i++)snows[i].y+=1.5,snows[i].y>e.height&&kill(snows,i),snows[i].x>e.width&&kill(snows,i)}function RainEffect(e){this.space=e;for(var s=[-1,3],t={x:Math.floor(Math.random()*camera.width)+camera.x,y:0,w:Math.floor(.2*Math.random())+.05,h:8,color:"rgba(250,250,250,0.07)"},l=0;l<100;l+=2)rand=Math.random()*s.length,rains.push(new Sprite(t.x,t.y,t.w,t.h,Math.cos(s[rand]),Math.floor(3*Math.random())+5,t.color));for(var i=0;i<rains.length;i++)rains[i].y+=20,rains[i].y>e.height&&kill(rains,i),rains[i].x>e.width&&kill(rains,i)}function isPath(e,s,t){index=0;var l=Math.abs(t.x-s.x),i=Math.abs(t.y-s.y);dx=(wp=e[pathIndex]).x-s.x;var a=Math.atan2(dy=wp.y-s.y,dx),h=Math.hypot(l,i);if(s.vx=Math.cos(a),s.vy=Math.sin(a),s.x+=2*s.vx,s.y+=2*s.vy,h>=-5&&h<=150)return!!(Math.abs(Math.round(s.x)-Math.round(wp.x))<Math.abs(2*s.vx)&&Math.abs(Math.round(s.y)-Math.round(wp.y))<Math.abs(2*s.vy))&&!!(pathIndex<e.length-1)}
