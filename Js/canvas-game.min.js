var SPEED,tileAnimation,saveBg,row,column,particles=[];get=function(t){return document.querySelector(t)},getAll=function(t){return document.querySelectorAll(t)};var imSet=!1,isCamera=!1,objframe=0,layerframe=0;const log=console.log;let movingSpeed=.9,self;var rotImage=!1;function Stage(){(self={stage:document.createElement("canvas")}).add=function(t,h){this.b=h,void 0==h&&document.body.appendChild(t),void 0!==h&&"before"==h&&document.body.before(t)},self.delete=function(t){document.body.removeChild(t)},self.stage.setBg=function(h){this.c=h,t=this.c||"#123",(void 0==this.c||void 0==h||""==this.c)&&(self.stage.style.background=t),self.stage.style.background=t},window.onload=self.stage.setBg(),self.setSize=function(t,h){this.a=t,this.b=h,this.a&&this.b&&(gW=self.stage.width=this.a,gH=self.stage.height=this.b)},void 0==this.a&&void 0==this.b&&(gW=self.stage.width=600,gH=self.stage.height=400),self.stage.setBgRepeat=function(t){self.stage.style.backgroundRepeat=t},ctx=self.stage.getContext("2d",{alpha:!1}),self.setCam=function(t,h,s){if(void 0==h){ctx.translate(gW/2-t.x-5,gH/2-t.y-5);return}this.debug=s;var e={x:1,y:1,width:gW-1,height:gH-1,color:"red"};x=gW/2,y=gH/2,this.debug&&"boolean"==typeof this.debug&&(ctx.strokeStyle=e.color,ctx.strokeRect(e.x,e.y,e.width,e.height)),e.x=t.x+t.w-x,e.y=t.y+t.h-y,e.x<=0&&(e.x=0),e.y<0&&(e.y=0),e.x>=h.width-e.width&&(e.x=h.width-e.width),e.y>h.height-e.height&&(e.y=h.height-e.height),t.x>=x&&(ctx.translate(-e.x,0),isCamera=!0),t.y>=y&&(ctx.translate(0,-e.y),isCamera=!0),(t.x<x||t.y<y)&&(isCamera=!1)},rectColor=function(t){ctx.fillStyle=t},strokeColor=function(t){ctx.strokeStyle=t},Rect=function(t,h=new rectColor(t)){ctx.fillStyle=this.color,ctx.fillRect(t.x,t.y,t.w,t.h)},Stroke=function(t,h,s,e,l=new strokeColor(t)){ctx.strokeStyle=this.color,ctx.strokeRect(t,h,s,e)},playSound=function(t){this.audio=new Audio(t),this.audio.volume=.3,this.audio.play()},Text=function(t,h,s,e,l,a,o){this.x=a,this.y=o,this.color=t||"gold",this.fontsize=s,this.fontstyle=h||void 0,this.fontfamily=e||void 0,this.t=l,void 0==this.fontweight&&(this.fontweight="bold"),void 0==this.fontstyle&&(this.fontstyle="italic"),void 0==this.fontfamily&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(t,h,s,e){ctx.clearRect(t,h,s,e)},setInterval(function(){objframe++,layerframe++},120);var t,h=null;self.stopAnimation=function(){return cancelAnimationFrame(h)},self.setAnimation=function(){h=requestAnimationFrame(l)};var s=0,e=0;function l(a){if(cfps=2e3/(fps=self.fps||30),60==fps&&(cfps=4e3/fps),fps>60&&(cfps=4e3/(fps=60)),s=a-e,ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",s>cfps){for(p of(e=a,ctx.save(),self.update(s),SPEED=movingSpeed,clear(0,0,gW,gH),ctx.fillStyle=t,ctx.fillRect(0,0,gW,gH),self.drawGame?self.drawGame():self.render(),particles))p.update(),p.draw();ctx.restore()}h=requestAnimationFrame(l)}return h=requestAnimationFrame(l),kill=function(t,h){t.splice(h,1)},self.isHoriBorder=function(t,h){if(void 0==t.r&&void 0!==h.x){if(t.x<=h.x||t.x>=h.width-t.w||t.x>=h.w-t.w)return!0}else if(void 0!=t.r&&void 0!=h.x&&(t.x<=h.x||t.x>=h.width-t.r||t.x>=h.w-t.r))return!0;if(void 0==t.r&&void 0==h.x){if(t.x<=0||t.x>=h.width-t.w||t.x>=h.w-t.w)return!0}else if(void 0!=t.r&&void 0==h.x&&(t.x<=0||t.x>=h.width-t.r||t.x>=h.w-t.r))return!0},self.isVertiBorder=function(t,h){if(void 0==t.r&&void 0!==h.x){if(t.y<=h.y||t.y>=h.height-t.h||t.y>=h.h-t.h)return!0}else if(void 0!=t.r&&void 0!==h.y&&(t.y<=h.y||t.y>=h.height-t.r||t.x>=h.h-t.r))return!0;if(void 0==t.r&&void 0==h.y){if(t.y<=0||t.y>=h.height-t.h||t.y>=h.h-t.h)return!0}else if(void 0!=t.r&&void 0==h.y&&(t.y<=0||t.y>=h.height-t.r||t.x>=h.h-t.r))return!0},self}var Deg2Rad=Math.PI/180;function isOverlap(t,h){var s=Math.abs(h.x-(t.x+t.w/2)),e=Math.abs(h.y-(t.y+t.h/2));if(s<=h.r+h.r+t.w/2&&e<=h.r+h.r+t.h/2)return!0}function isCollide(t,h){if(t.x+t.w>h.x&&t.x<h.x+h.w&&t.y+t.h>h.y&&t.y<h.y+h.h||t.x+t.w>h.x&&t.x<h.x+h.width&&t.y+t.h>h.y&&t.y<h.y+h.height)return!0}function isInterCirc(t,h){if(dx=t.x-h.x,dy=t.y-h.y,sumr=t.r+h.r,(distance=Math.sqrt(dx*dx+dy*dy))<=sumr)return!0}function tileMap(t,h,s,e,l,a,o,n,f){return this.image=new Image,this.image.src=o,this.lev=t,this.colTCount=h,this.rowTCount=t.length,this.total=e,this.ts=l,this.s=a,this.w=n,this.h=f,this.image.onload=this.drawLayer,this.drawLayer=function(){for(var t=0;t<this.rowTCount;t++)for(var h=0;h<this.colTCount;h++){var s=this.lev[t][h],o=s/e|0,n=s%e|0;void 0==this.w&&void 0==this.h&&ctx.drawImage(this.image,n*l,o*l,l,l,h*a,t*a,a,a),this.w&&this.h&&ctx.drawImage(this.image,n*l,o*l,l,l,h*a,t*a,this.w,this.h)}},this}Sprite=function(t,h,s,e,l,a,o,n,f){this.x=t,this.y=h,this.w=s,this.h=e,this.vx=l,this.vy=a,this.id=f,this.rotation=n,this.flipX=!1,this.flipY=!1,this.setGravity=function(t){this.gravity=t,this.shadow},this.color=o,this.setBody=()=>{this.setGravity(3),this.vy+=this.gravity,this.y+=this.vy},this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){for(var t=0;t<this.bullet.length;t++)this.bullet[t].image?ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):(ctx.fillStyle=this.bullet[t].color,ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX&&!this.rotation)for(var t=0;t<this.bullet.length;t++)this.bullet[t].image?(ctx.drawImage(this.bullet[t].image,-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h),ctx.globalAlpha=1):(this.bullet[t].w>0&&this.bullet[t].h>0&&(ctx.scale(-1,1),ctx.fillStyle=this.bullet[t].color,ctx.fillRect(-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h)),0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.scale(-1,1),ctx.arc(-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.rotation&&!this.flipX&&!rotImage){this.x=this.x-this.w/4.5,this.y=this.y-this.h/4.5,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8,-this.h/2,this.w,this.h),ctx.restore();return}if(this.rotation&&this.flipX&&!rotImage){ctx.save(),this.x=this.x-this.w/2,this.y=this.y-this.h/2,ctx.translate(this.x,this.y),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8,-this.h/2,this.w,this.h),ctx.restore();return}ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.w,this.h),this.shadow&&(this.r=10,ctx.save(),ctx.beginPath(),ctx.fillStyle="#555",ctx.arc(this.x+this.w/2,this.y+3*this.r,this.r,0,Math.PI),ctx.fill(),ctx.closePath(),ctx.restore())},this.drawSpriteImg=function(){for(var t=0;t<this.bullet.length;t++)imSet&&ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),imSet||(ctx.fillStyle=this.bullet[t].color,this.bullet[t].w>0&&this.bullet[t].h>0?ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX&&!rotImage)for(var t=0;t<this.bullet.length;t++)if(imSet)ctx.drawImage(this.bullet[t].image,-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h),ctx.globalAlpha=1;else for(var h=0;h<this.bullet.length;h++)ctx.fillStyle=this.bullet[h].color,ctx.fillRect(-this.bullet[h].x-this.bullet[h].w,this.bullet[h].y,this.bullet[h].w,this.bullet[h].h),ctx.globalAlpha=1;for(var t=0;t<this.bullet.length;t++)this.bullet[t].image?ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):(ctx.fillStyle=this.bullet[t].color,ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX&&!this.rotation)for(var t=0;t<this.bullet.length;t++)this.bullet[t].image?(ctx.drawImage(this.bullet[t].image,-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h),ctx.globalAlpha=1):(this.bullet[t].w>0&&this.bullet[t].h>0&&(ctx.scale(-1,1),ctx.fillStyle=this.bullet[t].color,ctx.fillRect(-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h)),0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.scale(-1,1),ctx.arc(-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX&&!rotImage){if(rotImage)return;ctx.scale(-1,1),ctx.drawImage(this.image,-this.x,this.y,-this.w,this.h),ctx.globalAlpha=0}if(!this.flipX&&imSet&&!rotImage){if(rotImage)return;ctx.drawImage(this.image,this.x,this.y,this.w,this.h)}if(this.flipY&&!this.rotation&&!rotImage&&imSet){if(rotImage)return;ctx.scale(1,-1),ctx.drawImage(this.image,this.x,-this.y,this.w,-this.h),ctx.globalAlpha=0}if(!this.flipY&&!this.rotation){if(rotImage)return;ctx.drawImage(this.image,this.x,this.y,this.w,this.h)}if(this.rotation&&(rotImage=!0),this.rotation&&this.flipX&&rotImage){this.x=this.x-this.w/1.5,this.y=this.y-this.h/1.5,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rotation),ctx.drawImage(this.image,-this.w/8,-this.h/2,this.w,this.h),ctx.restore();return}if(this.rotation&&!this.flipX||!this.flipY&&rotImage){this.x=this.x-this.w/2.8,this.y=this.y-this.h/2.8,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rotation),ctx.drawImage(this.image,-this.w/8,-this.h/2,this.w,this.h),ctx.restore();return}},this.addBullet=function(t,h,s,e,l,a){this.obj={x:t,y:h,w:s,h:e,color:l,r:a},this.bullet.push(this.obj)},this.addBulletIm=function(t,h,s,e,l){this.obj={x:t,y:h,w:s,h:e},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)};var u=0;this.SpriteRot=function(){u+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,u)},this.drawSpriteRot=function(t,h,s,e,l){ctx.save(),ctx.translate(t,h),ctx.rotate(l*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-s/2,-e/2,s,e),ctx.restore()};var u=0;this.SpriteImgRot=function(){u+=8,imSet&&this.drawSpriteImgRot(this.image,this.x,this.y,this.w,this.h,u)},this.drawSpriteImgRot=function(t,h,s,e,l,a){return ctx.save(),ctx.translate(h,s),ctx.rotate(a*Deg2Rad),ctx.drawImage(this.image,-e/2,-l/2,e,l),ctx.restore(),this}},Circle=function(t,h,s,e,l,a,o){this.x=t,this.y=h,this.r=s,this.vx=e,this.vy=l,this.id=o,this.setGravity=function(t){this.gravity=t},this.color=a,this.bullet=[],this.bullet.image=new Image,this.setBody=()=>{this.setGravity(3),this.vy+=this.gravity,this.y+=this.vy},this.drawCirc=function(){for(b of(ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.fill(),ctx.closePath(),this.bullet))ctx.fillStyle=b.color,b.w>0&&b.h>0&&(ctx.fillStyle=ctx.fillRect(b.x,b.y,b.w,b.h)),0==b.w&&0==b.h&&(ctx.beginPath(),ctx.arc(b.x,b.y,b.r,0,2*Math.PI),ctx.fill(),ctx.closePath())},this.addBullet=function(t,h,s,e,l,a){this.obj={x:t,y:h,w:s,h:e,color:l,r:a},this.bullet.push(this.obj)},this.addBulletIm=function(t,h,s,e,l){this.obj={x:t,y:h,w:s,h:e},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)}},SpriteSheet=function(t,h,s,e,l,a,o,n,f,u,g){this.row=h,this.col=t,this.sw=s,this.sh=e,this.x=l,this.y=a,this.w=o,this.h=n,this.vx=f,this.vy=u,this.id=g,this.flipX=!1,this.flipY=!1,this.setGravity=function(t){this.gravity=t},this.setBody=()=>{this.setGravity(3),this.vy+=this.gravity,this.y+=this.vy},imSet=!0,this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){this.flipX||this.rotation||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h);for(var t=0;t<this.bullet.length;t++)this.bullet[t].image?ctx.drawImage(this.bullet[t].image,this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h):(ctx.fillStyle=this.bullet[t].color,ctx.fillRect(this.bullet[t].x,this.bullet[t].y,this.bullet[t].w,this.bullet[t].h),0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.arc(this.bullet[t].x,this.bullet[t].y,this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX&&!this.rotation)for(var t=0;t<this.bullet.length;t++)this.bullet[t].image?(ctx.drawImage(this.bullet[t].image,-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h),ctx.globalAlpha=1):(this.bullet[t].w>0&&this.bullet[t].h>0&&(ctx.scale(-1,1),ctx.fillStyle=this.bullet[t].color,ctx.fillRect(-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].w,this.bullet[t].h)),0==this.bullet[t].w&&0==this.bullet[t].h&&(ctx.beginPath(),ctx.scale(-1,1),ctx.arc(-this.bullet[t].x,this.bullet[t].y,-this.bullet[t].r,0,2*Math.PI),ctx.fill(),ctx.closePath()));this.flipY&&(ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,-this.y-this.h,this.w,this.h),ctx.globalAlpha=0),this.flipY||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h)},this.addBullet=function(t,h,s,e,l,a){this.obj={x:t,y:h,w:s,h:e,color:l,r:a},this.bullet.push(this.obj)},this.addBulletIm=function(t,h,s,e,l){this.obj={x:t,y:h,w:s,h:e},this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)};var d=0;this.SpriteSheetRot=function(){d+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,d)},this.drawSpriteSheetRot=function(t,h,s,e,l,a,o,n,f,u){ctx.save(),ctx.translate(a,o),ctx.rotate(u*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-n/2,-f/2,n,f),ctx.restore()}};var goLeft=!1,goRight=!1;function isFollow(t,h){gap=t.x-h.x;var s=Math.abs(t.y-h.y);return gap<=-3&&gap>=-150&&s<=20?(goLeft=!0,goRight=!1,!0):gap>=0&&gap<=150&&s<=20?(goLeft=!1,goRight=!0,!0):void 0}function createGrid(t,h,s,e){this.gap=t,this.gW=h,this.gH=s,this.color=e,this.drawGrid=function(){for(var t=this.gap;t<this.gW;t+=this.gap)this.gW>=this.gH?(ctx.moveTo(t,0),ctx.lineTo(t,this.gW)):(ctx.moveTo(t,0),ctx.lineTo(t,this.gH));for(var h=this.gap;h<this.gH;h+=this.gap)ctx.moveTo(0,h),ctx.lineTo(this.gW,h);ctx.strokeStyle=this.color,ctx.lineWidth=1,ctx.stroke()}}function addNumber(t,h,s,e,l,a){return this.col=t,this.row=h,this.tSize=s,this.color=e,this.spaceX=l,this.spaceY=a,this.show=()=>{for(var t=0;t<=this.row;t++)for(var h=0;h<=this.col;h++){var s=h+t*this.col;ctx.font="9px arial bold",ctx.fillStyle=this.color,ctx.fillText(s,h*this.tSize+this.spaceX,t*this.tSize+this.spaceY)}},this}let loader=!1,that,data;function tiledMap(t,h,s){that=this,that.path=t,that.image=h=new Image,that.size=s,that.load=function(){(xhr=new XMLHttpRequest).onload=function(){4==this.readyState&&(data=JSON.parse(xhr.response),loader=!0,that.loadTileset(data))},xhr.open("get",that.path),xhr.send(!0)},that.loadTileset=function(t){for(tile of data.tilesets)that.image.src=tile.image.replace("../../","")},that.renderLayers=function(t){(t=Array.isArray(t=data.layers)?t:data.layers).forEach(that.renderLayer())},animL=[];var e=!1;return that.renderLayer=function(t){for(r=0;r<t.height;r++)for(col=0;col<t.width;col++){let h=col+r*t.width,l=t.data[h];tX=~~(--l%(tile.imagewidth/s))*s,tY=Math.floor(l/(tile.imagewidth/s))*s,dX=~~(h%t.width)*s,dY=Math.floor(h/t.width)*s,ctx.drawImage(that.image,tX,tY,s,s,dX,dY,s,s),tile.tiles&&tile.tiles.forEach((a,o)=>{if(animL.push(a),0!=l&&void 0!=animL[l]||null!=animL[l]){e=!0;var n=animL[l].animation;tIndex=layerframe%(numFrames=n.length),e&&l==a.id&&(tX=(l=n[tIndex].tileid+1)%(tile.imagewidth/s)*s,tY=Math.floor(l/(tile.imagewidth/s))*s,dX=h%t.width*s,dY=Math.floor(h/t.width)*s,ctx.drawImage(that.image,tX,tY,s,s,dX,dY,s,s))}})}var a=!1;self.objectAnimation=tileAnimation=function(h,s){for(t of(that.val=h,this.nom=s,data.layers))if("objectgroup"==t.type&&this.nom==t.name&&tile.tiles)for(let e of tile.tiles){frameIndex=objframe%(anim=e.animation).length,l=anim[frameIndex].tileid,tileColumns=tile.imagewidth/tile.tilewidth,tileRows=tile.imageheight/tile.tileheight;var l,o=tile.tileheight,n=tile.tilewidth;for(var f of t.objects)f.hasOwnProperty("gid")&&f.gid==that.val&&this.nom==t.name?a=!0:(a=!1,log(" Animation Layer's name is not defined or gidValue is incorrect in tileAnimation \n\n please read the documentation so that you may use tileAnimation correctly !!")),column=Math.floor(l%tile.columns),objrow=Math.floor(l/tile.columns),a&&ctx.drawImage(that.image,o*column,n*objrow,o,n,f.x,f.y-n,f.width,f.height)}}},that.RenderObjectLayer=function(t){for(var h of(this.gid=t,data.layers))if("objectgroup"==h.type){for(var s of(tile.rows=tile.imageheight/tile.tileheight,h.objects))if(s.hasOwnProperty("gid")){var e=tile.imagewidth/tile.columns,l=tile.imageheight/tile.rows;this.gid=t,gid=t,(null==t||void 0==t)&&(gid=s.gid),column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),s.hasOwnProperty("gid")&&s.gid!=that.val&&!h.hasOwnProperty("properties")&&ctx.drawImage(that.image,e*column,l*obj2row,e,l,s.x,s.y-l,s.width,s.height)}}},that}function tiledCollider(t,h,s){if(t.x+t.w>h.x&&t.y+t.h>h.y&&t.x<h.x+h.width&&t.y<h.y+h.height||t.x+t.w>h.x&&t.x<h.x+h.w&&t.y+t.h>h.y&&t.y<h.y+h.h)return!0;if(s&&isJumping){let e=Math.abs(t.y-h.y);if(t.x+t.w>h.x&&t.y+t.h>=h.y+h.height&&t.x<h.x+h.width&&t.y-t.h<=h.y+h.height&&e<=t.y-t.h)return!0}}var canJump=!1,Lside=!1,Rside=!1,Uside=!1,Dside=!1;function RpgFollow(t,h,s){this.gap=s;var e=Math.atan2(t.y-h.y,t.x-h.x),l=t.x-h.x,a=t.y-h.y;if(Math.sqrt(l*l+a*a)<=this.gap){switch(h.vx=Math.cos(e),h.vy=Math.sin(e),h.x+=2*h.vx,h.y+=2*h.vy,Math.sign(h.vx)){case -1:Lside=!0,Rside=!1,Uside=!1,Dside=!1;break;case 1:Rside=!0,Lside=!1,Uside=!1,Dside=!1}switch(Math.sign(h.vy)){case -1:Uside=!0,Rside=!1,Dside=!1,Lside=!1;break;case 1:Dside=!0,Rside=!1,Uside=!1,Lside=!1}}}function gameRadar(t,h){this.x=t,this.y=h;var s=new Image;s.src=this.x.toDataURL(),this.y.style.background=`url(${s.src})`,this.y.style.backgroundRepeat="no-repat",this.y.style.backgroundSize="cover"}var gameFrame=0,gameSpeed=5;class layerB{constructor(t,h,s,e,l,a){this.x=h,this.y=s,this.image=t,this.w=e,this.h=l,this.speedModifier=a,this.speed=gameSpeed*this.speedModifier}update(){this.speed=gameSpeed*this.speedModifier,this.x=gameFrame*this.speed%this.w}draw(){ctx.save(),ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x+this.w,this.y,this.w,this.h),ctx.restore()}}console.dir("CanvasgGameJs is running !!");var isJumping=!1;function LeftCollider(t,h,s,e){for(var l=0;l<t.length;l++)for(var a,o=0;o<t[0].length;o++)if(t[l][o]==e){a={x:tx=o*s,y:ty=l*s,w:s,h:s};let n;var f=Math.abs(h.y-a.y);a.w==h.w&&(n=f<=3.5),(a.w/h.w!=1||24==h.w)&&(n=f<=13),a.w/h.w!=1&&16==h.w&&(n=f>=18),h.x+h.w>a.x&&h.y+h.h>a.y&&h.x<a.x+a.w&&h.y<a.y+a.h&&n&&(h.x=a.x+a.w)}}function RightCollider(t,h,s,e){for(var l=0;l<t.length;l++)for(var a,o=0;o<t[0].length;o++)if(tx=o*s,ty=l*s,t[l][o]==e){a={x:tx,y:ty,w:s,h:s};let n;var f=Math.abs(h.y-a.y);a.w==h.w&&(n=f<=3.5),(a.w/h.w!=1||24==h.w)&&(n=f<=13),a.w/h.w!=1&&16==h.w&&(n=f>=18),h.x+h.w>a.x&&h.y+h.h>a.y&&h.x<a.x+a.w&&h.y<a.y+a.h&&n&&(h.x=a.x-h.w)}}function TopCollider(t,h,s,e){for(var l=0;l<t.length;l++)for(var a=0;a<t[0].length;a++)if(t[l][a]==e){var o={x:tx=a*s,y:ty=l*s,w:s,h:s};h.x+h.w>o.x&&h.y+h.h>o.y&&h.x<o.x+o.w&&h.y<o.y+o.h&&(h.y=o.y-h.h,h.vy=0,h.shadow=!1,JumpTime=0)}}function BottomCollider(t,h,s,e,l){if(isJumping&&!l){for(var a=0;a<t.length;a++)for(var o,n=0;n<t[0].length;n++)if(t[a][n]==e){o={x:tx=n*s,y:ty=a*s,w:s,h:s};let f=Math.abs(h.y-o.y);h.x+h.w>o.x&&h.y+h.h>=o.y+o.h/2&&h.x<o.x+o.w&&h.y-h.h+h.vy<=o.y+o.h&&f<=h.y-h.h&&(h.y=o.y+o.h,h.vy=0)}}if(l){for(var u in data.layers)if("collision"==data.layers[u].name)for(let g of data.layers[u].objects){let d=Math.abs(h.y-g.y);h.x+h.w>g.x&&h.y+h.h>=g.y+g.h/2&&h.x<g.x+g.w&&h.y-h.h+h.vy<=g.y+g.h&&d<=g.y-g.h&&(h.y=g.y+g.h,h.vy=0)}}}function isFlipCollide(t,h){var s=Math.abs(t.x-h.x),e=Math.abs(t.y-h.y);if(h.r){if(t.flipX&&t.x+t.w>h.x&&t.x-1.5*t.w<=h.x+1.5*h.r&&t.y+t.h>h.y&&t.y<h.y+1.8*h.r||s<h.r+t.w&&e<h.r+t.h){if(t.flipX&&t.x<h.x+h.r/1.8)return;return!0}if(!t.flpiX&&t.x+t.w/1.5>h.x&&t.x<h.x+h.r&&t.y+t.h>h.y&&t.y<h.y+h.r/1.8||s<h.r+t.w&&e<h.r+t.h)return!0}if(void 0==h.r){var s=Math.abs(t.x-h.x),e=Math.abs(t.y-h.y);if(!t.flipX&&t.x+t.w>=h.x&&t.x<=h.x+h.w&&t.y+t.h>=h.y&&t.y<=h.y+1.8*h.h)return!0;if(t.flipX&&t.x+t.w>=h.x&&t.x-1.8*t.w<=h.x+h.w&&t.y+t.h>=h.y&&t.y<=h.y+1.8*h.h){if(t.flipX&&t.x<h.x+h.w)return;return!0}}}function Particles(t,h,s,e){this.x=t,this.y=h,this.size=s,this.alpha=1,this.vx=-7*Math.random()+4,this.vy=-7*Math.random()+4,this.color="#"+Math.floor(65280*Math.random()).toString(16),this.update=function(){this.x+=this.vx,this.y+=this.vy},this.draw=function(){for(let t=0;t<particles.length;t++){var h=(part=particles[t]).x-e.x,s=part.y-e.y;Math.sqrt(h*h+s*s)>60&&(this.alpha-=.03),this.alpha<=0&&kill(particles,t)}ctx.save(),ctx.globalAlpha=this.alpha,ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.size,this.size),ctx.restore()}}function createParticle(t){for(i=0,this.target=t;i<60;i++)particles.push(new Particles(t.x+t.w/2||t.x,t.y,6*Math.random()+1.5,t))}Array.prototype.parse2D=function(t){var h=[];for(let s=0;s<this.length;s+=t)h.push(this.slice(s,s+t));return h};
