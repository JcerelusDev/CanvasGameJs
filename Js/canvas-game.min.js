var camera,reqA,SPEED,tileAnimation,saveBg,self,row,column,data,particles=[],snows=[],rains=[],pathIndex=0;get=function(s){return document.querySelector(s)},getAll=function(s){return document.querySelectorAll(s)};var imSet=!1,JumpTime=0,movingSpeed=.5,isCamera=!1,objframe=0,layerframe=0;const log=console.log;var rotImage=!1,isOnAir=!1;function Stage(){void 0==(self={stage:document.createElement("canvas")}).scale&&(self.scale=1),self.add=function(s,t){this.b=t,void 0==t&&document.body.appendChild(s),void 0!==t&&"before"==t&&document.body.before(s)},self.delete=function(s){document.body.removeChild(s)},self.stage.setBg=function(t){this.c=t,s=this.c||"#123",(void 0==this.c||void 0==t||""==this.c)&&(self.stage.style.background=s),self.stage.style.background=s},window.onload=self.stage.setBg(),self.setSize=function(s,t){this.a=s,this.b=t,this.a&&this.b&&(gW=self.stage.width=this.a,gH=self.stage.height=this.b)},void 0==this.a&&void 0==this.b&&(gW=self.stage.width=600,gH=self.stage.height=400),camera={x:1,y:1,width:self.stage.width,height:self.stage.height},self.stage.setBgRepeat=function(s){self.stage.style.backgroundRepeat=s},ctx=self.stage.getContext("2d",{alpha:!1}),rectColor=function(s){ctx.fillStyle=s},strokeColor=function(s){ctx.strokeStyle=s},Rect=function(s,t=s.color){ctx.fillStyle=t,ctx.fillRect(s.x,s.y,s.w,s.h)},Stroke=function(s,t=s.color){ctx.strokeStyle=t,ctx.strokeRect(s.x,s.y,s.w,s.h)},playSound=function(s){return this.audio=new Audio(s),this.audio.currentTime=.1,this.audio.volume=.2,this.audio.play(),this},stopSound=function(s){s.audio.pause(),s.currentTime=0},Text=function(s,t,e,i,l,h,a){this.x=h,this.y=a,this.color=s||"gold",this.fontsize=e,this.fontstyle=t,this.fontfamily=i,this.t=l,void 0==this.fontweight&&(this.fontweight="bold"),void 0==this.fontstyle&&(this.fontstyle="italic"),(void 0==this.fontfamily||null==this.fontfamily)&&(this.fontfamily="monospace"),ctx.fillStyle=this.color,ctx.font=this.fontstyle+" "+this.fontsize+" "+this.fontfamily,ctx.fillText(this.t,this.x,this.y)},clear=function(s,t,e,i){ctx.clearRect(s,t,e,i)},setInterval(function(){},120);var s,t,e,i,l,h,a=!1;function o(){reqA=requestAnimationFrame(o),(e=((h=Date.now())-l)/1e3)>t/700&&(l=h-e%t,objframe++,layerframe++,self.update(e)),SPEED=movingSpeed,ctx.imageSmoothingEnabled=!1,ctx.imageSmoothingQuality="high",ctx.save(),ctx.fillStyle=s,ctx.fillRect(0,0,gW,gH),self.drawGame?self.drawGame():self.render(),a&&(ctx.strokeStyle=camera.color,ctx.lineWidth=2*self.scale,ctx.strokeRect(camera.x*self.scale,camera.y*self.scale,camera.width*self.scale,camera.height*self.scale));for(var i=0;i<particles.length;i++)(particle=particles[i]).update(),particle.draw();for(var i=0;i<snows.length;i++)canDraw(snows[i],camera)?(ctx.beginPath(),ctx.fillStyle=snows[i].color,ctx.arc(snows[i].x,snows[i].y+=snows[i].vy,snows[i].r,1.8,1.7*Math.PI),ctx.fill(),ctx.closePath()):kill(snows,i);for(var f=0;f<rains.length;f++)ctx.save(),canDraw(rains[f],camera)?rains[f].drawSprite():kill(rains,f),ctx.restore();ctx.restore()}return self.setCam=function(s,t,e){if(1==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2),y=Math.floor(gH/2)),1.1==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.1),y=Math.floor(gH/2)),1.2==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.2),y=Math.floor(gH/2)),1.3==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.4),y=Math.floor(gH/2)),1.4==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=Math.floor(gW/2.5),y=Math.floor(gH/2)),1.5==self.scale&&(camera={x:0,y:0,width:gW/self.scale,height:gH/self.scale,color:"red"},x=gW/3,y=gH/2),void 0==t){ctx.translate(gW/2-(s.x-5),gH/2-(s.y-5));return}this.debug=e,this.debug&&"boolean"==typeof this.debug&&(a=!0),camera.x=s.x+s.w-x,camera.y=s.y+s.h-y,camera.x<=0&&(camera.x=0),camera.y<=0&&(camera.y=0),camera.x>=t.width-camera.width&&(camera.x=t.width-camera.width),camera.y>t.height-camera.height&&(camera.y=t.height-camera.height),s.x+camera.width>=x&&(ctx.translate(-camera.x*self.scale,0),isCamera=!0),s.y+camera.height>=y&&(ctx.translate(0,-camera.y*self.scale),isCamera=!0),s.x<x&&(isCamera=!1),s.y<y&&(isCamera=!1)},self.setAnimation=function(s){t=1e3/s,i=l=Date.now(),reqA=requestAnimationFrame(o)},self.stopAnimation=function(){cancelAnimationFrame(reqA)},kill=function(s,t){s.splice(t,1)},self.isHoriBorder=function(s,t,e){if(void 0==s.r&&void 0==t.x){if(s.x<=0||s.x>=t.width-s.w||s.x>=t.w-s.w)return!0}else if(void 0==e&&void 0==s.r&&void 0!=t.x){if(s.x<=0||s.x>=t.width-s.w||s.x>=t.w-s.w)return!0}else if(void 0==s.r&&void 0!==t.x&&e&&s.w>100){if(s.x<=e||s.x>=t.width-s.w/2.5+e||s.x>=t.w-s.w/2.5+e)return!0}else if(void 0!=e&&void 0==s.r&&void 0==t.x&&s.w>100){if(s.x<-e||s.x>=t.width-s.w/2.5+e)return!0;if(void 0==s.r&&void 0!==t.x){if(s.x<=t.x||s.x>=t.width-s.w||s.x>=t.w-s.w)return!0}else if(void 0!=s.r&&void 0!=t.x&&(s.x<=t.x||s.x>=t.width-s.r||s.x>=t.w-s.r))return!0}else if(void 0!=s.r&&void 0==t.x&&(s.x<=0||s.x>=t.width-s.r||s.x>=t.w-s.r))return!0},self.isVertiBorder=function(s,t){if(void 0==s.r&&void 0!==t.x){if(s.y<=t.y||s.y>=t.height-s.h||s.y>=t.h-s.h)return!0}else if(void 0!=s.r&&void 0!==t.y&&(s.y<=t.y||s.y>=t.height-s.r||s.x>=t.h-s.r))return!0;if(void 0==s.r&&void 0==t.y){if(s.y<=0||s.y>=t.height-s.h||s.y>=t.h-s.h)return!0}else if(void 0!=s.r&&void 0==t.y&&(s.y<=0||s.y>=t.height-s.r||s.x>=t.h-s.r))return!0},self}var Deg2Rad=Math.PI/180;function isOverlap(s,t){var e=Math.abs(t.x-(s.x+s.w/2)),i=Math.abs(t.y-(s.y+s.h/2));if(e<=t.r+t.r+s.w/2&&i<=t.r+t.r+s.h/2)return!0}function isCollide(s,t){if(t.w>100&&t.h>100){if(s.x+s.w>t.x+t.w/2&&s.x<t.x+t.w&&s.y+s.h>t.y&&s.y<t.y+t.h||s.x+s.w>t.x&&s.x<t.x+t.width&&s.y+s.h>t.y&&s.y<t.y+t.height||s.x+s.w>t.x&&s.x<t.x+t.w&&s.y+s.h+s.vy>t.y&&s.y<t.y+t.h)return!0}else if(s.x+s.w>=t.x&&s.x<t.x+t.w&&s.y+s.h>t.y&&s.y<t.y+t.h||s.x+s.w>t.x&&s.x<t.x+t.width&&s.y+s.h>t.y&&s.y<t.y+t.height||s.x+s.w>t.x&&s.x<t.x+t.w&&s.y+s.h+s.vy>t.y&&s.y<t.y+t.h)return!0}function isInterCirc(s,t){if(dx=s.x-t.x,dy=s.y-t.y,sumr=s.r+t.r,(distance=Math.sqrt(dx*dx+dy*dy))<=sumr)return!0}Sprite=function(s,t,e,i,l,h,a,o,f){this.x=s,this.y=t,this.w=e,this.h=i,this.vx=l,this.vy=h,this.id=f,this.rotation=o,this.flipX=!1,this.flipY=!1,this.setGravity=function(s){this.gravity=s,this.shadow},this.color=a,this.bodyCollider={x:this.x,y:this.y,w:this.w/1.3,h:this.h/1.3,body:"body"},this.w>=200&&(this.bodyCollider={x:this.x,y:this.y,w:this.w/4,h:this.h/3,body:"body"}),this.setBody=()=>{this.setGravity(3),this.y+=this.vy,this.vy+=this.gravity},this.Rotation=function(){ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.angle),ctx.translate(-this.x*self.scale,-this.y*self.scale)},this.color||(this.image=new Image),this.bullet=[],this.bullet.image=new Image,this.drawSprite=function(){for(var s=0;s<this.bullet.length;s++)this.bullet[s].image?ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale):(ctx.fillStyle=this.bullet[s].color,ctx.fillRect(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),0==this.bullet[s].w&&0==this.bullet[s].h&&(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX&&!this.rotation)for(var s=0;s<this.bullet.length;s++){if(this.bullet[s].image){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}if(this.bullet[s].w>0&&this.bullet[s].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[s].color,ctx.fillRect(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}if(0==this.bullet[s].w&&0==this.bullet[s].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.rotation&&!this.flipX&&!rotImage){ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.translate(-this.x*self.scale,-this.y*self.scale),ctx.restore();return}if(this.rotation&&this.flipX&&!rotImage){ctx.save(),this.x=(this.x-this.w/1.1)*self.scale,this.y=(this.y-this.h/2.8)*self.scale,ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,1),ctx.rotate(this.rotation),ctx.fillStyle=this.color,ctx.fillRect(-this.w/8*self.scale,-this.h/2*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}if(this.angle){ctx.save(),this.Rotation(),ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),ctx.restore();return}ctx.fillStyle=this.color,ctx.fillRect(this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),32==this.w?(this.bodyCollider.x=this.x+4,this.bodyCollider.y=this.y+4):64==this.w?(this.bodyCollider.x=this.x+8,this.bodyCollider.y=this.y+8):96==this.w?(this.bodyCollider.x=this.x+12,this.bodyCollider.y=this.y+12):128==this.w?(this.bodyCollider.x=this.x+16,this.bodyCollider.y=this.y+16):this.w>=200&&(this.bodyCollider.x=this.x+70,this.bodyCollider.y=this.y+132),this.debug&&(ctx.beginPath(),ctx.strokeStyle="black",ctx.strokeRect(this.bodyCollider.x,this.bodyCollider.y,this.bodyCollider.w,this.bodyCollider.h),ctx.stroke(),ctx.closePath()),this.shadow&&(this.r=10,ctx.save(),ctx.beginPath(),ctx.fillStyle="#555",ctx.arc(this.x+this.w/2,this.y+3*this.r,this.r,0,Math.PI),ctx.fill(),ctx.closePath(),ctx.restore())},this.drawSpriteImg=function(){32==this.w?(this.bodyCollider.x=this.x+4,this.bodyCollider.y=this.y+4):64==this.w?(this.bodyCollider.x=this.x+8,this.bodyCollider.y=this.y+8):96==this.w?(this.bodyCollider.x=this.x+12,this.bodyCollider.y=this.y+12):128==this.w?(this.bodyCollider.x=this.x+16,this.bodyCollider.y=this.y+16):this.w>=200&&(this.bodyCollider.x=this.x+70,this.bodyCollider.y=this.y),this.debug&&(ctx.beginPath(),ctx.strokeStyle="red",ctx.strokeRect(this.bodyCollider.x,this.bodyCollider.y,this.bodyCollider.w,this.bodyCollider.h),ctx.stroke(),ctx.closePath());for(var s=0;s<this.bullet.length;s++)imSet&&ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),imSet||(ctx.fillStyle=this.bullet[s].color,this.bullet[s].w>0&&this.bullet[s].h>0?ctx.fillRect(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale):0==this.bullet[s].w&&0==this.bullet[s].h&&(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath()));if(this.flipX&&!rotImage)for(var s=0;s<this.bullet.length;s++){if(imSet){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}for(var t=0;t<this.bullet.length;t++){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[t].color,ctx.fillRect((-this.bullet[t].x-this.bullet[t].w)*self.scale,this.bullet[t].y*self.scale,this.bullet[t].w*self.scale,this.bullet[t].h*self.scale),ctx.globalAlpha=1,ctx.restore();return}}for(var s=0;s<this.bullet.length;s++)if(this.bullet[s].image||(ctx.fillStyle=this.bullet[s].color,ctx.fillRect(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),0==this.bullet[s].w&&0==this.bullet[s].h&&(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),this.bullet[s].image&&this.bullet[s].flipX)ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();else if(this.bullet[s].image&&this.bullet[s].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,-this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,-this.bullet[s].h*self.scale),ctx.restore();return}else ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale);if(this.flipX&&!this.rotation)for(var s=0;s<this.bullet.length;s++)if(this.bullet[s].image)ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.globalAlpha=1;else{if(this.bullet[s].w>0&&this.bullet[s].h>0){ctx.save(),ctx.scale(-1,1),ctx.fillStyle=this.bullet[s].color,ctx.fillRect(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();return}if(0==this.bullet[s].w&&0==this.bullet[s].h){ctx.beginPath(),ctx.save(),ctx.scale(-1,1),ctx.arc(-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore();return}}if(this.flipX&&!rotImage){if(rotImage)return;ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.image,-this.x*self.scale,this.y*self.scale,-this.w*self.scale,this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipX&&imSet&&!rotImage){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.flipY&&!this.rotation&&!rotImage&&imSet){if(rotImage)return;ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.globalAlpha=0,ctx.restore();return}if(!this.flipY&&!this.rotation){if(rotImage)return;ctx.drawImage(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)}if(this.rotation&&(rotImage=!0),this.rotation&&(rotImage=!0),this.rotation&&this.flipX&&rotImage){this.x=(this.x-this.w/1.5)*self.scale,this.y=(this.y-this.h/2.8)*self.scale,ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.scale(-1,-1),ctx.rotate(Math.cos(this.rotation)),ctx.drawImage(this.image,-this.w/8,-this.h/8,this.w,this.h),ctx.restore();return}if(this.rotation&&!this.flipX||!this.flipY&&rotImage){this.x=(this.x-this.w/1.8)*self.scale,this.y=(this.y-this.h/2.8)*self.scale,ctx.save(),ctx.translate(this.x*self.scale,this.y*self.scale),ctx.rotate(Math.cos(this.rotation)),ctx.drawImage(this.image,this.w/8*self.scale,-this.h/8*self.scale,this.w*self.scale,this.h*self.scale),ctx.translate(-this.x*self.scale,-this.y*self.scale),ctx.restore();return}},this.addBullet=function(s,t,e,i,l,h){this.obj={x:s,y:t,w:e,h:i,color:l,r:h},this.bullet.push(this.obj)},this.addBulletIm=function(s,t,e,i,l){this.obj={x:s,y:t,w:e,h:i,flipX:!1,flipY:!1},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)};var c=0;this.SpriteRot=function(){c+=8,this.drawSpriteRot(this.x,this.y,this.w,this.h,c)},this.drawSpriteRot=function(s,t,e,i,l){ctx.save(),ctx.translate(s,t),ctx.rotate(l*Deg2Rad),ctx.fillStyle=this.color,ctx.fillRect(-e/2*self.scale,-i/2*self.scale,e*self.scale,i*self.scale),ctx.restore()},32==e?this.bodyCollider={x:this.x+this.sw/2,y:this.y-this.sh/20,r:this.w/2.2,body:"body"}:64==e?this.bodyCollider={x:this.x+this.sw,y:this.y-this.sh/20,r:this.w/2,body:"body"}:96==e?this.bodyCollider={x:this.x+this.sw-20,y:this.y-this.sh/20,r:this.w/2.2,body:"body"}:128==e&&(this.bodyCollider={x:this.x+this.sw-20,y:this.y-this.sh/20,r:this.w/2,body:"body"}),200==this.w&&(this.bodyCollider={x:this.x+100,y:this.y+98,r:this.w/14,body:"body"});var c=0;this.SpriteImgRot=function(){c+=8,imSet&&this.drawSpriteImgRot(this.image,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale,c)},this.drawSpriteImgRot=function(s,t,e,i,l,h){return ctx.save(),ctx.translate(t,e),ctx.rotate(h*Deg2Rad),ctx.drawImage(this.image,-i/2*self.scale,-l/2*self.scale,i*self.scale,l*self.scale),ctx.restore(),this}},Circle=function(s,t,e,i,l,h,a){this.x=s,this.y=t,this.r=e,this.vx=i,this.vy=l,this.id=a,this.setGravity=function(s){this.gravity=s},this.color=h,this.bullet=[],this.bullet.image=new Image,this.setBody=()=>{this.setGravity(3),this.y+=this.vy,this.vy+=this.gravity},this.drawCirc=function(){for(b of(ctx.beginPath(),ctx.fillStyle=this.color,ctx.arc(this.x*self.scale,this.y*self.scale,this.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath(),this.bullet))ctx.fillStyle=b.color,b.w>0&&b.h>0&&(ctx.fillStyle=ctx.fillRect(b.x*self.scale,b.y*self.scale,b.w*self.scale,b.h*self.scale)),0==b.w&&0==b.h&&(ctx.beginPath(),ctx.arc(b.x*self.scale,b.y*self.scale,b.r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())},this.addBullet=function(s,t,e,i,l,h){this.obj={x:s,y:t,w:e,h:i,color:l,r:h},this.bullet.push(this.obj)},this.addBulletIm=function(s,t,e,i,l){this.obj={x:s,y:t,w:e,h:i,flipX:!1,flipY:!1},imSet=!0,this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)}},SpriteSheet=function(s,t,e,i,l,h,a,o,f,c,n){this.row=t,this.col=s,this.sw=e,this.sh=i,a>=150&&o>=150&&(a=200,o=200),this.x=l,this.y=h,this.w=a,this.h=o,this.vx=f,this.vy=c,this.id=n,this.flipX=!1,this.flipY=!1,this.debug=!1,this.setGravity=function(s){this.gravity=s},this.bodyCollider={x:this.x,y:this.y,w:this.w/2.2,h:this.h/1.3,body:"body"},this.w>=200&&(this.bodyCollider={x:this.x,y:this.y,w:this.w/8,h:this.h/3.5,body:"body"}),this.setBody=()=>{this.setGravity(3),this.y+=this.vy,this.vy+=this.gravity},imSet=!0,this.image=new Image,this.bullet=[],this.bullet.image=new Image,this.drawSpriteSheet=function(){24==this.w?(this.bodyCollider.x=this.x+2.8,this.bodyCollider.y=this.y+2):32==this.w?(this.bodyCollider.x=this.x+4,this.bodyCollider.y=this.y+4):64==this.w?(this.bodyCollider.x=this.x+8,this.bodyCollider.y=this.y+8):96==this.w?(this.bodyCollider.x=this.x+12,this.bodyCollider.y=this.y+12):128==this.w?(this.bodyCollider.x=this.x+16,this.bodyCollider.y=this.y+16):this.w>=200&&(this.bodyCollider.x=this.x+90,this.bodyCollider.y=this.y+70),this.debug&&(ctx.beginPath(),ctx.strokeStyle="black",ctx.strokeRect(this.bodyCollider.x*self.scale,this.bodyCollider.y*self.scale,this.bodyCollider.w*self.scale,this.bodyCollider.h*self.scale),ctx.stroke(),ctx.closePath()),this.flipX||this.rotation||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale);for(var s=0;s<this.bullet.length;s++)if(this.bullet[s].image||(ctx.fillStyle=this.bullet[s].color,ctx.fillRect(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),0==this.bullet[s].w&&0==this.bullet[s].h&&(ctx.beginPath(),ctx.arc(this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].r*self.scale,0,2*Math.PI),ctx.fill(),ctx.closePath())),this.bullet[s].image&&this.bullet[s].flipX)ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.bullet[s].image,-this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,-this.bullet[s].w*self.scale,this.bullet[s].h*self.scale),ctx.restore();else if(this.bullet[s].image&&this.bullet[s].flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,-this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,-this.bullet[s].h*self.scale),ctx.restore();return}else ctx.drawImage(this.bullet[s].image,this.bullet[s].x*self.scale,this.bullet[s].y*self.scale,this.bullet[s].w*self.scale,this.bullet[s].h*self.scale);if(this.flipY){ctx.save(),ctx.scale(1,-1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,-this.y*self.scale,this.w*self.scale,-this.h*self.scale),ctx.restore();return}if(this.flipX){ctx.save(),ctx.scale(-1,1),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-this.x*self.scale,this.y*self.scale,-this.w*self.scale,this.h*self.scale),ctx.restore();return}this.flipY||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale),this.flipX||ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x*self.scale,this.y*self.scale,this.w*self.scale,this.h*self.scale)},this.addBullet=function(s,t,e,i,l,h){this.obj={x:s,y:t,w:e,h:i,color:l,r:h},this.bullet.push(this.obj)},this.addBulletIm=function(s,t,e,i,l){this.obj={x:s,y:t,w:e,h:i,flipX:!1,flipY:!1},this.obj.image=new Image,this.obj.image.src=l,this.bullet.push(this.obj)};var d=0;this.SpriteSheetRot=function(){d+=8,this.drawSpriteSheetRot(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,this.x,this.y,this.w,this.h,d)},this.drawSpriteSheetRot=function(s,t,e,i,l,h,a,o,f,c){ctx.save(),ctx.translate(h*self.scale,a*self.scale),ctx.rotate(c*Deg2Rad),ctx.drawImage(this.image,this.col*this.sw,this.row*this.sh,this.sw,this.sh,-(o/2)*self.scale,-(f/2)*self.scale,o*self.scale,f*self.scale),ctx.restore()}};var isDrawable=!0;function tileMap(s,t,e,i,l,h,a,o,f){return this.image=new Image,this.image.src=a,this.lev=s,this.colTCount=t,this.rowTCount=s.length,this.total=i,this.ts=l,this.s=h,this.w=o,this.h=f,this.image.onload=this.drawLayer,this.drawLayer=function(){for(var s=0;s<this.rowTCount;s++)for(var t=0;t<this.colTCount;t++){var e=this.lev[s][t],a=e/i|0,o=e%i|0;(isDrawable=!(o+l/2<camera.x-l/2)&&!(o+l>camera.x+camera.width+l/2))&&void 0==this.w&&void 0==this.h&&ctx.drawImage(this.image,o*l,a*l,l,l,t*h*self.scale,s*h*self.scale,h*self.scale,h*self.scale),this.w&&this.h&&ctx.drawImage(this.image,o*l,a*l,l,l,t*h*self.scale,s*h*self.scale,this.w*self.scale,this.h*self.scale)}},this}var goLeft=!1,goRight=!1;function isFollow(s,t){gap=s.x-t.x;var e=Math.abs(s.y-t.y);return gap<=20&&gap>=-20?void 0:gap<=-20&&gap>=-140&&e<=20?(goLeft=!0,goRight=!1,!0):gap>=0&&gap<=140&&e<=20?(goLeft=!1,goRight=!0,!0):void 0}function createGrid(s,t,e,i){this.gap=s,this.gW=t,this.gH=e,this.color=i,this.drawGrid=function(){for(var s=this.gap;s<this.gW;s+=this.gap)this.gW>=this.gH?(ctx.moveTo(s,0),ctx.lineTo(s,this.gW)):(ctx.moveTo(s,0),ctx.lineTo(s,this.gH));for(var t=this.gap;t<this.gH;t+=this.gap)ctx.moveTo(0,t),ctx.lineTo(this.gW,t);ctx.strokeStyle=this.color,ctx.lineWidth=1,ctx.stroke()}}function addNumber(s,t,e,i,l,h){return this.col=s,this.row=t,this.tSize=e,this.color=i,this.spaceX=l,this.spaceY=h,this.show=()=>{for(var s=0;s<=this.row;s++)for(var t=0;t<=this.col;t++){var e=t+s*this.col;ctx.font="9px arial bold",ctx.fillStyle=this.color,ctx.fillText(e,t*this.tSize+this.spaceX,s*this.tSize+this.spaceY)}},this}let loader=!1,that;function tiledMap(s,t,e){that=this,that.path=s,that.image=t=new Image,that.size=e,that.load=function(){(xhr=new XMLHttpRequest).onload=function(){4==this.readyState&&(data=JSON.parse(xhr.response),loader=!0,that.loadTileset(data))},xhr.open("get",that.path),xhr.send(!0)},that.loadTileset=function(s){for(tile of data.tilesets)that.image.src=tile.image.replace("../../","")},that.renderLayers=function(s){(s=Array.isArray(s=data.layers)?s:data.layers).forEach(that.renderLayer())},animL=[];var i=!1;return that.renderLayer=function(s){for(r=0;r<s.height;r++)for(col=0;col<s.width;col++){let t=col+r*s.width,l=s.data[t];tX=~~(--l%(tile.imagewidth/e))*e,tY=Math.floor(l/(tile.imagewidth/e))*e,dX=~~(t%s.width)*e,dY=Math.floor(t/s.width)*e,(isDrawable=!(dX+e<camera.x||dX+e>camera.x+camera.width+100))&&ctx.drawImage(that.image,tX,tY,e,e,dX*self.scale,dY*self.scale,e*self.scale,e*self.scale),tile.tiles&&tile.tiles.forEach((h,a)=>{if(animL.push(h),0!=l&&void 0!=animL[l]||null!=animL[l]){i=!0;var o=animL[l].animation;tIndex=layerframe%(numFrames=o.length),i&&l==h.id&&(tX=(l=o[tIndex].tileid+1)%(tile.imagewidth/e)*e,tY=Math.floor(l/(tile.imagewidth/e))*e,dX=t%s.width*e,dY=Math.floor(t/s.width)*e,(isDrawable=!(dX+e<camera.x||dX+e/2>camera.x+camera.width+100))&&ctx.drawImage(that.image,tX,tY,e,e,dX*self.scale,dY*self.scale,e*self.scale,e*self.scale))}})}var h=!1;self.objectAnimation=tileAnimation=function(t,e){for(s of(that.val=t,this.nom=e,data.layers))if("objectgroup"==s.type&&this.nom==s.name&&tile.tiles)for(let i of tile.tiles){frameIndex=objframe%(anim=i.animation).length,l=anim[frameIndex].tileid,tileColumns=tile.imagewidth/tile.tilewidth,tileRows=tile.imageheight/tile.tileheight;var l,a=tile.tileheight,o=tile.tilewidth;for(var f of s.objects)f.hasOwnProperty("gid")&&f.gid==that.val&&this.nom==s.name?h=!0:(h=!1,log(" Animation Layer's name is not defined or gidValue is incorrect in tileAnimation \n\n please read the documentation so that you may use tileAnimation correctly !!")),column=Math.floor(l%tile.columns),objrow=Math.floor(l/tile.columns),(isDrawable=!(f.x+a<camera.x)&&!(f.x+a/2>camera.x+camera.width))||(h=!1),h&&ctx.drawImage(that.image,a*column,o*objrow,a,o,f.x*self.scale,(f.y-o)*self.scale,f.width*self.scale,f.height*self.scale)}}},that.RenderObjectLayer=function(s){for(var t of(this.gid=s,data.layers))if("objectgroup"==t.type){for(var e of(tile.rows=tile.imageheight/tile.tileheight,t.objects))if(e.hasOwnProperty("gid")){var i=tile.imagewidth/tile.columns,l=tile.imageheight/tile.rows;this.gid=s,gid=s,(null==s||void 0==s)&&(gid=e.gid),column=Math.floor((gid-1)%tile.columns),obj2row=Math.floor(gid/tile.columns),isDrawable=!(e.x+i<camera.x)&&!((e.x+i/2)*self.scale>(camera.x+camera.width)*self.scale+100),e.hasOwnProperty("gid")&&e.gid!=that.val&&!t.hasOwnProperty("properties")&&isDrawable&&ctx.drawImage(that.image,i*column,l*obj2row,i,l,e.x*self.scale,(e.y-e.height)*self.scale,e.width*self.scale,e.height*self.scale)}}},that}function canDraw(s,t){return!((s.x+s.w/2)*self.scale<(t.x+s.w)*self.scale)&&!((s.x+s.r/2)*self.scale<(t.x+s.r)*self.scale)&&!((s.x+s.w/2)*self.scale>(t.x+t.width)*self.scale)&&!((s.x+s.r/2)*self.scale>(t.x+t.width)*self.scale)}function tiledCollider(s,t,e){if(s.x+s.w-9.7>t.x&&s.x<t.x+t.width-9.7&&s.y+s.h-5.6>t.y&&s.y+6<t.y+t.height-15||s.x+s.w>t.x&&s.x<t.x+t.w&&s.y+s.h>t.y&&s.y<t.y+t.h)return!0;if(e&&isJumping){let i=Math.abs(s.y-t.y);if(s.x+s.w>t.x&&s.y+s.h>=t.y+t.height&&s.x<t.x+t.width&&s.y-s.h<=t.y+t.height&&i<=s.y-s.h)return!0}}var canJump=!1,Lside=!1,Rside=!1,Uside=!1,Dside=!1;function RpgFollow(s,t,e){this.gap=e;var i=Math.atan2(s.y-t.y,s.x-t.x),l=s.x-t.x,h=s.y-t.y;if(Math.sqrt(l*l+h*h)<=this.gap){switch(t.vx=Math.cos(i),t.vy=Math.sin(i),t.x+=2*t.vx,t.y+=2*t.vy,Math.sign(t.vx)){case -1:Lside=!0,Rside=!1,Uside=!1,Dside=!1;break;case 1:Rside=!0,Lside=!1,Uside=!1,Dside=!1}switch(Math.sign(t.vy)){case -1:Uside=!0,Rside=!1,Dside=!1,Lside=!1;break;case 1:Dside=!0,Rside=!1,Uside=!1,Lside=!1}}}function gameRadar(s,t){this.x=s,this.y=t;var e=new Image;e.src=this.x.toDataURL(),this.y.style.background=`url(${e.src})`,this.y.style.backgroundRepeat="no-repat",this.y.style.backgroundSize="cover"}var gameFrame=0,gameSpeed=5;class layerB{constructor(s,t,e,i,l,h){this.x=t,this.y=e,this.image=s,this.w=i,this.h=l,this.speedModifier=h,this.speed=gameSpeed*this.speedModifier}update(){this.speed=gameSpeed*this.speedModifier,this.x=gameFrame*this.speed%this.w}draw(){ctx.save(),ctx.drawImage(this.image,this.x,this.y,this.w,this.h),ctx.drawImage(this.image,this.x+this.w,this.y,this.w,this.h),ctx.restore()}}console.dir("CanvasgGameJs is running !!");var isJumping=!1;function LeftCollider(s,t,e,i){for(var l=0;l<s.length;l++)for(var h,a=0;a<s[0].length;a++)if(s[l][a]==i){h={x:tx=a*e,y:ty=l*e,w:e,h:e};let o;var f=Math.abs(t.y-h.y);h.w==t.w&&(o=f<=3.5),(h.w/t.w!=1||24==t.w)&&(o=f<=13),h.w/t.w!=1&&16==t.w&&(o=f>=18),t.x+t.w>h.x&&t.y+t.h>h.y&&t.x<h.x+h.w&&t.y<h.y+h.h&&o&&(t.x=t.oldX-.01)}}function RightCollider(s,t,e,i){for(var l=0;l<s.length;l++)for(var h,a=0;a<s[0].length;a++)if(tx=a*e,ty=l*e,s[l][a]==i){h={x:tx,y:ty,w:e,h:e};let o;var f=Math.abs(t.y-h.y);h.w==t.w&&(o=f<=3.5),(h.w/t.w!=1||24==t.w)&&(o=f<=13),h.w/t.w!=1&&16==t.w&&(o=f>=18),t.x+t.w>h.x&&t.y+t.h>h.y&&t.x<h.x+h.w&&t.y<h.y+h.h&&o&&(t.x=t.oldX+.01)}}function TopCollider(s,t,e,i){for(var l=0;l<s.length;l++)for(var h=0;h<s[0].length;h++)if(s[l][h]==i){var a={x:tx=h*e,y:ty=l*e,w:e,h:e};t.vy>0&&t.x+t.w>a.x&&t.y+t.h+t.vy>a.y&&t.x<a.x+a.w&&t.y+t.vy<a.y+a.h&&(t.y=a.y-t.h-.42,t.vy=0,t.shadow=!1,JumpTime=0)}}function TopTiledCollider(s,t){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==s)for(let e of layer.objects)t.vy>0&&t.x+t.w>=e.x&&t.y+t.h+t.vy>=e.y&&t.x<=e.x+e.width&&t.y+t.vy<=e.y+e.height&&(t.y=e.y-t.h-.03,t.vy=0,t.shadow=!1,JumpTime=0)}function BottomCollider(s,t,e,i,l){if(!l)for(var h=0;h<s.length;h++)for(var a,o=0;o<s[0].length;o++)s[h][o]==i&&(a={x:tx=o*e,y:ty=h*e,w:e,h:e},isJumping&&t.x+t.w>a.x&&t.y+t.h>=a.y&&t.x<=a.x+a.w&&t.y<=a.y+a.h-3&&(t.y=a.y+a.h+.01,t.vy=0,isOnAir=!1,isJumping=!1))}function BottomTiledCollider(s,t){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==s)for(let e of layer.objects)e.y,t.y,isJumping&&t.x+t.w>=e.x&&t.y+t.h>=e.y&&t.x<=e.x+e.width&&t.y<=e.y+e.height-3&&(t.y=e.y+e.height+.01,t.vy=0,isOnAir=!1,isJumping=!1)}function LeftTiledCollider(s,t){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==s)for(let e of layer.objects)isCollide(t,e)&&(t.x=t.oldX-.01)}function RightTiledCollider(s,t){for(layer of data.layers)if("objectgroup"==layer.type&&layer.name==s)for(let e of layer.objects)isCollide(t,e)&&(t.x=t.oldX+.01)}function isFlipCollide(s,t){var e=Math.abs(s.x-t.x),i=Math.abs(s.y-t.y);if(t.r){if(s.flipX&&s.x+s.w>t.x&&s.x-1.5*s.w<=t.x+1.5*t.r&&s.y+s.h>t.y&&s.y<t.y+1.8*t.r||e<t.r+s.w&&i<t.r+s.h){if(s.flipX&&s.x<t.x+t.r/1.8)return;return!0}if(!s.flpiX&&s.x+s.w/1.5>t.x&&s.x<t.x+t.r&&s.y+s.h>t.y&&s.y<t.y+t.r/1.8||e<t.r+s.w&&i<t.r+s.h)return!0}if(void 0==t.r){var e=Math.abs(s.x-t.x),i=Math.abs(s.y-t.y);if(!s.flipX&&s.x+s.w>=t.x&&s.x<=t.x+t.w&&s.y+s.h>=t.y&&s.y<=t.y+1.8*t.h)return!0;if(s.flipX&&s.x+s.w>=t.x&&s.x-1.8*s.w<=t.x+t.w&&s.y+s.h>=t.y&&s.y<=t.y+1.8*t.h){if(s.flipX&&s.x<t.x+t.w)return;return!0}}}Array.prototype.parse2D=function(s){for(var t=[],e=0;e<this.length;e+=s)t.push(this.slice(e,e+s));return t};var partImage=new Image;function Particles(s,t,e,i,l){this.name=l,this.x=s+3,this.y=t,this.size=e/1.5,this.alpha=1,this.friction=.7,this.vx=-3.5*Math.random()+-5.7*Math.random(),this.vy=(Math.random()-3.2)*Math.random()*2,this.update=function(){this.vx*=this.friction,this.x+=this.vx,this.vy+=3,this.y+=this.vy,"fire"==this.name?(this.color="#720",this.vy-=3.6,this.y+=this.vy*this.friction):"rainbow"==this.name?(this.color="#"+Math.random().toString(16).substr(-6),this.vy-=3.5,this.y+=this.vy):"waterfall"==this.name?(this.color="rgba(200,200,200,0.4)",this.vy-=.5,this.y+=this.vy*this.friction):"smoke"==this.name?(this.color="rgba(0,0,0,1)",this.vy-=3.5,this.y+=this.vy):i.color?this.color=i.color:this.color="#"+Math.random().toString(16).substr(-6)},this.draw=function(){for(let s=0;s<particles.length-1;s++){var t=particles[s];t.dx=i.x-t.x,t.dy=i.y-t.y,Math.hypot(t.dx,t.dy)>=40&&(this.alpha-=.006,this.alpha<=.5&&(particles[0]&&(this.alpha=1),kill(particles,s)))}if(i.image&&"self"==this.name){partImage.src=i.image.src,ctx.save(),ctx.globalAlpha=this.alpha,ctx.drawImage(partImage,this.x*self.scale,this.y*self.scale,5.5*this.size*self.scale,3.5*this.size*self.scale),ctx.restore();return}ctx.save(),ctx.globalAlpha=this.alpha,ctx.fillStyle=this.color,"fire"==this.name&&(ctx.shadowBlur=1.5,ctx.shadowColor="rgba(120,230,50,0.8)"),ctx.beginPath(),ctx.arc(this.x*self.scale,this.y*self.scale,1.9*this.size*self.scale,1.8*self.scale,1.7*Math.PI),ctx.fill(),ctx.restore()}}function createParticle(s,t,e){this.thesize=t,this.target=s;for(var i=0;i<t;i++)s.image&&void 0==e&&canDraw(this.target,camera)&&particles.push(new Particles(s.x+s.w/2||s.x,s.y,3*Math.random()+.3,s,e)),"fire"==e||"waterfall"==e||"smoke"==e||"rainbow"==e?canDraw(this.target,camera)&&particles.push(new Particles(s.x+s.w/2||s.x,s.y,1.5*Math.random()+.02,s,e)):canDraw(this.target,camera)&&particles.push(new Particles(s.x+s.w/2||s.x,s.y,3*Math.random()+.2,s,e));return this}function hitBox(s,t,e){var i,l=Math.abs(s.x-t.x);if(Math.hypot(l,Math.abs(s.y-t.y))<=e)return!0}function SnowEffect(s){var t=[-4,4];rand=Math.random()*length,this.space=s;for(var e={x:Math.floor(Math.random()*camera.width)+camera.x,y:0,s:Math.floor(1*Math.random())+.5,color:"rgb(255,255,255)"},i=0;i<10;i++)snows.push(new Circle(e.x,e.y,e.s,t[rand],1,e.color));for(var l=0;l<snows.length;l++)snows[l].y+=.5,snows[l].y>s.height&&kill(snows,l),snows[l].x>s.width&&kill(snows,l)}function RainEffect(s){this.space=s;for(var t=[-3,3],e={x:Math.floor(Math.random()*camera.width)+camera.x,y:0,w:Math.floor(.2*Math.random())+.05,h:8,color:"rgba(250,250,250,0.07)"},i=0;i<100;i+=2)rand=Math.random()*t.length,rains.push(new Sprite(e.x,e.y,e.w,e.h,Math.cos(t[rand]),Math.floor(3*Math.random())+5,e.color));for(var l=0;l<rains.length;l++)rains[l].y+=20,rains[l].y>s.height&&kill(rains,l),rains[l].x>s.width&&kill(rains,l)}function isPath(s,t,e){index=0;var i=Math.abs(e.x-t.x),l=Math.abs(e.y-t.y);dx=(wp=s[pathIndex]).x-t.x;var h=Math.atan2(dy=wp.y-t.y,dx),a=Math.hypot(i,l);if(t.vx=Math.cos(h),t.vy=Math.sin(h),t.x+=2*t.vx,t.y+=2*t.vy,a>=-5&&a<=150)return!!(Math.abs(Math.round(t.x)-Math.round(wp.x))<Math.abs(2*t.vx)&&Math.abs(Math.round(t.y)-Math.round(wp.y))<Math.abs(2*t.vy))&&!!(pathIndex<s.length-1)}
